<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Simulate Under-Reporting Scenarios — sim_ur_scenarios • simaerep</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Simulate Under-Reporting Scenarios — sim_ur_scenarios" />
<meta property="og:description" content="Use with simulated portfolio data to generate under-reporting
stats for specified scenarios." />
<meta property="og:image" content="https://openpharma.github.io/simaerep/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simaerep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a>
    </li>
    <li>
      <a href="../articles/check_poisson.html">Check Poisson Test Applicability</a>
    </li>
    <li>
      <a href="../articles/sas_files.html">SAS Files as a Data Source</a>
    </li>
    <li>
      <a href="../articles/visit_med75.html">Adjusted Evaluation Point visit_med75</a>
    </li>
    <li>
      <a href="../articles/visits_or_days.html">Aggregate AEs by Days or Visit?</a>
    </li>
    <li>
      <a href="../articles/portfolio_perf.html">simaerep Portfolio Performance</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/openpharma/simaerep/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simulate Under-Reporting Scenarios</h1>
    <small class="dont-index">Source: <a href='https://github.com/openpharma/simaerep/blob/master/R/simulate_test_data.R'><code>R/simulate_test_data.R</code></a></small>
    <div class="hidden name"><code>sim_ur_scenarios.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Use with simulated portfolio data to generate under-reporting
stats for specified scenarios.</p>
    </div>

    <pre class="usage"><span class='fu'>sim_ur_scenarios</span><span class='op'>(</span>
  <span class='va'>df_portf</span>,
  extra_ur_sites <span class='op'>=</span> <span class='fl'>3</span>,
  ur_rate <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.25</span>, <span class='fl'>0.5</span><span class='op'>)</span>,
  r <span class='op'>=</span> <span class='fl'>1000</span>,
  poisson_test <span class='op'>=</span> <span class='cn'>FALSE</span>,
  prob_lower <span class='op'>=</span> <span class='cn'>TRUE</span>,
  parallel <span class='op'>=</span> <span class='cn'>FALSE</span>,
  progress <span class='op'>=</span> <span class='cn'>TRUE</span>,
  site_aggr_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  eval_sites_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>df_portf</th>
      <td><p>dataframe as returned by <code><a href='sim_test_data_portfolio.html'>sim_test_data_portfolio</a></code></p></td>
    </tr>
    <tr>
      <th>extra_ur_sites</th>
      <td><p>numeric, set maximum number of additional
under-reporting sites, see details Default: 3</p></td>
    </tr>
    <tr>
      <th>ur_rate</th>
      <td><p>numeric vector, set under-reporting rates for scenarios
Default: c(0.25, 0.5)</p></td>
    </tr>
    <tr>
      <th>r</th>
      <td><p>integer, denotes number of simulations, default = 1000</p></td>
    </tr>
    <tr>
      <th>poisson_test</th>
      <td><p>logical, calculates poisson.test pvalue</p></td>
    </tr>
    <tr>
      <th>prob_lower</th>
      <td><p>logical, calculates probability for getting a lower value</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>logical, use parallel processing see details, Default: FALSE</p></td>
    </tr>
    <tr>
      <th>progress</th>
      <td><p>logical, show progress bar, Default: TRUE</p></td>
    </tr>
    <tr>
      <th>site_aggr_args</th>
      <td><p>named list of parameters passed to
<code><a href='site_aggr.html'>site_aggr</a></code>, Default: list()</p></td>
    </tr>
    <tr>
      <th>eval_sites_args</th>
      <td><p>named list of parameters passed to
<code><a href='eval_sites.html'>eval_sites</a></code>, Default: list()</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>dataframe with the following columns:</p><dl>
<dt><strong>study_id</strong></dt><dd><p>study identification</p></dd>
<dt><strong>site_number</strong></dt><dd><p>site identification</p></dd>
<dt><strong>n_pat</strong></dt><dd><p>number of patients at site</p></dd>
<dt><strong>n_pat_with_med75</strong></dt><dd><p>number of patients at site with visit_med75</p></dd>
<dt><strong>visit_med75</strong></dt><dd><p>median(max(visit)) * 0.75</p></dd>
<dt><strong>mean_ae_site_med75</strong></dt><dd><p>mean AE at visit_med75 site level</p></dd>
<dt><strong>mean_ae_study_med75</strong></dt><dd><p>mean AE at visit_med75 study level</p></dd>
<dt><strong>n_pat_with_med75_study</strong></dt><dd><p>number of patients at site with
visit_med75 at study excl site</p></dd>
<dt><strong>extra_ur_sites</strong></dt><dd><p>additional sites
with under-reporting patients</p></dd>
<dt><strong>frac_pat_with_ur</strong></dt><dd><p>ratio of
patients in study that are under-reporting</p></dd>
<dt><strong>ur_rate</strong></dt><dd><p>under-reporting rate</p></dd>
<dt><strong>pval</strong></dt><dd><p>p-value as
returned by <code><a href='https://rdrr.io/r/stats/poisson.test.html'>poisson.test</a></code></p></dd>
<dt><strong>prob_low</strong></dt><dd><p>bootstrapped probability for having mean_ae_site_med75
or lower</p></dd> <dt><strong>pval_adj</strong></dt><dd><p>adjusted p-values</p></dd>
<dt><strong>prob_low_adj</strong></dt><dd><p>adjusted bootstrapped probability for having
mean_ae_site_med75 or lower</p></dd> <dt><strong>pval_prob_ur</strong></dt><dd><p>probability
under-reporting as 1 - pval_adj, poisson.test (use as benchmark)</p></dd>
<dt><strong>prob_low_prob_ur</strong></dt><dd><p>probability under-reporting as 1 -
prob_low_adj, bootstrapped (use)</p></dd>

</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function will apply under-reporting scenarios to each site.
Reducing the number of AEs by a given under-reporting (ur_rate) for all
patients at the site and add the corresponding under-reporting statistics.
Since the under-reporting probability is also affected by the number of
other sites that are under-reporting we additionally calculate
under-reporting statistics in a scenario where additional under reporting
sites are present. For this we use the median number of patients per site
at the study to calculate the final number of patients for which we lower
the AEs in a given under-reporting scenario. We use the furrr package to
implement parallel processing as these simulations can take a long time to
run. For this to work we need to specify the plan for how the code should
run, e.g. plan(multisession, workers = 18)</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='sim_test_data_study.html'>sim_test_data_study</a></code>
<code><a href='get_config.html'>get_config</a></code>
<code><a href='sim_test_data_portfolio.html'>sim_test_data_portfolio</a></code>
<code>sim_ur_scenarios</code>
<code><a href='get_portf_perf.html'>get_portf_perf</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
<span class='va'>df_visit1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_test_data_study.html'>sim_test_data_study</a></span><span class='op'>(</span>n_pat <span class='op'>=</span> <span class='fl'>100</span>, n_sites <span class='op'>=</span> <span class='fl'>10</span>,
                                 frac_site_with_ur <span class='op'>=</span> <span class='fl'>0.4</span>, ur_rate <span class='op'>=</span> <span class='fl'>0.6</span><span class='op'>)</span>

<span class='va'>df_visit1</span><span class='op'>$</span><span class='va'>study_id</span> <span class='op'>&lt;-</span> <span class='st'>"A"</span>

<span class='va'>df_visit2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_test_data_study.html'>sim_test_data_study</a></span><span class='op'>(</span>n_pat <span class='op'>=</span> <span class='fl'>100</span>, n_sites <span class='op'>=</span> <span class='fl'>10</span>,
                                 frac_site_with_ur <span class='op'>=</span> <span class='fl'>0.2</span>, ur_rate <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>

<span class='va'>df_visit2</span><span class='op'>$</span><span class='va'>study_id</span> <span class='op'>&lt;-</span> <span class='st'>"B"</span>

<span class='va'>df_visit</span> <span class='op'>&lt;-</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>df_visit1</span>, <span class='va'>df_visit2</span><span class='op'>)</span>

<span class='va'>df_site_max</span> <span class='op'>&lt;-</span> <span class='va'>df_visit</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>study_id</span>, <span class='va'>site_number</span>, <span class='va'>patnum</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarise</span><span class='op'>(</span>max_visit <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>visit</span><span class='op'>)</span>,
            max_ae <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>n_ae</span><span class='op'>)</span>,
            .groups <span class='op'>=</span> <span class='st'>"drop"</span><span class='op'>)</span>

<span class='va'>df_config</span> <span class='op'>&lt;-</span> <span class='fu'><a href='get_config.html'>get_config</a></span><span class='op'>(</span><span class='va'>df_site_max</span><span class='op'>)</span>

<span class='va'>df_config</span>

<span class='va'>df_portf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sim_test_data_portfolio.html'>sim_test_data_portfolio</a></span><span class='op'>(</span><span class='va'>df_config</span><span class='op'>)</span>

<span class='va'>df_portf</span>

<span class='va'>df_scen</span> <span class='op'>&lt;-</span> <span class='fu'>sim_ur_scenarios</span><span class='op'>(</span><span class='va'>df_portf</span>,
                            extra_ur_sites <span class='op'>=</span> <span class='fl'>2</span>,
                            ur_rate <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>


<span class='va'>df_scen</span>

<span class='va'>df_perf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='get_portf_perf.html'>get_portf_perf</a></span><span class='op'>(</span><span class='va'>df_scen</span><span class='op'>)</span>

<span class='va'>df_perf</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>



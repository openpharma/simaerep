<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Address Usability Limits of Bootstrap Method â€¢ simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Address Usability Limits of Bootstrap Method">
<meta property="og:description" content="simaerep">
<meta property="og:image" content="https://openpharma.github.io/simaerep/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simaerep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/sas_files.html">SAS Files as a Data Source</a>
    </li>
    <li>
      <a href="../articles/portfolio_perf.html">simaerep Portfolio Performance</a>
    </li>
    <li>
      <a href="../articles/visit_med75.html">Adjusted Evaluation Point visit_med75</a>
    </li>
    <li>
      <a href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a>
    </li>
    <li>
      <a href="../articles/check_poisson.html">Check Poisson Test Applicability</a>
    </li>
    <li>
      <a href="../articles/visits_or_days.html">Aggregate AEs by Days or Visit?</a>
    </li>
    <li>
      <a href="../articles/gsm_perf.html">Comparing {simaerep} and {gsm} Performance</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/simaerep/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Address Usability Limits of Bootstrap
Method</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/HEAD/vignettes/usability_limits.Rmd" class="external-link"><code>vignettes/usability_limits.Rmd</code></a></small>
      <div class="hidden name"><code>usability_limits.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="load">Load<a class="anchor" aria-label="anchor" href="#load"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/simaerep/">simaerep</a></span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>As we already mentioned in the <a href="file:///git_repos/simaerep/docs/articles/intro.html#disadvantages-over-classic-statistical-tests">introduction</a>
bootstrap resampling comes at a price. We need a good proportion of
sites that are compliant and are not under-reporting AEs. Otherwise the
patient pool we draw from will be tainted. Also, in general for count
data, negative deviations from overall small integer values (3 or less)
are hard to detect. Here we will assess the usability limits of the
bootstrap resampling method by applying it to different simulated
scenarios.</p>
</div>
<div class="section level2">
<h2 id="parameter-grid">Parameter Grid<a class="anchor" aria-label="anchor" href="#parameter-grid"></a>
</h2>
<p>We start by defining a parameter grid.</p>
<p><strong>Fixed Parameters:</strong><br>
- n_pat: 1000<br>
- n_sites: 100<br>
- max_visit_mean: 20<br>
- max_visit_sd: 4</p>
<p><strong>Variable Parameters:</strong><br>
- ae_visit: 0.05 - 2<br>
- frac_sites_wit_ur: 0.05 - 0.75<br>
- ur_rate: 0.05 - 1</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span> ae_per_visit_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">2</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>frac_site_with_ur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.75</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">frac_site_with_ur</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">ur_rate</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">df_grid</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,000 Ã— 3</span></span></span>
<span><span class="co">##    ae_per_visit_mean frac_site_with_ur ur_rate</span></span>
<span><span class="co">##                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>              0.05              0.05   0.05 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>              0.05              0.05   0.156</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>              0.05              0.05   0.261</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>              0.05              0.05   0.367</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>              0.05              0.05   0.472</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>              0.05              0.05   0.578</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>              0.05              0.05   0.683</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>              0.05              0.05   0.789</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>              0.05              0.05   0.894</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>              0.05              0.05   1    </span></span>
<span><span class="co">## <span style="color: #949494;"># â€¦ with 990 more rows</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="apply">Apply<a class="anchor" aria-label="anchor" href="#apply"></a>
</h2>
<p>We use the <a href="https://github.com/DavisVaughan/furrr" class="external-link"><code>furrr</code></a> and
the <a href="https://github.com/HenrikBengtsson/future" class="external-link"><code>future</code></a>
package for multiprocessing. We proceed in applying all functions we
already <a href="https://openpharma.github.io/simaerep/articles/intro.html">introduced</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multiprocess</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="simulate-test-data">Simulate Test Data<a class="anchor" aria-label="anchor" href="#simulate-test-data"></a>
</h3>
<p>We iteratively apply <a href="https://openpharma.github.io/simaerep/reference/sim_test_data_study.html">sim_test_data_study()</a>
on the different parameter combination of the grid</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_grid</span> <span class="op">&lt;-</span> <span class="va">df_grid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> </span>
<span>    df_visit <span class="op">=</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://furrr.futureverse.org/reference/future_map2.html" class="external-link">future_pmap</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>am <span class="op">=</span> <span class="va">ae_per_visit_mean</span>,</span>
<span>           fr <span class="op">=</span> <span class="va">frac_site_with_ur</span>,</span>
<span>           ur <span class="op">=</span> <span class="va">ur_rate</span><span class="op">)</span>,</span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">am</span>, <span class="va">fr</span>, <span class="va">ur</span><span class="op">)</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span>n_pat <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                               n_sites <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                               max_visit_mean <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                               max_visit_sd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                               ae_per_visit_mean <span class="op">=</span> <span class="va">am</span>,</span>
<span>                                               frac_site_with_ur <span class="op">=</span> <span class="va">fr</span>,</span>
<span>                                               ur_rate <span class="op">=</span> <span class="va">ur</span><span class="op">)</span>,</span>
<span>      .progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      .options <span class="op">=</span> <span class="fu"><a href="https://furrr.futureverse.org/reference/furrr_options.html" class="external-link">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df_grid</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,000 Ã— 4</span></span></span>
<span><span class="co">##    ae_per_visit_mean frac_site_with_ur ur_rate df_visit             </span></span>
<span><span class="co">##                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>              0.05              0.05   0.05  <span style="color: #949494;">&lt;tibble [19,459 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>              0.05              0.05   0.156 <span style="color: #949494;">&lt;tibble [19,631 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>              0.05              0.05   0.261 <span style="color: #949494;">&lt;tibble [19,234 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>              0.05              0.05   0.367 <span style="color: #949494;">&lt;tibble [19,523 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>              0.05              0.05   0.472 <span style="color: #949494;">&lt;tibble [19,518 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>              0.05              0.05   0.578 <span style="color: #949494;">&lt;tibble [19,545 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>              0.05              0.05   0.683 <span style="color: #949494;">&lt;tibble [19,503 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>              0.05              0.05   0.789 <span style="color: #949494;">&lt;tibble [19,351 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>              0.05              0.05   0.894 <span style="color: #949494;">&lt;tibble [19,473 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>              0.05              0.05   1     <span style="color: #949494;">&lt;tibble [19,489 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #949494;"># â€¦ with 990 more rows</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="aggregate-test-data">Aggregate Test Data<a class="anchor" aria-label="anchor" href="#aggregate-test-data"></a>
</h3>
<p>We apply <a href="https://openpharma.github.io/simaerep/reference/site_aggr.html">site_aggr()</a>
on the different simulated data sets.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_grid</span> <span class="op">&lt;-</span> <span class="va">df_grid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> </span>
<span>    df_visit <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">df_visit</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">x</span>, study_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    df_site <span class="op">=</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://furrr.futureverse.org/reference/future_map.html" class="external-link">future_map</a></span><span class="op">(</span><span class="va">df_visit</span>,</span>
<span>                                <span class="va">site_aggr</span>,</span>
<span>                                .progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                .options <span class="op">=</span> <span class="fu"><a href="https://furrr.futureverse.org/reference/furrr_options.html" class="external-link">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>                                <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df_grid</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,000 Ã— 5</span></span></span>
<span><span class="co">##    ae_per_visit_mean frac_site_with_ur ur_rate df_visit              df_site </span></span>
<span><span class="co">##                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>              0.05              0.05   0.05  <span style="color: #949494;">&lt;tibble [19,459 Ã— 9]&gt;</span> &lt;tibble&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>              0.05              0.05   0.156 <span style="color: #949494;">&lt;tibble [19,631 Ã— 9]&gt;</span> &lt;tibble&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>              0.05              0.05   0.261 <span style="color: #949494;">&lt;tibble [19,234 Ã— 9]&gt;</span> &lt;tibble&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>              0.05              0.05   0.367 <span style="color: #949494;">&lt;tibble [19,523 Ã— 9]&gt;</span> &lt;tibble&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>              0.05              0.05   0.472 <span style="color: #949494;">&lt;tibble [19,518 Ã— 9]&gt;</span> &lt;tibble&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>              0.05              0.05   0.578 <span style="color: #949494;">&lt;tibble [19,545 Ã— 9]&gt;</span> &lt;tibble&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>              0.05              0.05   0.683 <span style="color: #949494;">&lt;tibble [19,503 Ã— 9]&gt;</span> &lt;tibble&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>              0.05              0.05   0.789 <span style="color: #949494;">&lt;tibble [19,351 Ã— 9]&gt;</span> &lt;tibble&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>              0.05              0.05   0.894 <span style="color: #949494;">&lt;tibble [19,473 Ã— 9]&gt;</span> &lt;tibble&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>              0.05              0.05   1     <span style="color: #949494;">&lt;tibble [19,489 Ã— 9]&gt;</span> &lt;tibble&gt;</span></span>
<span><span class="co">## <span style="color: #949494;"># â€¦ with 990 more rows</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="simulate-sites">Simulate Sites<a class="anchor" aria-label="anchor" href="#simulate-sites"></a>
</h3>
<p>We apply <a href="https://openpharma.github.io/simaerep/reference/sim_sites.html">sim_sites()</a>
to to calculate the AE under-reporting probability.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_grid</span> <span class="op">&lt;-</span> <span class="va">df_grid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> df_sim_sites <span class="op">=</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://furrr.futureverse.org/reference/future_map2.html" class="external-link">future_map2</a></span><span class="op">(</span><span class="va">df_site</span>, <span class="va">df_visit</span>,</span>
<span>                                            <span class="va">sim_sites</span>,</span>
<span>                                            r <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                            poisson_test <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                            prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                            .progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                            .options <span class="op">=</span> <span class="fu"><a href="https://furrr.futureverse.org/reference/furrr_options.html" class="external-link">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>                                            <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df_grid</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,000 Ã— 6</span></span></span>
<span><span class="co">##    ae_per_visit_mean frac_site_with_ur ur_rate df_visit df_site  df_sim_sites</span></span>
<span><span class="co">##                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>              0.05              0.05   0.05  &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>              0.05              0.05   0.156 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>              0.05              0.05   0.261 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>              0.05              0.05   0.367 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>              0.05              0.05   0.472 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>              0.05              0.05   0.578 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>              0.05              0.05   0.683 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>              0.05              0.05   0.789 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>              0.05              0.05   0.894 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>              0.05              0.05   1     &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #949494;"># â€¦ with 990 more rows</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="evaluate-sites">Evaluate Sites<a class="anchor" aria-label="anchor" href="#evaluate-sites"></a>
</h3>
<p>We apply <a href="https://openpharma.github.io/simaerep/reference/eval_sites.html">eval_sites()</a>
to balance the bootstrapped probabilities by the expected number of
false positives.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_grid</span> <span class="op">&lt;-</span> <span class="va">df_grid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> df_eval <span class="op">=</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://furrr.futureverse.org/reference/future_map.html" class="external-link">future_map</a></span><span class="op">(</span><span class="va">df_sim_sites</span>,</span>
<span>                                      <span class="va">eval_sites</span>,</span>
<span>                                      .progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                      .options <span class="op">=</span> <span class="fu"><a href="https://furrr.futureverse.org/reference/furrr_options.html" class="external-link">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>                                      <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df_grid</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,000 Ã— 7</span></span></span>
<span><span class="co">##    ae_per_visit_mean frac_site_with_ur ur_rate df_visit df_site  df_sim_sites</span></span>
<span><span class="co">##                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>              0.05              0.05   0.05  &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>              0.05              0.05   0.156 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>              0.05              0.05   0.261 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>              0.05              0.05   0.367 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>              0.05              0.05   0.472 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>              0.05              0.05   0.578 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>              0.05              0.05   0.683 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>              0.05              0.05   0.789 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>              0.05              0.05   0.894 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>              0.05              0.05   1     &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #949494;"># â€¦ with 990 more rows, and 1 more variable: df_eval &lt;list&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="get-metrics">Get Metrics<a class="anchor" aria-label="anchor" href="#get-metrics"></a>
</h3>
<p>Apart from calculating true and false positives rate for the final
under-reporting probability we also calculate the same metrics for a
couple of benchmark probabilities.</p>
<ul>
<li>p-values returned from <code><a href="https://rdrr.io/r/stats/poisson.test.html" class="external-link">poisson.test()</a></code>
</li>
<li>and the probabilities and p-values before adjusting for the expected
false positives</li>
</ul>
<p>In all cases we use a 95% probability threshold.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_metrics</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_visit</span>, <span class="va">df_eval</span>, <span class="va">method</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"ptest"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">prob_ur_adj</span> <span class="op">=</span> <span class="st">"pval_prob_ur"</span></span>
<span>    <span class="va">prob_ur_unadj</span> <span class="op">=</span> <span class="st">"pval"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">prob_ur_adj</span> <span class="op">=</span> <span class="st">"prob_low_prob_ur"</span></span>
<span>    <span class="va">prob_ur_unadj</span> <span class="op">=</span> <span class="st">"prob_low"</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">df_ur</span> <span class="op">&lt;-</span> <span class="va">df_visit</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">site_number</span>, <span class="va">is_ur</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">df_metric_prep</span> <span class="op">&lt;-</span> <span class="va">df_eval</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_ur</span>, <span class="st">"site_number"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span> prob_ur_adj <span class="op">=</span> <span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="va">prob_ur_adj</span><span class="op">)</span>,</span>
<span>            prob_ur_unadj <span class="op">=</span> <span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="va">prob_ur_unadj</span><span class="op">)</span> <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">df_metric_adjusted</span> <span class="op">&lt;-</span> <span class="va">df_metric_prep</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">is_ur</span>, <span class="va">prob_ur_adj</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> tp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_ur</span> <span class="op">&amp;</span> <span class="va">prob_ur_adj</span> <span class="op">&gt;=</span> <span class="fl">0.95</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_ur</span> <span class="op">&amp;</span> <span class="va">prob_ur_adj</span> <span class="op">&lt;</span> <span class="fl">0.95</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            tn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">(</span><span class="op">!</span> <span class="va">is_ur</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">prob_ur_adj</span> <span class="op">&lt;</span> <span class="fl">0.95</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            fp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">(</span><span class="op">!</span> <span class="va">is_ur</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">prob_ur_adj</span> <span class="op">&gt;=</span> <span class="fl">0.95</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">prob_ur_adj</span> <span class="op">&gt;=</span> <span class="fl">0.95</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">prob_ur_adj</span> <span class="op">&lt;</span> <span class="fl">0.95</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            P <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_ur</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span> <span class="va">is_ur</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">site_number</span>, <span class="op">-</span> <span class="va">is_ur</span>, <span class="op">-</span> <span class="va">prob_ur_adj</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarize_all</a></span><span class="op">(</span><span class="va">sum</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prob_type <span class="op">=</span> <span class="st">"adjusted"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">df_metric_unadjusted</span> <span class="op">&lt;-</span> <span class="va">df_metric_prep</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">is_ur</span>, <span class="va">prob_ur_unadj</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> tp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_ur</span> <span class="op">&amp;</span> <span class="va">prob_ur_unadj</span> <span class="op">&lt;=</span> <span class="fl">0.05</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_ur</span> <span class="op">&amp;</span> <span class="va">prob_ur_unadj</span> <span class="op">&gt;</span> <span class="fl">0.05</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            tn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">(</span><span class="op">!</span> <span class="va">is_ur</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">prob_ur_unadj</span> <span class="op">&gt;</span> <span class="fl">0.05</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            fp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">(</span><span class="op">!</span> <span class="va">is_ur</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">prob_ur_unadj</span> <span class="op">&lt;=</span> <span class="fl">0.05</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">prob_ur_unadj</span> <span class="op">&lt;=</span> <span class="fl">0.05</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">prob_ur_unadj</span> <span class="op">&gt;</span> <span class="fl">0.05</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            P <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_ur</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>            N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span> <span class="va">is_ur</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">site_number</span>, <span class="op">-</span> <span class="va">is_ur</span>, <span class="op">-</span> <span class="va">prob_ur_unadj</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarize_all</a></span><span class="op">(</span><span class="va">sum</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prob_type <span class="op">=</span> <span class="st">"unadjusted"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">df_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_metric_adjusted</span>, <span class="va">df_metric_unadjusted</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">method</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_grid</span> <span class="op">&lt;-</span> <span class="va">df_grid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>df_metric_pval <span class="op">=</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://furrr.futureverse.org/reference/future_map2.html" class="external-link">future_map2</a></span><span class="op">(</span><span class="va">df_visit</span>, <span class="va">df_eval</span>,</span>
<span>                                              <span class="va">get_metrics</span>,</span>
<span>                                              method <span class="op">=</span> <span class="st">"ptest"</span><span class="op">)</span>,</span>
<span>         df_metric_prob_low <span class="op">=</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://furrr.futureverse.org/reference/future_map2.html" class="external-link">future_map2</a></span><span class="op">(</span><span class="va">df_visit</span>, <span class="va">df_eval</span>,</span>
<span>                                                <span class="va">get_metrics</span>,</span>
<span>                                                method <span class="op">=</span> <span class="st">"bootstrap"</span><span class="op">)</span>,</span>
<span>         df_metric <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">df_metric_pval</span>, <span class="va">df_metric_prob_low</span>, <span class="va">bind_rows</span><span class="op">)</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span><span class="va">df_grid</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,000 Ã— 10</span></span></span>
<span><span class="co">##    ae_per_visit_mean frac_site_with_ur ur_rate df_visit df_site  df_sim_sites</span></span>
<span><span class="co">##                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>              0.05              0.05   0.05  &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>              0.05              0.05   0.156 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>              0.05              0.05   0.261 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>              0.05              0.05   0.367 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>              0.05              0.05   0.472 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>              0.05              0.05   0.578 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>              0.05              0.05   0.683 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>              0.05              0.05   0.789 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>              0.05              0.05   0.894 &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>              0.05              0.05   1     &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #949494;"># â€¦ with 990 more rows, and 4 more variables: df_eval &lt;list&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   df_metric_pval &lt;list&gt;, df_metric_prob_low &lt;list&gt;, df_metric &lt;list&gt;</span></span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="plot">Plot<a class="anchor" aria-label="anchor" href="#plot"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_plot</span> <span class="op">&lt;-</span> <span class="va">df_grid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ae_per_visit_mean</span>, <span class="va">frac_site_with_ur</span>, <span class="va">ur_rate</span>, <span class="va">df_metric</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">df_metric</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_plot</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4,000 Ã— 14</span></span></span>
<span><span class="co">##    ae_per_visit_mean frac_site_with_ur ur_rate study_id    tp    fn    tn    fp</span></span>
<span><span class="co">##                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>              0.05              0.05   0.05  S 1          0     5    95     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>              0.05              0.05   0.05  S 1          0     5    94     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>              0.05              0.05   0.05  S 1          0     5    95     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>              0.05              0.05   0.05  S 1          0     5    94     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>              0.05              0.05   0.156 S 2          0     5    95     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>              0.05              0.05   0.156 S 2          0     5    95     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>              0.05              0.05   0.156 S 2          0     5    95     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>              0.05              0.05   0.156 S 2          0     5    92     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>              0.05              0.05   0.261 S 3          0     5    95     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>              0.05              0.05   0.261 S 3          0     5    95     0</span></span>
<span><span class="co">## <span style="color: #949494;"># â€¦ with 3,990 more rows, and 6 more variables: p &lt;dbl&gt;, n &lt;dbl&gt;, P &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   N &lt;dbl&gt;, prob_type &lt;chr&gt;, method &lt;chr&gt;</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="true-positive-rate---p---tpp">True positive rate - P - TP/P<a class="anchor" aria-label="anchor" href="#true-positive-rate---p---tpp"></a>
</h2>
<p>When comparing bootstrap method against the poisson.test benchmark
test, we find that they perform mostly similar from a 0.05 - 0.3 ratio
of under-reporting sites. Its performance is still acceptable from a 0.3
- 0.5 ratio and then becomes pretty useless.</p>
<p>As expected detection of under-reporting sites is close too
impossible when the ae/visit ratio is very low (0.05) with detection
rates close to zero for all tested scenarios.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">df_plot</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> tp_P_ratio <span class="op">=</span> <span class="va">tp</span><span class="op">/</span><span class="va">P</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ae_per_visit_mean</span>, <span class="va">frac_site_with_ur</span>, <span class="va">ur_rate</span>, <span class="va">tp_P_ratio</span>, <span class="va">method</span>, <span class="va">prob_type</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">round</span>, <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"ptest"</span> <span class="op">&amp;</span> <span class="va">prob_type</span> <span class="op">==</span> <span class="st">"unadjusted"</span> <span class="op">~</span> <span class="st">"ptest unadjusted"</span>,</span>
<span>                           <span class="va">method</span> <span class="op">==</span> <span class="st">"ptest"</span> <span class="op">&amp;</span> <span class="va">prob_type</span> <span class="op">==</span> <span class="st">"adjusted"</span> <span class="op">~</span> <span class="st">"ptest adjusted"</span>,</span>
<span>                           <span class="va">method</span> <span class="op">==</span> <span class="st">"bootstrap"</span> <span class="op">&amp;</span> <span class="va">prob_type</span> <span class="op">==</span> <span class="st">"unadjusted"</span> <span class="op">~</span> <span class="st">"bootstrap unadjusted"</span>,</span>
<span>                           <span class="va">method</span> <span class="op">==</span> <span class="st">"bootstrap"</span> <span class="op">&amp;</span> <span class="va">prob_type</span> <span class="op">==</span> <span class="st">"adjusted"</span> <span class="op">~</span> <span class="st">"bootstrap adjusted"</span><span class="op">)</span>,</span>
<span>         metric <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">metric</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ptest unadjusted"</span>, <span class="st">"ptest adjusted"</span>,</span>
<span>                                        <span class="st">"bootstrap unadjusted"</span>, <span class="st">"bootstrap adjusted"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">ae_per_visit_mean</span>, <span class="va">tp_P_ratio</span>, color <span class="op">=</span> <span class="va">metric</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">prob_type</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span> <span class="va">frac_site_with_ur</span> <span class="op">~</span> <span class="va">ur_rate</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dodgerblue3"</span>, <span class="st">"skyblue1"</span>, <span class="st">"sienna4"</span>, <span class="st">"peru"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>          axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"AE Under Reporting Rate ~ Rate of AE Under-Reporting Sites"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"True positive rate - tp/P"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"AEs per Visit"</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="usability_limits_files/figure-html/unnamed-chunk-10-1.png" width="960"></p>
</div>
<div class="section level2">
<h2 id="false-positive-rate-fpn">False positive rate FP/N<a class="anchor" aria-label="anchor" href="#false-positive-rate-fpn"></a>
</h2>
<p>We can show that adjusting the AE under-reporting probability for the
expected number of false positives is quite effective.As the false
positive rate is almost zero for all tested scenarios. However, this
also comes at a cost lowering the true positive rate as well.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">df_plot</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> fpr <span class="op">=</span> <span class="va">fp</span><span class="op">/</span><span class="va">N</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ae_per_visit_mean</span>, <span class="va">frac_site_with_ur</span>, <span class="va">ur_rate</span>, <span class="va">fpr</span>, <span class="va">method</span>, <span class="va">prob_type</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">round</span>, <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"ptest"</span> <span class="op">&amp;</span> <span class="va">prob_type</span> <span class="op">==</span> <span class="st">"unadjusted"</span> <span class="op">~</span> <span class="st">"ptest unadjusted"</span>,</span>
<span>                           <span class="va">method</span> <span class="op">==</span> <span class="st">"ptest"</span> <span class="op">&amp;</span> <span class="va">prob_type</span> <span class="op">==</span> <span class="st">"adjusted"</span> <span class="op">~</span> <span class="st">"ptest adjusted"</span>,</span>
<span>                           <span class="va">method</span> <span class="op">==</span> <span class="st">"bootstrap"</span> <span class="op">&amp;</span> <span class="va">prob_type</span> <span class="op">==</span> <span class="st">"unadjusted"</span> <span class="op">~</span> <span class="st">"bootstrap unadjusted"</span>,</span>
<span>                           <span class="va">method</span> <span class="op">==</span> <span class="st">"bootstrap"</span> <span class="op">&amp;</span> <span class="va">prob_type</span> <span class="op">==</span> <span class="st">"adjusted"</span> <span class="op">~</span> <span class="st">"bootstrap adjusted"</span><span class="op">)</span>,</span>
<span>         metric <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">metric</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ptest unadjusted"</span>, <span class="st">"ptest adjusted"</span>,</span>
<span>                                        <span class="st">"bootstrap unadjusted"</span>, <span class="st">"bootstrap adjusted"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">ae_per_visit_mean</span>, <span class="va">fpr</span>, color <span class="op">=</span> <span class="va">metric</span>, linetype <span class="op">=</span> <span class="va">prob_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span> <span class="va">frac_site_with_ur</span> <span class="op">~</span> <span class="va">ur_rate</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dodgerblue3"</span>, <span class="st">"skyblue1"</span>, <span class="st">"sienna4"</span>, <span class="st">"peru"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>          axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"AE Under Reporting Rate by Rate of AE Under-Reporting Sites"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"False positive rate - fp/N"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"AEs per Visit"</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="usability_limits_files/figure-html/unnamed-chunk-11-1.png" width="960"></p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>As already outlined in the <a href="https://openpharma.github.io/simaerep/articles/intro.html#advantage-over-classic-statistical-tests">introduction</a>
the true AE generating process is unlikely to be a standard poisson
process. Therefore using a non-parametric test remains our recommended
option unless that there is a reason to believe that 50% or more of all
sites are under-reporting AEs. We also show that it is important to
adjust for the expected false positive rate when calculating the final
probabilities.</p>
<p>In general we can say that we do not recommend any method for
detecting AE under-reporting that involves comparing AE counts if the ae
per visit rate is 0.05 or lower.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

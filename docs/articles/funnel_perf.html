<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Comparing {simaerep} and Funnel Plot Performance • simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparing {simaerep} and Funnel Plot Performance">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simaerep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/intro.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/inframe.html">Inframe Simulation Using Table Operations</a></li>
    <li><a class="dropdown-item" href="../articles/over.html">Over-Reporting Probability</a></li>
    <li><a class="dropdown-item" href="../articles/performance.html">Statistical Performance</a></li>
    <li><a class="dropdown-item" href="../articles/funnel_perf.html">Comparing {simaerep} and Funnel Plot Performance</a></li>
    <li><a class="dropdown-item" href="../articles/sas_files.html">SAS Files as a Data Source</a></li>
    <li><a class="dropdown-item" href="../articles/portfolio_perf.html">(superseded) simaerep Portfolio Performance</a></li>
    <li><a class="dropdown-item" href="../articles/visit_med75.html">Adjusted Evaluation Point visit_med75</a></li>
    <li><a class="dropdown-item" href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a></li>
    <li><a class="dropdown-item" href="../articles/check_poisson.html">Check Poisson Test Applicability</a></li>
    <li><a class="dropdown-item" href="../articles/visits_or_days.html">Aggregate AEs by Days or Visit?</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/simaerep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Comparing {simaerep} and Funnel Plot Performance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/HEAD/vignettes/funnel_perf.Rmd" class="external-link"><code>vignettes/funnel_perf.Rmd</code></a></small>
      <div class="d-none name"><code>funnel_perf.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="load">Load<a class="anchor" aria-label="anchor" href="#load"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/simaerep/">simaerep</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="install-gsm">Install {gsm}<a class="anchor" aria-label="anchor" href="#install-gsm"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"Gilead-BioStats/gsm@v1.9.2"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <a href="https://github.com/Gilead-BioStats/gsm/" class="external-link">{gsm}</a> R
package provides a standardized Risk Based Quality Monitoring (RBQM)
framework for clinical trials that pairs a flexible data pipeline with
robust reports. It also uses Funnel Plots to flag outliers which provide
broader tolerance limits for sites with low exposure and narrower limits
for sites with higher exposure. This method is different to the event
rate based limits we have used in previous heuristics to measure
{simaerep} performance. Funnel plots are discussed in greater detail by
<a href="https://doi.org/10.1177/2168479017738981" class="external-link">Zink et
al. 2018</a></p>
<p>One of the draw backs of using funnel plots for flagging is that they
assume that the AE rate remains constant over the course of the
study.</p>
</div>
<div class="section level2">
<h2 id="prepare-data">Prepare Data<a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h2>
<div class="section level3">
<h3 id="load-portfolio-configurations">Load Portfolio Configurations<a class="anchor" aria-label="anchor" href="#load-portfolio-configurations"></a>
</h3>
<p>We have prepared a snapshot of the AE reporting configuration of our
current portfolio. For each study we have also measured a visit-specific
AE rate which allows us to generate a synthetic portfolio with flexible
AE rates across a study.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_config</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"ae_conf_20240220.csv"</span><span class="op">)</span></span>
<span><span class="va">df_ae_rates</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"ae_rates_20240220.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_config</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="12%">
<col width="24%">
<col width="16%">
<col width="17%">
<col width="20%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">ae_per_visit_mean</th>
<th align="left">site_number</th>
<th align="right">max_visit_sd</th>
<th align="right">max_visit_mean</th>
<th align="right">n_pat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.5355339</td>
<td align="right">16.50000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4747</td>
<td align="right">0.7071068</td>
<td align="right">27.50000</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4750</td>
<td align="right">0.5000000</td>
<td align="right">19.25000</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4815</td>
<td align="right">8.3765546</td>
<td align="right">22.16667</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4816</td>
<td align="right">0.0000000</td>
<td align="right">27.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4817</td>
<td align="right">0.0000000</td>
<td align="right">31.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4818</td>
<td align="right">0.0000000</td>
<td align="right">30.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4891</td>
<td align="right">2.3804761</td>
<td align="right">22.00000</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4893</td>
<td align="right">0.0000000</td>
<td align="right">20.00000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4932</td>
<td align="right">1.0954451</td>
<td align="right">26.80000</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4941</td>
<td align="right">1.7320508</td>
<td align="right">27.00000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4942</td>
<td align="right">1.4142136</td>
<td align="right">25.00000</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4943</td>
<td align="right">0.0000000</td>
<td align="right">25.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4966</td>
<td align="right">0.0000000</td>
<td align="right">18.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4967</td>
<td align="right">0.8164966</td>
<td align="right">18.00000</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4968</td>
<td align="right">0.0000000</td>
<td align="right">24.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4969</td>
<td align="right">1.5275252</td>
<td align="right">21.33333</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4984</td>
<td align="right">1.7078251</td>
<td align="right">30.75000</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4985</td>
<td align="right">8.9087972</td>
<td align="right">21.16667</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4986</td>
<td align="right">0.5773503</td>
<td align="right">20.33333</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4988</td>
<td align="right">1.4142136</td>
<td align="right">19.00000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5079</td>
<td align="right">2.1602469</td>
<td align="right">23.00000</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5080</td>
<td align="right">0.0000000</td>
<td align="right">23.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5081</td>
<td align="right">0.0000000</td>
<td align="right">23.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5082</td>
<td align="right">1.4142136</td>
<td align="right">22.00000</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ae_rates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">cum_visit</th>
<th align="right">ae_rate</th>
<th align="right">n_pat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">1</td>
<td align="right">0.017699</td>
<td align="right">113</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">0.088496</td>
<td align="right">113</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">3</td>
<td align="right">0.230088</td>
<td align="right">113</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">4</td>
<td align="right">0.223214</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">5</td>
<td align="right">0.187500</td>
<td align="right">112</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">6</td>
<td align="right">0.196429</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">7</td>
<td align="right">0.396396</td>
<td align="right">111</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">8</td>
<td align="right">0.207207</td>
<td align="right">111</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">9</td>
<td align="right">0.216216</td>
<td align="right">111</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">10</td>
<td align="right">0.315315</td>
<td align="right">111</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">11</td>
<td align="right">0.263636</td>
<td align="right">110</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">12</td>
<td align="right">0.318182</td>
<td align="right">110</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">13</td>
<td align="right">0.345455</td>
<td align="right">110</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">14</td>
<td align="right">0.379630</td>
<td align="right">108</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">15</td>
<td align="right">0.401869</td>
<td align="right">107</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">16</td>
<td align="right">0.485981</td>
<td align="right">107</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">17</td>
<td align="right">0.383178</td>
<td align="right">107</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">18</td>
<td align="right">0.396226</td>
<td align="right">106</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">19</td>
<td align="right">0.370000</td>
<td align="right">100</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">20</td>
<td align="right">0.439560</td>
<td align="right">91</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">21</td>
<td align="right">0.369863</td>
<td align="right">73</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">22</td>
<td align="right">0.370968</td>
<td align="right">62</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">23</td>
<td align="right">0.345455</td>
<td align="right">55</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">24</td>
<td align="right">0.446809</td>
<td align="right">47</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">25</td>
<td align="right">0.292683</td>
<td align="right">41</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="simulate-portfolio">Simulate Portfolio<a class="anchor" aria-label="anchor" href="#simulate-portfolio"></a>
</h3>
<p>We generate two synthetic portfolios with no AE under-reporting
sites. One portfolio with a fixed AE rate for all visits and another one
with a flexible visit-specific AE rate.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_portf_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_portfolio.html">sim_test_data_portfolio</a></span><span class="op">(</span><span class="va">df_config</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_portf_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="10%">
<col width="21%">
<col width="14%">
<col width="15%">
<col width="17%">
<col width="8%">
<col width="7%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">ae_per_visit_mean</th>
<th align="left">site_number</th>
<th align="right">max_visit_sd</th>
<th align="right">max_visit_mean</th>
<th align="left">patnum</th>
<th align="right">visit</th>
<th align="right">n_ae</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">4</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">5</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">6</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">7</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">8</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">9</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">10</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">11</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">12</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">13</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">14</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">15</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">16</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">7</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">8</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">9</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_portf_flex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_portfolio.html">sim_test_data_portfolio</a></span><span class="op">(</span><span class="va">df_config</span>, df_ae_rates <span class="op">=</span> <span class="va">df_ae_rates</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-ae-rates">Compare AE rates<a class="anchor" aria-label="anchor" href="#compare-ae-rates"></a>
</h3>
<p>Next we confirm the different AE rates in our two synthetic
portfolios.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_rate_fix</span> <span class="op">&lt;-</span> <span class="va">df_portf_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html" class="external-link">coalesce</a></span><span class="op">(</span><span class="va">n_ae</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>, <span class="va">n_ae</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"patnum"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ae_rate</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"visit"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="st">"fix"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_rate_flex</span> <span class="op">&lt;-</span> <span class="va">df_portf_flex</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html" class="external-link">coalesce</a></span><span class="op">(</span><span class="va">n_ae</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>, <span class="va">n_ae</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"patnum"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ae_rate</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"visit"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="st">"flex"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_rate_flex</span>, <span class="va">df_rate_fix</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">ae_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">study_id</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">rate</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Average AE rates per Study"</span><span class="op">)</span></span></code></pre></div>
<p><img src="funnel_perf_files/figure-html/unnamed-chunk-3-1.png" width="960"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_rate_flex</span>, <span class="va">df_rate_fix</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">dense_rank</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">16</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">ae_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">rate</span>, color <span class="op">=</span> <span class="va">rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">study_id</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Average AE rates for Selected Studies"</span><span class="op">)</span></span></code></pre></div>
<p><img src="funnel_perf_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
<p>We can confirm that the AE rates in the “flexible” portfolio are not
constant. Moreover we see that the AE rate profile is very unique for
each study.</p>
</div>
</div>
<div class="section level2">
<h2 id="funnel-plots-gsm">Funnel Plots {gsm}<a class="anchor" aria-label="anchor" href="#funnel-plots-gsm"></a>
</h2>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>Here we demonstrate how to use the {gsm} package on our simulated
portfolios so that we can get a good visualization of the funnel
plot.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_SUBJ</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_portf</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df_portf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, siteid <span class="op">=</span> <span class="va">site_number</span>, subjid <span class="op">=</span> <span class="va">patnum</span>, timeonstudy <span class="op">=</span> <span class="va">visit</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>timeonstudy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">timeonstudy</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">siteid</span>, <span class="va">subjid</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">get_AE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_portf</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df_portf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, subjid <span class="op">=</span> <span class="va">patnum</span>, <span class="va">n_ae</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n_ae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">subjid</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_ae</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_ae <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">n_ae</span>, <span class="op">~</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dfSUBJ_fix</span> <span class="op">&lt;-</span> <span class="fu">get_SUBJ</span><span class="op">(</span><span class="va">df_portf_fix</span><span class="op">)</span></span>
<span><span class="va">dfAE_fix</span> <span class="op">&lt;-</span> <span class="fu">get_AE</span><span class="op">(</span><span class="va">df_portf_fix</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfInput</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/AE_Map_Raw.html" class="external-link">AE_Map_Raw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dfSUBJ <span class="op">=</span> <span class="va">dfSUBJ_fix</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, dfAE <span class="op">=</span> <span class="va">dfAE_fix</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dfInput</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 113 × 5</span></span></span>
<span><span class="co">##    SubjectID SiteID Exposure Count  Rate</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 0001      4746         16     5 0.312</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 0002      4746         14     3 0.214</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 0003      4747         26     6 0.231</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 0004      4747         26    11 0.423</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 0005      4750         19     5 0.263</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 0006      4750         19     5 0.263</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 0007      4750         20     6 0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 0008      4750         18     3 0.167</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 0009      4815         25     3 0.12 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 0010      4815         28     8 0.286</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 103 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfTransformed</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Transform_Rate.html" class="external-link">Transform_Rate</a></span><span class="op">(</span></span>
<span>  <span class="va">dfInput</span>,</span>
<span>  strNumeratorCol <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>  strDenominatorCol <span class="op">=</span> <span class="st">"Exposure"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">dfTransformed</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 4</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 4746            8          30  0.267</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 4747           17          52  0.327</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 4750           19          76  0.25 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 4815           40         153  0.261</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 4816            9          27  0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 4817            5          31  0.161</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 4818            9          30  0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 4891           48         151  0.318</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 4893           15          40  0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 4932           33         137  0.241</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfAnalyzed</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Analyze_NormalApprox.html" class="external-link">Analyze_NormalApprox</a></span><span class="op">(</span><span class="va">dfTransformed</span><span class="op">)</span></span>
<span><span class="va">dfAnalyzed</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 7</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric OverallMetric Factor  Score</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 4942            6          47  0.128         0.288   1.08 -<span style="color: #BB0000;">2.34</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 5166           17          95  0.179         0.288   1.08 -<span style="color: #BB0000;">2.27</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 4817            5          31  0.161         0.288   1.08 -<span style="color: #BB0000;">1.51</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 5229           12          58  0.207         0.288   1.08 -<span style="color: #BB0000;">1.32</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 4932           33         137  0.241         0.288   1.08 -<span style="color: #BB0000;">1.18</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 4986           13          58  0.224         0.288   1.08 -<span style="color: #BB0000;">1.04</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 4985           28         114  0.246         0.288   1.08 -<span style="color: #BB0000;">0.972</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 5084            4          21  0.190         0.288   1.08 -<span style="color: #BB0000;">0.954</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 5082            9          41  0.220         0.288   1.08 -<span style="color: #BB0000;">0.938</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 4969           14          60  0.233         0.288   1.08 -<span style="color: #BB0000;">0.907</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfFlagged</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Flag_NormalApprox.html" class="external-link">Flag_NormalApprox</a></span><span class="op">(</span><span class="va">dfAnalyzed</span>, vThreshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dfFlagged</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 8</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric OverallMetric Factor  Score  Flag</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 5194           66         182  0.363         0.288   1.08  2.13      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 4942            6          47  0.128         0.288   1.08 -<span style="color: #BB0000;">2.34</span>     -<span style="color: #BB0000;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 5166           17          95  0.179         0.288   1.08 -<span style="color: #BB0000;">2.27</span>     -<span style="color: #BB0000;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 4817            5          31  0.161         0.288   1.08 -<span style="color: #BB0000;">1.51</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 5229           12          58  0.207         0.288   1.08 -<span style="color: #BB0000;">1.32</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 4932           33         137  0.241         0.288   1.08 -<span style="color: #BB0000;">1.18</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 4986           13          58  0.224         0.288   1.08 -<span style="color: #BB0000;">1.04</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 4985           28         114  0.246         0.288   1.08 -<span style="color: #BB0000;">0.972</span>     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 5084            4          21  0.190         0.288   1.08 -<span style="color: #BB0000;">0.954</span>     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 5082            9          41  0.220         0.288   1.08 -<span style="color: #BB0000;">0.938</span>     0</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfSummary</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Summarize.html" class="external-link">Summarize</a></span><span class="op">(</span><span class="va">dfFlagged</span><span class="op">)</span></span>
<span><span class="va">dfSummary</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 6</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric Score  Flag</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 5194           66         182  0.363  2.13     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 5166           17          95  0.179 -<span style="color: #BB0000;">2.27</span>    -<span style="color: #BB0000;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 4942            6          47  0.128 -<span style="color: #BB0000;">2.34</span>    -<span style="color: #BB0000;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 4968           10          24  0.417  1.34     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 4988           16          39  0.410  1.62     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 5168           11          27  0.407  1.31     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 5311            8          20  0.4    1.06     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 5273           16          40  0.4    1.50     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 4893           15          40  0.375  1.16     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 5083           16          44  0.364  1.06     0</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfBounds</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Analyze_NormalApprox_PredictBounds.html" class="external-link">Analyze_NormalApprox_PredictBounds</a></span><span class="op">(</span><span class="va">dfTransformed</span>, vThreshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dfBounds</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,254 × 5</span></span></span>
<span><span class="co">##    Threshold Denominator LogDenominator Numerator  Metric</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>        -<span style="color: #BB0000;">3</span>        24.6           3.20    0.092<span style="text-decoration: underline;">7</span> 0.003<span style="text-decoration: underline;">77</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>        -<span style="color: #BB0000;">3</span>        25.2           3.23    0.189  0.007<span style="text-decoration: underline;">50</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>        -<span style="color: #BB0000;">3</span>        25.9           3.25    0.287  0.011<span style="text-decoration: underline;">1</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>        -<span style="color: #BB0000;">3</span>        26.5           3.28    0.386  0.014<span style="text-decoration: underline;">5</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>        -<span style="color: #BB0000;">3</span>        27.2           3.30    0.485  0.017<span style="text-decoration: underline;">9</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>        -<span style="color: #BB0000;">3</span>        27.8           3.33    0.586  0.021<span style="text-decoration: underline;">1</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>        -<span style="color: #BB0000;">3</span>        28.5           3.35    0.688  0.024<span style="text-decoration: underline;">2</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>        -<span style="color: #BB0000;">3</span>        29.2           3.37    0.792  0.027<span style="text-decoration: underline;">2</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>        -<span style="color: #BB0000;">3</span>        29.8           3.39    0.895  0.030<span style="text-decoration: underline;">0</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>        -<span style="color: #BB0000;">3</span>        30.5           3.42    1.00   0.032<span style="text-decoration: underline;">8</span> </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1,244 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chart</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Visualize_Scatter.html" class="external-link">Visualize_Scatter</a></span><span class="op">(</span><span class="va">dfFlagged</span>, <span class="va">dfBounds</span><span class="op">)</span></span>
<span><span class="va">chart</span></span></code></pre></div>
<p><img src="funnel_perf_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="simulate-ur">Simulate UR<a class="anchor" aria-label="anchor" href="#simulate-ur"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="ur-funnel">UR Funnel<a class="anchor" aria-label="anchor" href="#ur-funnel"></a>
</h2>
<p>We write out own funnel function as adapted from {gsm}</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">funnel_ur</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">site</span>, <span class="va">ur_rate</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">visit</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">visit</span><span class="op">)</span>, .by <span class="op">=</span> <span class="va">patnum</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>      Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">n_ae</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">visit</span><span class="op">)</span>,</span>
<span>      n_ae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>,</span>
<span>      visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">visit</span><span class="op">)</span>,</span>
<span>      .by <span class="op">=</span> <span class="st">"site_number"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      n_ae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">site_number</span> <span class="op">==</span> <span class="va">site</span>, <span class="va">n_ae</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ur_rate</span><span class="op">)</span>, <span class="va">n_ae</span><span class="op">)</span>,</span>
<span>      Metric <span class="op">=</span> <span class="va">n_ae</span> <span class="op">/</span> <span class="va">visit</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>          vMu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">n_ae</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">visit</span><span class="op">)</span>,</span>
<span>          z_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">vMu</span> <span class="op">==</span> <span class="fl">0</span>,</span>
<span>            <span class="fl">0</span>,</span>
<span>            <span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Metric</span> <span class="op">-</span> <span class="va">.data</span><span class="op">$</span><span class="va">vMu</span><span class="op">)</span> <span class="op">/</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">vMu</span> <span class="op">/</span> <span class="va">.data</span><span class="op">$</span><span class="va">visit</span><span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>          phi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">z_0</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>          z_i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">vMu</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">.data</span><span class="op">$</span><span class="va">phi</span> <span class="op">==</span> <span class="fl">0</span>,</span>
<span>            <span class="fl">0</span>,</span>
<span>            <span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">Metric</span> <span class="op">-</span> <span class="va">.data</span><span class="op">$</span><span class="va">vMu</span><span class="op">)</span> <span class="op">/</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">phi</span> <span class="op">*</span> <span class="va">.data</span><span class="op">$</span><span class="va">vMu</span> <span class="op">/</span> <span class="va">.data</span><span class="op">$</span><span class="va">visit</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">site_number</span> <span class="op">==</span> <span class="va">site</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">z_i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sim_ur_funnel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      sites <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">site_number</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">ur</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      score <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap_dbl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">site_number</span>, <span class="va">ur_rate</span><span class="op">)</span>, <span class="va">funnel_ur</span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_sim_ur_funnel_flex</span> <span class="op">&lt;-</span> <span class="fu">sim_ur_funnel</span><span class="op">(</span><span class="va">df_portf_flex</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_ur_funnel_fix</span> <span class="op">&lt;-</span> <span class="fu">sim_ur_funnel</span><span class="op">(</span><span class="va">df_portf_fix</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="ur-simaerep">UR {simaerep}<a class="anchor" aria-label="anchor" href="#ur-simaerep"></a>
</h2>
<p>We simulate under-reporting for both portfolios using {simaerep}
using <code><a href="../reference/sim_ur_scenarios.html">sim_ur_scenarios()</a></code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_simaerep_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_ur_scenarios.html">sim_ur_scenarios</a></span><span class="op">(</span></span>
<span>   <span class="va">df_portf_fix</span>,</span>
<span>   extra_ur_sites <span class="op">=</span> <span class="fl">0</span>,</span>
<span>   ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>   parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   poisson <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_simaerep_flex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_ur_scenarios.html">sim_ur_scenarios</a></span><span class="op">(</span></span>
<span>   <span class="va">df_portf_flex</span>,</span>
<span>   extra_ur_sites <span class="op">=</span> <span class="fl">0</span>,</span>
<span>   ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>   parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   poisson <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="evaluate">Evaluate<a class="anchor" aria-label="anchor" href="#evaluate"></a>
</h2>
<div class="section level3">
<h3 id="combine-results">Combine Results<a class="anchor" aria-label="anchor" href="#combine-results"></a>
</h3>
<p>As the funnel plot score does not use multiplicity correction, we
also compare the funnel plot score against the {simaerep} score w/o
multiplicity correction.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_simaerep_fix</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: fix"</span></span>
<span><span class="va">df_sim_simaerep_flex</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: flexible"</span></span>
<span><span class="va">df_sim_ur_funnel_fix</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: fix"</span></span>
<span><span class="va">df_sim_ur_funnel_flex</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: flexible"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">df_sim_fun_thresh2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_sim_ur_funnel_fix</span>, <span class="va">df_sim_ur_funnel_flex</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"funnel"</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ae_rate</span>, <span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">ur_rate</span>, <span class="va">score</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_sim_simaerep_threshp95</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_sim_simaerep_fix</span>, <span class="va">df_sim_simaerep_flex</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"{simaerep}"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ae_rate</span>, <span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">ur_rate</span>, score <span class="op">=</span> <span class="va">prob_low_prob_ur</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_sim_simaerep_threshp95_no_mult</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_sim_simaerep_fix</span>, <span class="va">df_sim_simaerep_flex</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"{simaerep} no mult"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    score <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">prob_low</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ae_rate</span>, <span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">ur_rate</span>, <span class="va">score</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">df_sim_simaerep_threshp95</span>,</span>
<span>  <span class="va">df_sim_simaerep_threshp95_no_mult</span>,</span>
<span>  <span class="va">df_sim_fun_thresh2</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="auc">AUC<a class="anchor" aria-label="anchor" href="#auc"></a>
</h3>
<p>We continue by comparing the ROC-AUC.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_roc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_ur</span>, <span class="va">df_nr</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_ur</span>, <span class="va">df_nr</span><span class="op">)</span> </span>
<span>  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">df</span>, response <span class="op">=</span> <span class="st">"is_ur"</span>, predictor <span class="op">=</span> <span class="st">"score"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># use 0 scenario to mix with ur scenario and calculate auc from scores</span></span>
<span><span class="va">df_nr</span> <span class="op">&lt;-</span> <span class="va">df_eval</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_ur <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span> <span class="va">ur_rate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">study_id</span>, <span class="va">ae_rate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>data_nr <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  </span>
<span></span>
<span><span class="va">df_ur</span> <span class="op">&lt;-</span> <span class="va">df_eval</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_ur <span class="op">=</span> <span class="st">"yes"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">study_id</span>, <span class="va">ur_rate</span>, <span class="va">ae_rate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>data_ur <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_auc</span> <span class="op">&lt;-</span> <span class="va">df_ur</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">df_nr</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"study_id"</span>, <span class="st">"ae_rate"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    roc <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">data_ur</span>, <span class="va">data_nr</span>, <span class="va">get_roc</span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    auc <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">roc</span>, <span class="fu">pROC</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/pROC/man/auc.html" class="external-link">auc</a></span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">study_id</span>, <span class="va">ur_rate</span>, <span class="va">ae_rate</span>, <span class="va">roc</span>, <span class="va">auc</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="table">Table<a class="anchor" aria-label="anchor" href="#table"></a>
</h4>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_auc</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    sd_auc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span>,</span>
<span>    auc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ur_rate</span>, <span class="va">ae_rate</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digit <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">type</th>
<th align="right">ur_rate</th>
<th align="left">ae_rate</th>
<th align="right">sd_auc</th>
<th align="right">auc</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">{simaerep}</td>
<td align="right">0.10</td>
<td align="left">AE rate: fix</td>
<td align="right">0.108</td>
<td align="right">0.630</td>
</tr>
<tr class="even">
<td align="left">{simaerep}</td>
<td align="right">0.25</td>
<td align="left">AE rate: fix</td>
<td align="right">0.163</td>
<td align="right">0.754</td>
</tr>
<tr class="odd">
<td align="left">{simaerep}</td>
<td align="right">0.50</td>
<td align="left">AE rate: fix</td>
<td align="right">0.161</td>
<td align="right">0.863</td>
</tr>
<tr class="even">
<td align="left">{simaerep}</td>
<td align="right">0.75</td>
<td align="left">AE rate: fix</td>
<td align="right">0.130</td>
<td align="right">0.920</td>
</tr>
<tr class="odd">
<td align="left">{simaerep}</td>
<td align="right">1.00</td>
<td align="left">AE rate: fix</td>
<td align="right">0.111</td>
<td align="right">0.938</td>
</tr>
<tr class="even">
<td align="left">{simaerep}</td>
<td align="right">0.10</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.114</td>
<td align="right">0.629</td>
</tr>
<tr class="odd">
<td align="left">{simaerep}</td>
<td align="right">0.25</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.166</td>
<td align="right">0.754</td>
</tr>
<tr class="even">
<td align="left">{simaerep}</td>
<td align="right">0.50</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.161</td>
<td align="right">0.862</td>
</tr>
<tr class="odd">
<td align="left">{simaerep}</td>
<td align="right">0.75</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.127</td>
<td align="right">0.923</td>
</tr>
<tr class="even">
<td align="left">{simaerep}</td>
<td align="right">1.00</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.108</td>
<td align="right">0.943</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} no mult</td>
<td align="right">0.10</td>
<td align="left">AE rate: fix</td>
<td align="right">0.062</td>
<td align="right">0.662</td>
</tr>
<tr class="even">
<td align="left">{simaerep} no mult</td>
<td align="right">0.25</td>
<td align="left">AE rate: fix</td>
<td align="right">0.090</td>
<td align="right">0.814</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} no mult</td>
<td align="right">0.50</td>
<td align="left">AE rate: fix</td>
<td align="right">0.071</td>
<td align="right">0.930</td>
</tr>
<tr class="even">
<td align="left">{simaerep} no mult</td>
<td align="right">0.75</td>
<td align="left">AE rate: fix</td>
<td align="right">0.043</td>
<td align="right">0.973</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} no mult</td>
<td align="right">1.00</td>
<td align="left">AE rate: fix</td>
<td align="right">0.040</td>
<td align="right">0.980</td>
</tr>
<tr class="even">
<td align="left">{simaerep} no mult</td>
<td align="right">0.10</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.068</td>
<td align="right">0.666</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} no mult</td>
<td align="right">0.25</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.096</td>
<td align="right">0.819</td>
</tr>
<tr class="even">
<td align="left">{simaerep} no mult</td>
<td align="right">0.50</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.074</td>
<td align="right">0.932</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} no mult</td>
<td align="right">0.75</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.047</td>
<td align="right">0.972</td>
</tr>
<tr class="even">
<td align="left">{simaerep} no mult</td>
<td align="right">1.00</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.043</td>
<td align="right">0.978</td>
</tr>
<tr class="odd">
<td align="left">funnel</td>
<td align="right">0.10</td>
<td align="left">AE rate: fix</td>
<td align="right">0.082</td>
<td align="right">0.672</td>
</tr>
<tr class="even">
<td align="left">funnel</td>
<td align="right">0.25</td>
<td align="left">AE rate: fix</td>
<td align="right">0.097</td>
<td align="right">0.827</td>
</tr>
<tr class="odd">
<td align="left">funnel</td>
<td align="right">0.50</td>
<td align="left">AE rate: fix</td>
<td align="right">0.069</td>
<td align="right">0.937</td>
</tr>
<tr class="even">
<td align="left">funnel</td>
<td align="right">0.75</td>
<td align="left">AE rate: fix</td>
<td align="right">0.042</td>
<td align="right">0.975</td>
</tr>
<tr class="odd">
<td align="left">funnel</td>
<td align="right">1.00</td>
<td align="left">AE rate: fix</td>
<td align="right">0.028</td>
<td align="right">0.988</td>
</tr>
<tr class="even">
<td align="left">funnel</td>
<td align="right">0.10</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.058</td>
<td align="right">0.631</td>
</tr>
<tr class="odd">
<td align="left">funnel</td>
<td align="right">0.25</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.084</td>
<td align="right">0.775</td>
</tr>
<tr class="even">
<td align="left">funnel</td>
<td align="right">0.50</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.072</td>
<td align="right">0.908</td>
</tr>
<tr class="odd">
<td align="left">funnel</td>
<td align="right">0.75</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.044</td>
<td align="right">0.962</td>
</tr>
<tr class="even">
<td align="left">funnel</td>
<td align="right">1.00</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.029</td>
<td align="right">0.983</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="plot">Plot<a class="anchor" aria-label="anchor" href="#plot"></a>
</h4>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_auc</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">auc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">ae_rate</span> <span class="op">~</span> <span class="va">ur_rate</span><span class="op">)</span>  <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="funnel_perf_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="metrics">Metrics<a class="anchor" aria-label="anchor" href="#metrics"></a>
</h3>
<div class="section level4">
<h4 id="thresholds">Thresholds<a class="anchor" aria-label="anchor" href="#thresholds"></a>
</h4>
<p>We set the thresholds for funnel and simaerep w/o multiplicity
correction so that we get the same fpr as for simaerep with multiplicity
correction and the established threshold of 0.95</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thresh_default</span> <span class="op">&lt;-</span> <span class="fl">0.95</span></span>
<span></span>
<span><span class="va">target_fpr</span> <span class="op">&lt;-</span> <span class="va">df_eval</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"{simaerep}"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>fpr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">score</span> <span class="op">&gt;=</span> <span class="va">thresh_default</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">fpr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">thresh_no_mult</span> <span class="op">&lt;-</span>  <span class="va">df_eval</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"{simaerep} no mult"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">target_fpr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">thresh_funnel</span> <span class="op">&lt;-</span> <span class="va">df_eval</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"funnel"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">target_fpr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">target_fpr</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.0005309081</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thresh_no_mult</span></span></code></pre></div>
<pre><code><span><span class="co">## 99.94691% </span></span>
<span><span class="co">##     0.999</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thresh_funnel</span></span></code></pre></div>
<pre><code><span><span class="co">## 0.05309081% </span></span>
<span><span class="co">##   -2.979981</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="aggregate">Aggregate<a class="anchor" aria-label="anchor" href="#aggregate"></a>
</h4>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_prop_test_ci95</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">ix</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">ix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">aggr_results</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_eval</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">df_perf</span> <span class="op">&lt;-</span> <span class="va">df_eval</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      is_ur <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">type</span> <span class="op">==</span> <span class="st">"{simaerep}"</span> <span class="op">~</span> <span class="va">score</span> <span class="op">&gt;=</span> <span class="va">thresh_default</span>,</span>
<span>        <span class="va">type</span> <span class="op">==</span> <span class="st">"{simaerep} no mult"</span> <span class="op">~</span> <span class="va">score</span> <span class="op">&gt;=</span> <span class="va">thresh_no_mult</span>,</span>
<span>        <span class="va">type</span> <span class="op">==</span> <span class="st">"funnel"</span> <span class="op">~</span> <span class="va">score</span> <span class="op">&lt;=</span> <span class="va">thresh_funnel</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>      n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ae_rate</span>, <span class="va">ur_rate</span>, <span class="va">is_ur</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>      names_from <span class="op">=</span> <span class="va">is_ur</span>,</span>
<span>      values_from <span class="op">=</span> <span class="va">n</span>,</span>
<span>      names_prefix <span class="op">=</span> <span class="st">"is_ur_"</span>,</span>
<span>      values_fill <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      n_sites <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">+</span> <span class="va">is_ur_FALSE</span>,</span>
<span>      ratio <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">/</span> <span class="va">n_sites</span>,</span>
<span>      ratio_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"fpr"</span>, <span class="st">"tpr"</span><span class="op">)</span>,</span>
<span>      ci95_low <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span>, <span class="op">~</span> <span class="fu">get_prop_test_ci95</span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span>, ix <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      ci95_high <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span>, <span class="op">~</span> <span class="fu">get_prop_test_ci95</span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span>, ix <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="va">df_perf</span> <span class="op">&lt;-</span> <span class="fu">aggr_results</span><span class="op">(</span><span class="va">df_eval</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="table-1">Table<a class="anchor" aria-label="anchor" href="#table-1"></a>
</h4>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_perf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="16%">
<col width="15%">
<col width="7%">
<col width="10%">
<col width="9%">
<col width="7%">
<col width="6%">
<col width="9%">
<col width="7%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">type</th>
<th align="left">ae_rate</th>
<th align="right">ur_rate</th>
<th align="right">is_ur_FALSE</th>
<th align="right">is_ur_TRUE</th>
<th align="right">n_sites</th>
<th align="right">ratio</th>
<th align="left">ratio_type</th>
<th align="right">ci95_low</th>
<th align="right">ci95_high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">{simaerep}</td>
<td align="left">AE rate: fix</td>
<td align="right">0.00</td>
<td align="right">21651</td>
<td align="right">10</td>
<td align="right">21661</td>
<td align="right">0.0005</td>
<td align="left">fpr</td>
<td align="right">0.0002</td>
<td align="right">0.0009</td>
</tr>
<tr class="even">
<td align="left">{simaerep}</td>
<td align="left">AE rate: fix</td>
<td align="right">0.10</td>
<td align="right">21584</td>
<td align="right">77</td>
<td align="right">21661</td>
<td align="right">0.0036</td>
<td align="left">tpr</td>
<td align="right">0.0028</td>
<td align="right">0.0045</td>
</tr>
<tr class="odd">
<td align="left">{simaerep}</td>
<td align="left">AE rate: fix</td>
<td align="right">0.25</td>
<td align="right">20581</td>
<td align="right">1080</td>
<td align="right">21661</td>
<td align="right">0.0499</td>
<td align="left">tpr</td>
<td align="right">0.0470</td>
<td align="right">0.0529</td>
</tr>
<tr class="even">
<td align="left">{simaerep}</td>
<td align="left">AE rate: fix</td>
<td align="right">0.50</td>
<td align="right">15956</td>
<td align="right">5705</td>
<td align="right">21661</td>
<td align="right">0.2634</td>
<td align="left">tpr</td>
<td align="right">0.2575</td>
<td align="right">0.2693</td>
</tr>
<tr class="odd">
<td align="left">{simaerep}</td>
<td align="left">AE rate: fix</td>
<td align="right">0.75</td>
<td align="right">11018</td>
<td align="right">10643</td>
<td align="right">21661</td>
<td align="right">0.4913</td>
<td align="left">tpr</td>
<td align="right">0.4847</td>
<td align="right">0.4980</td>
</tr>
<tr class="even">
<td align="left">{simaerep}</td>
<td align="left">AE rate: fix</td>
<td align="right">1.00</td>
<td align="right">8492</td>
<td align="right">13169</td>
<td align="right">21661</td>
<td align="right">0.6080</td>
<td align="left">tpr</td>
<td align="right">0.6014</td>
<td align="right">0.6145</td>
</tr>
<tr class="odd">
<td align="left">{simaerep}</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.00</td>
<td align="right">21648</td>
<td align="right">13</td>
<td align="right">21661</td>
<td align="right">0.0006</td>
<td align="left">fpr</td>
<td align="right">0.0003</td>
<td align="right">0.0011</td>
</tr>
<tr class="even">
<td align="left">{simaerep}</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.10</td>
<td align="right">21535</td>
<td align="right">126</td>
<td align="right">21661</td>
<td align="right">0.0058</td>
<td align="left">tpr</td>
<td align="right">0.0049</td>
<td align="right">0.0069</td>
</tr>
<tr class="odd">
<td align="left">{simaerep}</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.25</td>
<td align="right">20348</td>
<td align="right">1313</td>
<td align="right">21661</td>
<td align="right">0.0606</td>
<td align="left">tpr</td>
<td align="right">0.0575</td>
<td align="right">0.0639</td>
</tr>
<tr class="even">
<td align="left">{simaerep}</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.50</td>
<td align="right">15435</td>
<td align="right">6226</td>
<td align="right">21661</td>
<td align="right">0.2874</td>
<td align="left">tpr</td>
<td align="right">0.2814</td>
<td align="right">0.2935</td>
</tr>
<tr class="odd">
<td align="left">{simaerep}</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.75</td>
<td align="right">10511</td>
<td align="right">11150</td>
<td align="right">21661</td>
<td align="right">0.5148</td>
<td align="left">tpr</td>
<td align="right">0.5081</td>
<td align="right">0.5214</td>
</tr>
<tr class="even">
<td align="left">{simaerep}</td>
<td align="left">AE rate: flexible</td>
<td align="right">1.00</td>
<td align="right">8085</td>
<td align="right">13576</td>
<td align="right">21661</td>
<td align="right">0.6267</td>
<td align="left">tpr</td>
<td align="right">0.6203</td>
<td align="right">0.6332</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: fix</td>
<td align="right">0.00</td>
<td align="right">21641</td>
<td align="right">20</td>
<td align="right">21661</td>
<td align="right">0.0009</td>
<td align="left">fpr</td>
<td align="right">0.0006</td>
<td align="right">0.0015</td>
</tr>
<tr class="even">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: fix</td>
<td align="right">0.10</td>
<td align="right">21531</td>
<td align="right">130</td>
<td align="right">21661</td>
<td align="right">0.0060</td>
<td align="left">tpr</td>
<td align="right">0.0050</td>
<td align="right">0.0071</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: fix</td>
<td align="right">0.25</td>
<td align="right">20255</td>
<td align="right">1406</td>
<td align="right">21661</td>
<td align="right">0.0649</td>
<td align="left">tpr</td>
<td align="right">0.0617</td>
<td align="right">0.0683</td>
</tr>
<tr class="even">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: fix</td>
<td align="right">0.50</td>
<td align="right">15130</td>
<td align="right">6531</td>
<td align="right">21661</td>
<td align="right">0.3015</td>
<td align="left">tpr</td>
<td align="right">0.2954</td>
<td align="right">0.3077</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: fix</td>
<td align="right">0.75</td>
<td align="right">9923</td>
<td align="right">11738</td>
<td align="right">21661</td>
<td align="right">0.5419</td>
<td align="left">tpr</td>
<td align="right">0.5352</td>
<td align="right">0.5485</td>
</tr>
<tr class="even">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: fix</td>
<td align="right">1.00</td>
<td align="right">7471</td>
<td align="right">14190</td>
<td align="right">21661</td>
<td align="right">0.6551</td>
<td align="left">tpr</td>
<td align="right">0.6487</td>
<td align="right">0.6614</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.00</td>
<td align="right">21635</td>
<td align="right">26</td>
<td align="right">21661</td>
<td align="right">0.0012</td>
<td align="left">fpr</td>
<td align="right">0.0008</td>
<td align="right">0.0018</td>
</tr>
<tr class="even">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.10</td>
<td align="right">21479</td>
<td align="right">182</td>
<td align="right">21661</td>
<td align="right">0.0084</td>
<td align="left">tpr</td>
<td align="right">0.0072</td>
<td align="right">0.0097</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.25</td>
<td align="right">20015</td>
<td align="right">1646</td>
<td align="right">21661</td>
<td align="right">0.0760</td>
<td align="left">tpr</td>
<td align="right">0.0725</td>
<td align="right">0.0796</td>
</tr>
<tr class="even">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.50</td>
<td align="right">14490</td>
<td align="right">7171</td>
<td align="right">21661</td>
<td align="right">0.3311</td>
<td align="left">tpr</td>
<td align="right">0.3248</td>
<td align="right">0.3374</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.75</td>
<td align="right">9488</td>
<td align="right">12173</td>
<td align="right">21661</td>
<td align="right">0.5620</td>
<td align="left">tpr</td>
<td align="right">0.5553</td>
<td align="right">0.5686</td>
</tr>
<tr class="even">
<td align="left">{simaerep} no mult</td>
<td align="left">AE rate: flexible</td>
<td align="right">1.00</td>
<td align="right">7123</td>
<td align="right">14538</td>
<td align="right">21661</td>
<td align="right">0.6712</td>
<td align="left">tpr</td>
<td align="right">0.6649</td>
<td align="right">0.6774</td>
</tr>
<tr class="odd">
<td align="left">funnel</td>
<td align="left">AE rate: fix</td>
<td align="right">0.00</td>
<td align="right">21654</td>
<td align="right">7</td>
<td align="right">21661</td>
<td align="right">0.0003</td>
<td align="left">fpr</td>
<td align="right">0.0001</td>
<td align="right">0.0007</td>
</tr>
<tr class="even">
<td align="left">funnel</td>
<td align="left">AE rate: fix</td>
<td align="right">0.10</td>
<td align="right">21561</td>
<td align="right">100</td>
<td align="right">21661</td>
<td align="right">0.0046</td>
<td align="left">tpr</td>
<td align="right">0.0038</td>
<td align="right">0.0056</td>
</tr>
<tr class="odd">
<td align="left">funnel</td>
<td align="left">AE rate: fix</td>
<td align="right">0.25</td>
<td align="right">19908</td>
<td align="right">1753</td>
<td align="right">21661</td>
<td align="right">0.0809</td>
<td align="left">tpr</td>
<td align="right">0.0773</td>
<td align="right">0.0847</td>
</tr>
<tr class="even">
<td align="left">funnel</td>
<td align="left">AE rate: fix</td>
<td align="right">0.50</td>
<td align="right">14432</td>
<td align="right">7229</td>
<td align="right">21661</td>
<td align="right">0.3337</td>
<td align="left">tpr</td>
<td align="right">0.3275</td>
<td align="right">0.3401</td>
</tr>
<tr class="odd">
<td align="left">funnel</td>
<td align="left">AE rate: fix</td>
<td align="right">0.75</td>
<td align="right">9742</td>
<td align="right">11919</td>
<td align="right">21661</td>
<td align="right">0.5503</td>
<td align="left">tpr</td>
<td align="right">0.5436</td>
<td align="right">0.5569</td>
</tr>
<tr class="even">
<td align="left">funnel</td>
<td align="left">AE rate: fix</td>
<td align="right">1.00</td>
<td align="right">6598</td>
<td align="right">15063</td>
<td align="right">21661</td>
<td align="right">0.6954</td>
<td align="left">tpr</td>
<td align="right">0.6892</td>
<td align="right">0.7015</td>
</tr>
<tr class="odd">
<td align="left">funnel</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.00</td>
<td align="right">21645</td>
<td align="right">16</td>
<td align="right">21661</td>
<td align="right">0.0007</td>
<td align="left">fpr</td>
<td align="right">0.0004</td>
<td align="right">0.0012</td>
</tr>
<tr class="even">
<td align="left">funnel</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.10</td>
<td align="right">21592</td>
<td align="right">69</td>
<td align="right">21661</td>
<td align="right">0.0032</td>
<td align="left">tpr</td>
<td align="right">0.0025</td>
<td align="right">0.0041</td>
</tr>
<tr class="odd">
<td align="left">funnel</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.25</td>
<td align="right">21076</td>
<td align="right">585</td>
<td align="right">21661</td>
<td align="right">0.0270</td>
<td align="left">tpr</td>
<td align="right">0.0249</td>
<td align="right">0.0293</td>
</tr>
<tr class="even">
<td align="left">funnel</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.50</td>
<td align="right">17908</td>
<td align="right">3753</td>
<td align="right">21661</td>
<td align="right">0.1733</td>
<td align="left">tpr</td>
<td align="right">0.1683</td>
<td align="right">0.1784</td>
</tr>
<tr class="odd">
<td align="left">funnel</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.75</td>
<td align="right">13506</td>
<td align="right">8155</td>
<td align="right">21661</td>
<td align="right">0.3765</td>
<td align="left">tpr</td>
<td align="right">0.3700</td>
<td align="right">0.3830</td>
</tr>
<tr class="even">
<td align="left">funnel</td>
<td align="left">AE rate: flexible</td>
<td align="right">1.00</td>
<td align="right">9665</td>
<td align="right">11996</td>
<td align="right">21661</td>
<td align="right">0.5538</td>
<td align="left">tpr</td>
<td align="right">0.5472</td>
<td align="right">0.5604</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="plot-1">Plot<a class="anchor" aria-label="anchor" href="#plot-1"></a>
</h4>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_perf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_perf</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">df_perf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"under-reporting rate: "</span>,  <span class="va">ur_rate</span>, <span class="st">" - "</span>, <span class="va">ratio_type</span><span class="op">)</span>,</span>
<span>           ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="st">"fpr"</span><span class="op">)</span>, <span class="st">"fpr"</span>, <span class="va">ur_rate</span><span class="op">)</span>,</span>
<span>           ae_rate <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ae_rate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ur_rate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ratio</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci95_low</span>, ymax <span class="op">=</span> <span class="va">ci95_high</span>, color <span class="op">=</span> <span class="va">type</span>, linetype <span class="op">=</span> <span class="va">ae_rate</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">ur_rate</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="st">""</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"CI95 Performance Ratio"</span>, </span>
<span>        title <span class="op">=</span> <span class="st">"{simaerep} vs Funnel-Plot Performance"</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_perf</span><span class="op">(</span><span class="va">df_perf</span><span class="op">)</span></span></code></pre></div>
<p><img src="funnel_perf_files/figure-html/plot-1.png" width="960"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<ul>
<li>Funnel plot expects constant event rates over time. Performance
decrease when event rates are flexible.</li>
<li>{simaerep} performance is unaffected by flexible event rates.</li>
<li>{simaerep} detection rates with comparable false positive rates are
greater than funnel plot detection rates when event rates are
flexible.</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>

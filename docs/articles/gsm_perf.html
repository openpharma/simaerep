<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparing {simaerep} and {gsm} Performance • simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparing {simaerep} and {gsm} Performance">
<meta property="og:description" content="simaerep">
<meta property="og:image" content="https://openpharma.github.io/simaerep/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simaerep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.3.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/sas_files.html">SAS Files as a Data Source</a>
    </li>
    <li>
      <a href="../articles/portfolio_perf.html">simaerep Portfolio Performance</a>
    </li>
    <li>
      <a href="../articles/visit_med75.html">Adjusted Evaluation Point visit_med75</a>
    </li>
    <li>
      <a href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a>
    </li>
    <li>
      <a href="../articles/check_poisson.html">Check Poisson Test Applicability</a>
    </li>
    <li>
      <a href="../articles/visits_or_days.html">Aggregate AEs by Days or Visit?</a>
    </li>
    <li>
      <a href="../articles/gsm_perf.html">Comparing {simaerep} and {gsm} Performance</a>
    </li>
    <li>
      <a href="../articles/over.html">Over-Reporting Probability</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/simaerep/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparing {simaerep} and {gsm} Performance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/HEAD/vignettes/gsm_perf.Rmd" class="external-link"><code>vignettes/gsm_perf.Rmd</code></a></small>
      <div class="hidden name"><code>gsm_perf.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="load">Load<a class="anchor" aria-label="anchor" href="#load"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/simaerep/">simaerep</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="install-gsm">Install {gsm}<a class="anchor" aria-label="anchor" href="#install-gsm"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"Gilead-BioStats/gsm"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <a href="https://github.com/Gilead-BioStats/gsm/" class="external-link">{gsm}</a> R
package provides a standardized Risk Based Quality Monitoring (RBQM)
framework for clinical trials that pairs a flexible data pipeline with
robust reports. It also uses Funnel Plots to flag outliers which provide
broader tolerance limits for sites with low exposure and narrower limits
for sites with higher exposure. This method is different to the event
rate based limits we have used in previous heuristics to measure
{simaerep} performance. Funnel plots are discussed in greater detail by
<a href="https://doi.org/10.1177/2168479017738981" class="external-link">Zink et
al. 2018</a></p>
<p>One of the draw backs of using funnel plots for flagging is that they
assume that the AE rate remains constant over the course of the
study.</p>
</div>
<div class="section level2">
<h2 id="prepare-data">Prepare Data<a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h2>
<div class="section level3">
<h3 id="load-portfolio-configurations">Load Portfolio Configurations<a class="anchor" aria-label="anchor" href="#load-portfolio-configurations"></a>
</h3>
<p>We have prepared a snapshot of the AE reporting configuration of our
current portfolio. For each study we have also measured a visit-specific
AE rate which allows us to generate a synthetic portfolio with flexible
AE rates across a study.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_config</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"ae_conf_20240220.csv"</span><span class="op">)</span></span>
<span><span class="va">df_ae_rates</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"ae_rates_20240220.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_config</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="12%">
<col width="24%">
<col width="16%">
<col width="17%">
<col width="20%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">ae_per_visit_mean</th>
<th align="left">site_number</th>
<th align="right">max_visit_sd</th>
<th align="right">max_visit_mean</th>
<th align="right">n_pat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.5355339</td>
<td align="right">16.50000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4747</td>
<td align="right">0.7071068</td>
<td align="right">27.50000</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4750</td>
<td align="right">0.5000000</td>
<td align="right">19.25000</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4815</td>
<td align="right">8.3765546</td>
<td align="right">22.16667</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4816</td>
<td align="right">0.0000000</td>
<td align="right">27.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4817</td>
<td align="right">0.0000000</td>
<td align="right">31.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4818</td>
<td align="right">0.0000000</td>
<td align="right">30.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4891</td>
<td align="right">2.3804761</td>
<td align="right">22.00000</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4893</td>
<td align="right">0.0000000</td>
<td align="right">20.00000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4932</td>
<td align="right">1.0954451</td>
<td align="right">26.80000</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4941</td>
<td align="right">1.7320508</td>
<td align="right">27.00000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4942</td>
<td align="right">1.4142136</td>
<td align="right">25.00000</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4943</td>
<td align="right">0.0000000</td>
<td align="right">25.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4966</td>
<td align="right">0.0000000</td>
<td align="right">18.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4967</td>
<td align="right">0.8164966</td>
<td align="right">18.00000</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4968</td>
<td align="right">0.0000000</td>
<td align="right">24.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4969</td>
<td align="right">1.5275252</td>
<td align="right">21.33333</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4984</td>
<td align="right">1.7078251</td>
<td align="right">30.75000</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4985</td>
<td align="right">8.9087972</td>
<td align="right">21.16667</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4986</td>
<td align="right">0.5773503</td>
<td align="right">20.33333</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4988</td>
<td align="right">1.4142136</td>
<td align="right">19.00000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5079</td>
<td align="right">2.1602469</td>
<td align="right">23.00000</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5080</td>
<td align="right">0.0000000</td>
<td align="right">23.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5081</td>
<td align="right">0.0000000</td>
<td align="right">23.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5082</td>
<td align="right">1.4142136</td>
<td align="right">22.00000</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ae_rates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">cum_visit</th>
<th align="right">ae_rate</th>
<th align="right">n_pat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">1</td>
<td align="right">0.017699</td>
<td align="right">113</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">0.088496</td>
<td align="right">113</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">3</td>
<td align="right">0.230088</td>
<td align="right">113</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">4</td>
<td align="right">0.223214</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">5</td>
<td align="right">0.187500</td>
<td align="right">112</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">6</td>
<td align="right">0.196429</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">7</td>
<td align="right">0.396396</td>
<td align="right">111</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">8</td>
<td align="right">0.207207</td>
<td align="right">111</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">9</td>
<td align="right">0.216216</td>
<td align="right">111</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">10</td>
<td align="right">0.315315</td>
<td align="right">111</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">11</td>
<td align="right">0.263636</td>
<td align="right">110</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">12</td>
<td align="right">0.318182</td>
<td align="right">110</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">13</td>
<td align="right">0.345455</td>
<td align="right">110</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">14</td>
<td align="right">0.379630</td>
<td align="right">108</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">15</td>
<td align="right">0.401869</td>
<td align="right">107</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">16</td>
<td align="right">0.485981</td>
<td align="right">107</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">17</td>
<td align="right">0.383178</td>
<td align="right">107</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">18</td>
<td align="right">0.396226</td>
<td align="right">106</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">19</td>
<td align="right">0.370000</td>
<td align="right">100</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">20</td>
<td align="right">0.439560</td>
<td align="right">91</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">21</td>
<td align="right">0.369863</td>
<td align="right">73</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">22</td>
<td align="right">0.370968</td>
<td align="right">62</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">23</td>
<td align="right">0.345455</td>
<td align="right">55</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">24</td>
<td align="right">0.446809</td>
<td align="right">47</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">25</td>
<td align="right">0.292683</td>
<td align="right">41</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="simulate-portfolio">Simulate Portfolio<a class="anchor" aria-label="anchor" href="#simulate-portfolio"></a>
</h3>
<p>We generate two synthetic portfolios with no AE under-reporting
sites. One portfolio with a fixed AE rate for all visits and another one
with a flexible visit-specific AE rate.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_portf_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_portfolio.html">sim_test_data_portfolio</a></span><span class="op">(</span><span class="va">df_config</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_portf_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="10%">
<col width="21%">
<col width="14%">
<col width="15%">
<col width="17%">
<col width="8%">
<col width="7%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">ae_per_visit_mean</th>
<th align="left">site_number</th>
<th align="right">max_visit_sd</th>
<th align="right">max_visit_mean</th>
<th align="left">patnum</th>
<th align="right">visit</th>
<th align="right">n_ae</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">6</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">8</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">9</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">10</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">11</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">12</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">13</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">6</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">8</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">9</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">10</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">11</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">12</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_portf_flex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_portfolio.html">sim_test_data_portfolio</a></span><span class="op">(</span><span class="va">df_config</span>, df_ae_rates <span class="op">=</span> <span class="va">df_ae_rates</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-ae-rates">Compare AE rates<a class="anchor" aria-label="anchor" href="#compare-ae-rates"></a>
</h3>
<p>Next we confirm the different AE rates in our two synthetic
portfolios.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_rate_fix</span> <span class="op">&lt;-</span> <span class="va">df_portf_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html" class="external-link">coalesce</a></span><span class="op">(</span><span class="va">n_ae</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>, <span class="va">n_ae</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"patnum"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ae_rate</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"visit"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="st">"fix"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_rate_flex</span> <span class="op">&lt;-</span> <span class="va">df_portf_flex</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html" class="external-link">coalesce</a></span><span class="op">(</span><span class="va">n_ae</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>, <span class="va">n_ae</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"patnum"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ae_rate</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"visit"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="st">"flex"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_rate_flex</span>, <span class="va">df_rate_fix</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">ae_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">study_id</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">rate</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Average AE rates per Study"</span><span class="op">)</span></span></code></pre></div>
<p><img src="gsm_perf_files/figure-html/unnamed-chunk-3-1.png" width="960"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_rate_flex</span>, <span class="va">df_rate_fix</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">dense_rank</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">16</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">ae_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">rate</span>, color <span class="op">=</span> <span class="va">rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">study_id</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Average AE rates for Selected Studies"</span><span class="op">)</span></span></code></pre></div>
<p><img src="gsm_perf_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
<p>We can confirm that the AE rates in the “flexible” portfolio are not
constant. Moreover we see that the AE rate profile is very unique for
each study.</p>
</div>
</div>
<div class="section level2">
<h2 id="apply-gsm">Apply {gsm}<a class="anchor" aria-label="anchor" href="#apply-gsm"></a>
</h2>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>Here we demonstrate how to use the {gsm} package on our simulated
portfolios.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_SUBJ</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_portf</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df_portf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, siteid <span class="op">=</span> <span class="va">site_number</span>, subjid <span class="op">=</span> <span class="va">patnum</span>, timeonstudy <span class="op">=</span> <span class="va">visit</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>timeonstudy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">timeonstudy</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">siteid</span>, <span class="va">subjid</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">get_AE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_portf</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df_portf_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, subjid <span class="op">=</span> <span class="va">patnum</span>, <span class="va">n_ae</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n_ae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">subjid</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_ae</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_ae <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">n_ae</span>, <span class="op">~</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dfSUBJ_fix</span> <span class="op">&lt;-</span> <span class="fu">get_SUBJ</span><span class="op">(</span><span class="va">df_portf_fix</span><span class="op">)</span></span>
<span><span class="va">dfAE_fix</span> <span class="op">&lt;-</span> <span class="fu">get_AE</span><span class="op">(</span><span class="va">df_portf_fix</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfInput</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/AE_Map_Raw.html" class="external-link">AE_Map_Raw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dfSUBJ <span class="op">=</span> <span class="va">dfSUBJ_fix</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, dfAE <span class="op">=</span> <span class="va">dfAE_fix</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dfInput</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 113 × 5</span></span></span>
<span><span class="co">##    SubjectID SiteID Exposure Count  Rate</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 0001      4746         13     8 0.615</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 0002      4746         20     5 0.25 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 0003      4747         27    10 0.370</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 0004      4747         26     9 0.346</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 0005      4750         19     7 0.368</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 0006      4750         19     4 0.211</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 0007      4750         20     3 0.15 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 0008      4750         19     3 0.158</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 0009      4815          9     4 0.444</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 0010      4815         32    12 0.375</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 103 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfTransformed</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Transform_Rate.html" class="external-link">Transform_Rate</a></span><span class="op">(</span></span>
<span>  <span class="va">dfInput</span>,</span>
<span>  strNumeratorCol <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>  strDenominatorCol <span class="op">=</span> <span class="st">"Exposure"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">dfTransformed</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 4</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 4746           13          33  0.394</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 4747           19          53  0.358</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 4750           17          77  0.221</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 4815           50         147  0.340</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 4816            6          27  0.222</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 4817           13          31  0.419</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 4818            7          30  0.233</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 4891           46         146  0.315</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 4893           14          40  0.35 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 4932           42         135  0.311</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfAnalyzed</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Analyze_NormalApprox.html" class="external-link">Analyze_NormalApprox</a></span><span class="op">(</span><span class="va">dfTransformed</span><span class="op">)</span></span>
<span><span class="va">dfAnalyzed</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 7</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric OverallMetric Factor  Score</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 5084            2          21 0.095<span style="text-decoration: underline;">2</span>         0.307   1.10 -<span style="color: #BB0000;">2.00</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 5168            8          44 0.182          0.307   1.10 -<span style="color: #BB0000;">1.71</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 4750           17          77 0.221          0.307   1.10 -<span style="color: #BB0000;">1.56</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 5080            4          23 0.174          0.307   1.10 -<span style="color: #BB0000;">1.32</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 5081            4          23 0.174          0.307   1.10 -<span style="color: #BB0000;">1.32</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 5111            6          31 0.194          0.307   1.10 -<span style="color: #BB0000;">1.30</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 5082           10          45 0.222          0.307   1.10 -<span style="color: #BB0000;">1.17</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 5311            4          20 0.2            0.307   1.10 -<span style="color: #BB0000;">0.987</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 4942           12          50 0.24           0.307   1.10 -<span style="color: #BB0000;">0.976</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 5273           10          42 0.238          0.307   1.10 -<span style="color: #BB0000;">0.920</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfFlagged</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Flag_NormalApprox.html" class="external-link">Flag_NormalApprox</a></span><span class="op">(</span><span class="va">dfAnalyzed</span>, vThreshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dfFlagged</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 8</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric OverallMetric Factor  Score  Flag</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 5084            2          21 0.095<span style="text-decoration: underline;">2</span>         0.307   1.10 -<span style="color: #BB0000;">2.00</span>     -<span style="color: #BB0000;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 5168            8          44 0.182          0.307   1.10 -<span style="color: #BB0000;">1.71</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 4750           17          77 0.221          0.307   1.10 -<span style="color: #BB0000;">1.56</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 5080            4          23 0.174          0.307   1.10 -<span style="color: #BB0000;">1.32</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 5081            4          23 0.174          0.307   1.10 -<span style="color: #BB0000;">1.32</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 5111            6          31 0.194          0.307   1.10 -<span style="color: #BB0000;">1.30</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 5082           10          45 0.222          0.307   1.10 -<span style="color: #BB0000;">1.17</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 5311            4          20 0.2            0.307   1.10 -<span style="color: #BB0000;">0.987</span>     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 4942           12          50 0.24           0.307   1.10 -<span style="color: #BB0000;">0.976</span>     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 5273           10          42 0.238          0.307   1.10 -<span style="color: #BB0000;">0.920</span>     0</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfSummary</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Summarize.html" class="external-link">Summarize</a></span><span class="op">(</span><span class="va">dfFlagged</span><span class="op">)</span></span>
<span><span class="va">dfSummary</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 6</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric  Score  Flag</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 5084            2          21 0.095<span style="text-decoration: underline;">2</span> -<span style="color: #BB0000;">2.00</span>     -<span style="color: #BB0000;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 5308           26          61 0.426   1.93      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 4817           13          31 0.419   1.30      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 4968           10          24 0.417   1.11      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 5224           10          24 0.417   1.11      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 4943           10          25 0.4     0.965     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 4746           13          33 0.394   1.04      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 5135            7          18 0.389   0.721     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 4988           14          37 0.378   0.902     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 5166           35          93 0.376   1.39      0</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfBounds</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Analyze_NormalApprox_PredictBounds.html" class="external-link">Analyze_NormalApprox_PredictBounds</a></span><span class="op">(</span><span class="va">dfTransformed</span>, vThreshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dfBounds</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,258 × 5</span></span></span>
<span><span class="co">##    Threshold Denominator LogDenominator Numerator   Metric</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>        -<span style="color: #BB0000;">3</span>        22.4           3.11   0.009<span style="text-decoration: underline;">38</span> 0.000<span style="text-decoration: underline;">419</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>        -<span style="color: #BB0000;">3</span>        23.2           3.14   0.123   0.005<span style="text-decoration: underline;">33</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>        -<span style="color: #BB0000;">3</span>        23.9           3.17   0.239   0.010<span style="text-decoration: underline;">0</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>        -<span style="color: #BB0000;">3</span>        24.6           3.20   0.356   0.014<span style="text-decoration: underline;">5</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>        -<span style="color: #BB0000;">3</span>        25.4           3.23   0.475   0.018<span style="text-decoration: underline;">7</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>        -<span style="color: #BB0000;">3</span>        26.1           3.26   0.596   0.022<span style="text-decoration: underline;">8</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>        -<span style="color: #BB0000;">3</span>        26.8           3.29   0.718   0.026<span style="text-decoration: underline;">8</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>        -<span style="color: #BB0000;">3</span>        27.6           3.32   0.841   0.030<span style="text-decoration: underline;">5</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>        -<span style="color: #BB0000;">3</span>        28.3           3.34   0.966   0.034<span style="text-decoration: underline;">1</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>        -<span style="color: #BB0000;">3</span>        29.0           3.37   1.09    0.037<span style="text-decoration: underline;">6</span>  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1,248 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chart</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Visualize_Scatter.html" class="external-link">Visualize_Scatter</a></span><span class="op">(</span><span class="va">dfFlagged</span>, <span class="va">dfBounds</span><span class="op">)</span></span>
<span><span class="va">chart</span></span></code></pre></div>
<p><img src="gsm_perf_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="simulate-ur">Simulate UR<a class="anchor" aria-label="anchor" href="#simulate-ur"></a>
</h3>
<p>We write a function that removes a given ratio of AEs from one site
in the data set and returns its z-score.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_site_ur_gsm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">site</span>, <span class="va">ur_rate</span>, <span class="va">dfTransformed</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dfTransformed</span> <span class="op">&lt;-</span> <span class="va">dfTransformed</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      Numerator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">GroupID</span> <span class="op">==</span> <span class="va">site</span>, <span class="va">Numerator</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ur_rate</span><span class="op">)</span>, <span class="va">Numerator</span><span class="op">)</span>,</span>
<span>      Metric <span class="op">=</span> <span class="va">Numerator</span> <span class="op">/</span> <span class="va">Denominator</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Analyze_NormalApprox.html" class="external-link">Analyze_NormalApprox</a></span><span class="op">(</span><span class="va">dfTransformed</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">GroupID</span> <span class="op">==</span> <span class="va">site</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Score</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">sim_site_ur_gsm</span><span class="op">(</span><span class="st">"4747"</span>, ur_rate <span class="op">=</span> <span class="fl">0.75</span>, <span class="va">dfTransformed</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -2.88228</span></span></code></pre>
<p>We write another function that systematically applies this
<code>sim_site_ur_gsm</code> across all sites in all studies across a
range of under-reporting ratios.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_ur_gsm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dfSUBJ</span>, <span class="va">dfAE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dfSUBJ</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">dfAE</span>, by <span class="op">=</span> <span class="st">"study_id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      trans <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">data.x</span>, <span class="va">data.y</span>, <span class="op">~</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/AE_Map_Raw.html" class="external-link">AE_Map_Raw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dfSUBJ <span class="op">=</span> <span class="va">.x</span>, dfAE <span class="op">=</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      trans <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">trans</span>, <span class="op">~</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Transform_Rate.html" class="external-link">Transform_Rate</a></span><span class="op">(</span><span class="va">.</span>, strNumeratorCol <span class="op">=</span> <span class="st">"Count"</span>, strDenominatorCol <span class="op">=</span> <span class="st">"Exposure"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      sites <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data.x</span>, <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">siteid</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"data."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">ur</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      score <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap_dbl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">siteid</span>, <span class="va">ur_rate</span>, <span class="va">trans</span><span class="op">)</span>, <span class="va">sim_site_ur_gsm</span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_sim_gsm_fix</span> <span class="op">&lt;-</span> <span class="fu">sim_ur_gsm</span><span class="op">(</span><span class="va">dfSUBJ_fix</span>, <span class="va">dfAE_fix</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 3095 warnings in `mutate()`.</span></span>
<span><span class="co">## The first warning was:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `z_i = ifelse(...)`.</span></span>
<span><span class="co">## Caused by warning:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> There was 1 warning in `mutate()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `z_0 = ifelse(...)`.</span></span>
<span><span class="co">## Caused by warning in `sqrt()`:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> NaNs produced</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 3094 remaining warnings.</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_gsm_fix</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 129,966 × 5</span></span></span>
<span><span class="co">##    study_id trans             siteid ur_rate  score</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      0     1.04 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      0.1   0.580</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      0.25 -<span style="color: #BB0000;">0.120</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      0.5  -<span style="color: #BB0000;">1.27</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      0.75 -<span style="color: #BB0000;">2.30</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      1    -<span style="color: #BB0000;">3.18</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4747      0     0.780</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4747      0.1   0.253</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4747      0.25 -<span style="color: #BB0000;">0.544</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4747      0.5  -<span style="color: #BB0000;">1.80</span> </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 129,956 more rows</span></span></span></code></pre>
<p>We repeat the same steps for the portfolio with the flexible AE
rates.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfSUBJ_flex</span> <span class="op">&lt;-</span> <span class="fu">get_SUBJ</span><span class="op">(</span><span class="va">df_portf_flex</span><span class="op">)</span></span>
<span><span class="va">dfAE_flex</span><span class="op">&lt;-</span> <span class="fu">get_AE</span><span class="op">(</span><span class="va">df_portf_flex</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_sim_gsm_flex</span> <span class="op">&lt;-</span> <span class="fu">sim_ur_gsm</span><span class="op">(</span><span class="va">dfSUBJ_flex</span>, <span class="va">dfAE_flex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 3004 warnings in `mutate()`.</span></span>
<span><span class="co">## The first warning was:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `z_i = ifelse(...)`.</span></span>
<span><span class="co">## Caused by warning:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> There was 1 warning in `mutate()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `z_0 = ifelse(...)`.</span></span>
<span><span class="co">## Caused by warning in `sqrt()`:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> NaNs produced</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 3003 remaining warnings.</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="ur-simaerep">UR {simaerep}<a class="anchor" aria-label="anchor" href="#ur-simaerep"></a>
</h2>
<p>We simulate under-reporting for both portfolios using {simaerep}</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_simaerep_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_ur_scenarios.html">sim_ur_scenarios</a></span><span class="op">(</span></span>
<span>   <span class="va">df_portf_fix</span>,</span>
<span>   extra_ur_sites <span class="op">=</span> <span class="fl">0</span>,</span>
<span>   ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>   parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   poisson <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_simaerep_flex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_ur_scenarios.html">sim_ur_scenarios</a></span><span class="op">(</span></span>
<span>   <span class="va">df_portf_flex</span>,</span>
<span>   extra_ur_sites <span class="op">=</span> <span class="fl">0</span>,</span>
<span>   ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>   parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   poisson <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="evaluate">Evaluate<a class="anchor" aria-label="anchor" href="#evaluate"></a>
</h2>
<div class="section level3">
<h3 id="combine-results">Combine Results<a class="anchor" aria-label="anchor" href="#combine-results"></a>
</h3>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_gsm_fix</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: fix"</span></span>
<span><span class="va">df_sim_gsm_flex</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: flexible"</span></span>
<span><span class="va">df_sim_simaerep_fix</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: fix"</span></span>
<span><span class="va">df_sim_simaerep_flex</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: flexible"</span></span>
<span></span>
<span><span class="va">df_sim_thresh2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_sim_gsm_fix</span>, <span class="va">df_sim_gsm_flex</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    is_ur <span class="op">=</span> <span class="va">score</span> <span class="op">&lt;=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"{gsm} - thresh: -2"</span>,</span>
<span>    site_number <span class="op">=</span> <span class="va">siteid</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ae_rate</span>, <span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">ur_rate</span>, <span class="va">is_ur</span>, <span class="va">score</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_sim_simaerep_threshp95</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_sim_simaerep_fix</span>, <span class="va">df_sim_simaerep_flex</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    is_ur <span class="op">=</span> <span class="va">prob_low_prob_ur</span> <span class="op">&gt;=</span> <span class="fl">0.95</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"{simaerep} - thresh: 0.95"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ae_rate</span>, <span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">ur_rate</span>, <span class="va">is_ur</span>, score <span class="op">=</span> <span class="va">prob_low_prob_ur</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">df_sim_thresh2</span>,</span>
<span>  <span class="va">df_sim_simaerep_threshp95</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="aggregate">Aggregate<a class="anchor" aria-label="anchor" href="#aggregate"></a>
</h3>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_prop_test_ci95</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">ix</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">ix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">aggr_results</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_eval</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="va">df_perf</span> <span class="op">&lt;-</span> <span class="va">df_eval</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ae_rate</span>, <span class="va">ur_rate</span>, <span class="va">is_ur</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">is_ur</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">n</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"is_ur_"</span>,</span>
<span>    values_fill <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    n_sites <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">+</span> <span class="va">is_ur_FALSE</span> <span class="op">+</span> <span class="va">is_ur_NA</span>,</span>
<span>    ratio <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">/</span> <span class="va">n_sites</span>,</span>
<span>    ratio_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"fpr"</span>, <span class="st">"tpr"</span><span class="op">)</span>,</span>
<span>    ci95_low <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span>, <span class="op">~</span> <span class="fu">get_prop_test_ci95</span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span>, ix <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    ci95_high <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span>, <span class="op">~</span> <span class="fu">get_prop_test_ci95</span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span>, ix <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_perf</span> <span class="op">&lt;-</span> <span class="fu">aggr_results</span><span class="op">(</span><span class="va">df_eval</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<div class="section level3">
<h3 id="table">Table<a class="anchor" aria-label="anchor" href="#table"></a>
</h3>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_perf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="20%">
<col width="14%">
<col width="6%">
<col width="9%">
<col width="8%">
<col width="7%">
<col width="6%">
<col width="4%">
<col width="8%">
<col width="7%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">type</th>
<th align="left">ae_rate</th>
<th align="right">ur_rate</th>
<th align="right">is_ur_FALSE</th>
<th align="right">is_ur_TRUE</th>
<th align="right">is_ur_NA</th>
<th align="right">n_sites</th>
<th align="right">ratio</th>
<th align="left">ratio_type</th>
<th align="right">ci95_low</th>
<th align="right">ci95_high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">0.00</td>
<td align="right">20823</td>
<td align="right">306</td>
<td align="right">532</td>
<td align="right">21661</td>
<td align="right">0.014</td>
<td align="left">fpr</td>
<td align="right">0.013</td>
<td align="right">0.016</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">0.10</td>
<td align="right">19868</td>
<td align="right">1262</td>
<td align="right">531</td>
<td align="right">21661</td>
<td align="right">0.058</td>
<td align="left">tpr</td>
<td align="right">0.055</td>
<td align="right">0.061</td>
</tr>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">0.25</td>
<td align="right">15878</td>
<td align="right">5258</td>
<td align="right">525</td>
<td align="right">21661</td>
<td align="right">0.243</td>
<td align="left">tpr</td>
<td align="right">0.237</td>
<td align="right">0.249</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">0.50</td>
<td align="right">9273</td>
<td align="right">11876</td>
<td align="right">512</td>
<td align="right">21661</td>
<td align="right">0.548</td>
<td align="left">tpr</td>
<td align="right">0.542</td>
<td align="right">0.555</td>
</tr>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">0.75</td>
<td align="right">5263</td>
<td align="right">15895</td>
<td align="right">503</td>
<td align="right">21661</td>
<td align="right">0.734</td>
<td align="left">tpr</td>
<td align="right">0.728</td>
<td align="right">0.740</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">1.00</td>
<td align="right">3027</td>
<td align="right">18142</td>
<td align="right">492</td>
<td align="right">21661</td>
<td align="right">0.838</td>
<td align="left">tpr</td>
<td align="right">0.833</td>
<td align="right">0.842</td>
</tr>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.00</td>
<td align="right">20886</td>
<td align="right">254</td>
<td align="right">521</td>
<td align="right">21661</td>
<td align="right">0.012</td>
<td align="left">fpr</td>
<td align="right">0.010</td>
<td align="right">0.013</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.10</td>
<td align="right">20677</td>
<td align="right">465</td>
<td align="right">519</td>
<td align="right">21661</td>
<td align="right">0.021</td>
<td align="left">tpr</td>
<td align="right">0.020</td>
<td align="right">0.024</td>
</tr>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.25</td>
<td align="right">19703</td>
<td align="right">1444</td>
<td align="right">514</td>
<td align="right">21661</td>
<td align="right">0.067</td>
<td align="left">tpr</td>
<td align="right">0.063</td>
<td align="right">0.070</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.50</td>
<td align="right">16318</td>
<td align="right">4848</td>
<td align="right">495</td>
<td align="right">21661</td>
<td align="right">0.224</td>
<td align="left">tpr</td>
<td align="right">0.218</td>
<td align="right">0.229</td>
</tr>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.75</td>
<td align="right">12281</td>
<td align="right">8896</td>
<td align="right">484</td>
<td align="right">21661</td>
<td align="right">0.411</td>
<td align="left">tpr</td>
<td align="right">0.404</td>
<td align="right">0.417</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">1.00</td>
<td align="right">8774</td>
<td align="right">12416</td>
<td align="right">471</td>
<td align="right">21661</td>
<td align="right">0.573</td>
<td align="left">tpr</td>
<td align="right">0.567</td>
<td align="right">0.580</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">0.00</td>
<td align="right">21363</td>
<td align="right">298</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.014</td>
<td align="left">fpr</td>
<td align="right">0.012</td>
<td align="right">0.015</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">0.10</td>
<td align="right">20406</td>
<td align="right">1255</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.058</td>
<td align="left">tpr</td>
<td align="right">0.055</td>
<td align="right">0.061</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">0.25</td>
<td align="right">17187</td>
<td align="right">4474</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.207</td>
<td align="left">tpr</td>
<td align="right">0.201</td>
<td align="right">0.212</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">0.50</td>
<td align="right">10660</td>
<td align="right">11001</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.508</td>
<td align="left">tpr</td>
<td align="right">0.501</td>
<td align="right">0.515</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">0.75</td>
<td align="right">5874</td>
<td align="right">15787</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.729</td>
<td align="left">tpr</td>
<td align="right">0.723</td>
<td align="right">0.735</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">1.00</td>
<td align="right">4043</td>
<td align="right">17618</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.813</td>
<td align="left">tpr</td>
<td align="right">0.808</td>
<td align="right">0.819</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.00</td>
<td align="right">21356</td>
<td align="right">305</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.014</td>
<td align="left">fpr</td>
<td align="right">0.013</td>
<td align="right">0.016</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.10</td>
<td align="right">20267</td>
<td align="right">1394</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.064</td>
<td align="left">tpr</td>
<td align="right">0.061</td>
<td align="right">0.068</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.25</td>
<td align="right">16694</td>
<td align="right">4967</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.229</td>
<td align="left">tpr</td>
<td align="right">0.224</td>
<td align="right">0.235</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.50</td>
<td align="right">9975</td>
<td align="right">11686</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.539</td>
<td align="left">tpr</td>
<td align="right">0.533</td>
<td align="right">0.546</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.75</td>
<td align="right">5404</td>
<td align="right">16257</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.751</td>
<td align="left">tpr</td>
<td align="right">0.745</td>
<td align="right">0.756</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">1.00</td>
<td align="right">3707</td>
<td align="right">17954</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.829</td>
<td align="left">tpr</td>
<td align="right">0.824</td>
<td align="right">0.834</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="plot-performance-metrics">Plot Performance Metrics<a class="anchor" aria-label="anchor" href="#plot-performance-metrics"></a>
</h3>
<ul>
<li>{gsm} has better performance than {simaerep} when the AE rate is
fixed, while {simaerep} greatly outperforms {gsm} when the AE rate is
flexible and mimics the AE rates encountered in real study data
sets.</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_perf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_perf</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">df_perf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"under-reporting rate: "</span>,  <span class="va">ur_rate</span>, <span class="st">" - "</span>, <span class="va">ratio_type</span><span class="op">)</span>,</span>
<span>           ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="st">"fpr"</span><span class="op">)</span>, <span class="st">"fpr"</span>, <span class="va">ur_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ur_rate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ratio</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci95_low</span>, ymax <span class="op">=</span> <span class="va">ci95_high</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">~</span> <span class="va">ae_rate</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="st">""</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"CI95 Performance Ratio"</span>, </span>
<span>        title <span class="op">=</span> <span class="st">"{simaerep} vs {gsm} Performance"</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#5491CC"</span>, <span class="st">"#F46626"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_perf</span><span class="op">(</span><span class="va">df_perf</span><span class="op">)</span></span></code></pre></div>
<p><img src="gsm_perf_files/figure-html/plot-1.png" width="960"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparing {simaerep} and {gsm} Performance • simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparing {simaerep} and {gsm} Performance">
<meta property="og:description" content="simaerep">
<meta property="og:image" content="https://openpharma.github.io/simaerep/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simaerep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.3.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/sas_files.html">SAS Files as a Data Source</a>
    </li>
    <li>
      <a href="../articles/portfolio_perf.html">simaerep Portfolio Performance</a>
    </li>
    <li>
      <a href="../articles/visit_med75.html">Adjusted Evaluation Point visit_med75</a>
    </li>
    <li>
      <a href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a>
    </li>
    <li>
      <a href="../articles/check_poisson.html">Check Poisson Test Applicability</a>
    </li>
    <li>
      <a href="../articles/visits_or_days.html">Aggregate AEs by Days or Visit?</a>
    </li>
    <li>
      <a href="../articles/gsm_perf.html">Comparing {simaerep} and {gsm} Performance</a>
    </li>
    <li>
      <a href="../articles/over.html">Over-Reporting Probability</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/simaerep/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparing {simaerep} and {gsm} Performance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/HEAD/vignettes/gsm_perf.Rmd" class="external-link"><code>vignettes/gsm_perf.Rmd</code></a></small>
      <div class="hidden name"><code>gsm_perf.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="load">Load<a class="anchor" aria-label="anchor" href="#load"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/simaerep/">simaerep</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="install-gsm">Install {gsm}<a class="anchor" aria-label="anchor" href="#install-gsm"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"Gilead-BioStats/gsm"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <a href="https://github.com/Gilead-BioStats/gsm/" class="external-link">{gsm}</a> R
package provides a standardized Risk Based Quality Monitoring (RBQM)
framework for clinical trials that pairs a flexible data pipeline with
robust reports. It also uses Funnel Plots to flag outliers which provide
broader tolerance limits for sites with low exposure and narrower limits
for sites with higher exposure. This method is different to the event
rate based limits we have used in previous heuristics to measure
{simaerep} performance. Funnel plots are discussed in greater detail by
<a href="https://doi.org/10.1177/2168479017738981" class="external-link">Zink et
al. 2018</a></p>
<p>One of the draw backs of using funnel plots for flagging is that they
assume that the AE rate remains constant over the course of the
study.</p>
</div>
<div class="section level2">
<h2 id="prepare-data">Prepare Data<a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h2>
<div class="section level3">
<h3 id="load-portfolio-configurations">Load Portfolio Configurations<a class="anchor" aria-label="anchor" href="#load-portfolio-configurations"></a>
</h3>
<p>We have prepared a snapshot of the AE reporting configuration of our
current portfolio. For each study we have also measured a visit-specific
AE rate which allows us to generate a synthetic portfolio with flexible
AE rates across a study.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_config</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"ae_conf_20240220.csv"</span><span class="op">)</span></span>
<span><span class="va">df_ae_rates</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"ae_rates_20240220.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_config</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="12%">
<col width="24%">
<col width="16%">
<col width="17%">
<col width="20%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">ae_per_visit_mean</th>
<th align="left">site_number</th>
<th align="right">max_visit_sd</th>
<th align="right">max_visit_mean</th>
<th align="right">n_pat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.5355339</td>
<td align="right">16.50000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4747</td>
<td align="right">0.7071068</td>
<td align="right">27.50000</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4750</td>
<td align="right">0.5000000</td>
<td align="right">19.25000</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4815</td>
<td align="right">8.3765546</td>
<td align="right">22.16667</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4816</td>
<td align="right">0.0000000</td>
<td align="right">27.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4817</td>
<td align="right">0.0000000</td>
<td align="right">31.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4818</td>
<td align="right">0.0000000</td>
<td align="right">30.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4891</td>
<td align="right">2.3804761</td>
<td align="right">22.00000</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4893</td>
<td align="right">0.0000000</td>
<td align="right">20.00000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4932</td>
<td align="right">1.0954451</td>
<td align="right">26.80000</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4941</td>
<td align="right">1.7320508</td>
<td align="right">27.00000</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4942</td>
<td align="right">1.4142136</td>
<td align="right">25.00000</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4943</td>
<td align="right">0.0000000</td>
<td align="right">25.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4966</td>
<td align="right">0.0000000</td>
<td align="right">18.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4967</td>
<td align="right">0.8164966</td>
<td align="right">18.00000</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4968</td>
<td align="right">0.0000000</td>
<td align="right">24.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4969</td>
<td align="right">1.5275252</td>
<td align="right">21.33333</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4984</td>
<td align="right">1.7078251</td>
<td align="right">30.75000</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4985</td>
<td align="right">8.9087972</td>
<td align="right">21.16667</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4986</td>
<td align="right">0.5773503</td>
<td align="right">20.33333</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4988</td>
<td align="right">1.4142136</td>
<td align="right">19.00000</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5079</td>
<td align="right">2.1602469</td>
<td align="right">23.00000</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5080</td>
<td align="right">0.0000000</td>
<td align="right">23.00000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5081</td>
<td align="right">0.0000000</td>
<td align="right">23.00000</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">5082</td>
<td align="right">1.4142136</td>
<td align="right">22.00000</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ae_rates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">cum_visit</th>
<th align="right">ae_rate</th>
<th align="right">n_pat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">1</td>
<td align="right">0.017699</td>
<td align="right">113</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">0.088496</td>
<td align="right">113</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">3</td>
<td align="right">0.230088</td>
<td align="right">113</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">4</td>
<td align="right">0.223214</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">5</td>
<td align="right">0.187500</td>
<td align="right">112</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">6</td>
<td align="right">0.196429</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">7</td>
<td align="right">0.396396</td>
<td align="right">111</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">8</td>
<td align="right">0.207207</td>
<td align="right">111</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">9</td>
<td align="right">0.216216</td>
<td align="right">111</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">10</td>
<td align="right">0.315315</td>
<td align="right">111</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">11</td>
<td align="right">0.263636</td>
<td align="right">110</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">12</td>
<td align="right">0.318182</td>
<td align="right">110</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">13</td>
<td align="right">0.345455</td>
<td align="right">110</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">14</td>
<td align="right">0.379630</td>
<td align="right">108</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">15</td>
<td align="right">0.401869</td>
<td align="right">107</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">16</td>
<td align="right">0.485981</td>
<td align="right">107</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">17</td>
<td align="right">0.383178</td>
<td align="right">107</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">18</td>
<td align="right">0.396226</td>
<td align="right">106</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">19</td>
<td align="right">0.370000</td>
<td align="right">100</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">20</td>
<td align="right">0.439560</td>
<td align="right">91</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">21</td>
<td align="right">0.369863</td>
<td align="right">73</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">22</td>
<td align="right">0.370968</td>
<td align="right">62</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">23</td>
<td align="right">0.345455</td>
<td align="right">55</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">24</td>
<td align="right">0.446809</td>
<td align="right">47</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">25</td>
<td align="right">0.292683</td>
<td align="right">41</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="simulate-portfolio">Simulate Portfolio<a class="anchor" aria-label="anchor" href="#simulate-portfolio"></a>
</h3>
<p>We generate two synthetic portfolios with no AE under-reporting
sites. One portfolio with a fixed AE rate for all visits and another one
with a flexible visit-specific AE rate.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_portf_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_portfolio.html">sim_test_data_portfolio</a></span><span class="op">(</span><span class="va">df_config</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_portf_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="10%">
<col width="21%">
<col width="14%">
<col width="15%">
<col width="17%">
<col width="8%">
<col width="7%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">ae_per_visit_mean</th>
<th align="left">site_number</th>
<th align="right">max_visit_sd</th>
<th align="right">max_visit_mean</th>
<th align="left">patnum</th>
<th align="right">visit</th>
<th align="right">n_ae</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">6</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">8</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">9</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">10</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">11</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">12</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">13</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">14</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0001</td>
<td align="right">15</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">8</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">9</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2973806</td>
<td align="left">4746</td>
<td align="right">3.535534</td>
<td align="right">16.5</td>
<td align="left">0002</td>
<td align="right">10</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_portf_flex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_portfolio.html">sim_test_data_portfolio</a></span><span class="op">(</span><span class="va">df_config</span>, df_ae_rates <span class="op">=</span> <span class="va">df_ae_rates</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-ae-rates">Compare AE rates<a class="anchor" aria-label="anchor" href="#compare-ae-rates"></a>
</h3>
<p>Next we confirm the different AE rates in our two synthetic
portfolios.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_rate_fix</span> <span class="op">&lt;-</span> <span class="va">df_portf_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html" class="external-link">coalesce</a></span><span class="op">(</span><span class="va">n_ae</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>, <span class="va">n_ae</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"patnum"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ae_rate</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"visit"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="st">"fix"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_rate_flex</span> <span class="op">&lt;-</span> <span class="va">df_portf_flex</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html" class="external-link">coalesce</a></span><span class="op">(</span><span class="va">n_ae</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>, <span class="va">n_ae</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"patnum"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ae_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ae_rate</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"visit"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="st">"flex"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_rate_flex</span>, <span class="va">df_rate_fix</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">ae_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">study_id</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">rate</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Average AE rates per Study"</span><span class="op">)</span></span></code></pre></div>
<p><img src="gsm_perf_files/figure-html/unnamed-chunk-3-1.png" width="960"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_rate_flex</span>, <span class="va">df_rate_fix</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">dense_rank</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">16</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">ae_rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">rate</span>, color <span class="op">=</span> <span class="va">rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">study_id</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Average AE rates for Selected Studies"</span><span class="op">)</span></span></code></pre></div>
<p><img src="gsm_perf_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
<p>We can confirm that the AE rates in the “flexible” portfolio are not
constant. Moreover we see that the AE rate profile is very unique for
each study.</p>
</div>
</div>
<div class="section level2">
<h2 id="apply-gsm">Apply {gsm}<a class="anchor" aria-label="anchor" href="#apply-gsm"></a>
</h2>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>Here we demonstrate how to use the {gsm} package on our simulated
portfolios.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_SUBJ</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_portf</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df_portf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, siteid <span class="op">=</span> <span class="va">site_number</span>, subjid <span class="op">=</span> <span class="va">patnum</span>, timeonstudy <span class="op">=</span> <span class="va">visit</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>timeonstudy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">timeonstudy</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">siteid</span>, <span class="va">subjid</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">get_AE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_portf</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df_portf_fix</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, subjid <span class="op">=</span> <span class="va">patnum</span>, <span class="va">n_ae</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n_ae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">subjid</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_ae</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_ae <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">n_ae</span>, <span class="op">~</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dfSUBJ_fix</span> <span class="op">&lt;-</span> <span class="fu">get_SUBJ</span><span class="op">(</span><span class="va">df_portf_fix</span><span class="op">)</span></span>
<span><span class="va">dfAE_fix</span> <span class="op">&lt;-</span> <span class="fu">get_AE</span><span class="op">(</span><span class="va">df_portf_fix</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfInput</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/AE_Map_Raw.html" class="external-link">AE_Map_Raw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dfSUBJ <span class="op">=</span> <span class="va">dfSUBJ_fix</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, dfAE <span class="op">=</span> <span class="va">dfAE_fix</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dfInput</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 113 × 5</span></span></span>
<span><span class="co">##    SubjectID SiteID Exposure Count   Rate</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 0001      4746         15     1 0.066<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 0002      4746         21     5 0.238 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 0003      4747         27     7 0.259 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 0004      4747         26     8 0.308 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 0005      4750         19     6 0.316 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 0006      4750         19     9 0.474 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 0007      4750         19     6 0.316 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 0008      4750         19     6 0.316 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 0009      4815         25     8 0.32  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 0010      4815         27     6 0.222 </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 103 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfTransformed</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Transform_Rate.html" class="external-link">Transform_Rate</a></span><span class="op">(</span></span>
<span>  <span class="va">dfInput</span>,</span>
<span>  strNumeratorCol <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>  strDenominatorCol <span class="op">=</span> <span class="st">"Exposure"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">dfTransformed</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 4</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 4746            6          36  0.167</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 4747           15          53  0.283</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 4750           27          76  0.355</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 4815           41         155  0.265</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 4816            5          27  0.185</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 4817            9          31  0.290</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 4818           14          30  0.467</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 4891           58         161  0.360</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 4893           22          40  0.55 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 4932           43         134  0.321</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfAnalyzed</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Analyze_NormalApprox.html" class="external-link">Analyze_NormalApprox</a></span><span class="op">(</span><span class="va">dfTransformed</span><span class="op">)</span></span>
<span><span class="va">dfAnalyzed</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 7</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric OverallMetric Factor  Score</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 5079           13          82 0.159          0.303   2.08 -<span style="color: #BB0000;">1.97</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 5081            2          23 0.087<span style="text-decoration: underline;">0</span>         0.303   2.08 -<span style="color: #BB0000;">1.56</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 5136            2          22 0.090<span style="text-decoration: underline;">9</span>         0.303   2.08 -<span style="color: #BB0000;">1.50</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 4746            6          36 0.167          0.303   2.08 -<span style="color: #BB0000;">1.23</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 5194           46         188 0.245          0.303   2.08 -<span style="color: #BB0000;">1.20</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 5084            3          21 0.143          0.303   2.08 -<span style="color: #BB0000;">1.10</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 5311            3          20 0.15           0.303   2.08 -<span style="color: #BB0000;">1.03</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 4941           19          82 0.232          0.303   2.08 -<span style="color: #BB0000;">0.969</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 4816            5          27 0.185          0.303   2.08 -<span style="color: #BB0000;">0.921</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 4966            3          18 0.167          0.303   2.08 -<span style="color: #BB0000;">0.870</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfFlagged</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Flag_NormalApprox.html" class="external-link">Flag_NormalApprox</a></span><span class="op">(</span><span class="va">dfAnalyzed</span>, vThreshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dfFlagged</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 8</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric OverallMetric Factor  Score  Flag</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 4942           27          52 0.519          0.303   2.08  2.35      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 4893           22          40 0.55           0.303   2.08  2.36      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 5079           13          82 0.159          0.303   2.08 -<span style="color: #BB0000;">1.97</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 5081            2          23 0.087<span style="text-decoration: underline;">0</span>         0.303   2.08 -<span style="color: #BB0000;">1.56</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 5136            2          22 0.090<span style="text-decoration: underline;">9</span>         0.303   2.08 -<span style="color: #BB0000;">1.50</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 4746            6          36 0.167          0.303   2.08 -<span style="color: #BB0000;">1.23</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 5194           46         188 0.245          0.303   2.08 -<span style="color: #BB0000;">1.20</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 5084            3          21 0.143          0.303   2.08 -<span style="color: #BB0000;">1.10</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 5311            3          20 0.15           0.303   2.08 -<span style="color: #BB0000;">1.03</span>      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 4941           19          82 0.232          0.303   2.08 -<span style="color: #BB0000;">0.969</span>     0</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfSummary</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Summarize.html" class="external-link">Summarize</a></span><span class="op">(</span><span class="va">dfFlagged</span><span class="op">)</span></span>
<span><span class="va">dfSummary</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 6</span></span></span>
<span><span class="co">##    GroupID Numerator Denominator Metric Score  Flag</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 4893           22          40  0.55  2.36      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 4942           27          52  0.519 2.35      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 4943           12          25  0.48  1.34      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 5080           11          23  0.478 1.27      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 5273           19          40  0.475 1.64      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 4818           14          30  0.467 1.35      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 5131           10          23  0.435 0.955     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 5168           21          55  0.382 0.885     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 4891           58         161  0.360 1.10      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 5189           25          70  0.357 0.687     0</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfBounds</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Analyze_NormalApprox_PredictBounds.html" class="external-link">Analyze_NormalApprox_PredictBounds</a></span><span class="op">(</span><span class="va">dfTransformed</span>, vThreshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dfBounds</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,223 × 5</span></span></span>
<span><span class="co">##    Threshold Denominator LogDenominator Numerator  Metric</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>        -<span style="color: #BB0000;">3</span>        43.8           3.78    0.096<span style="text-decoration: underline;">8</span> 0.002<span style="text-decoration: underline;">21</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>        -<span style="color: #BB0000;">3</span>        44.5           3.80    0.201  0.004<span style="text-decoration: underline;">51</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>        -<span style="color: #BB0000;">3</span>        45.2           3.81    0.306  0.006<span style="text-decoration: underline;">76</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>        -<span style="color: #BB0000;">3</span>        45.9           3.83    0.411  0.008<span style="text-decoration: underline;">96</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>        -<span style="color: #BB0000;">3</span>        46.6           3.84    0.518  0.011<span style="text-decoration: underline;">1</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>        -<span style="color: #BB0000;">3</span>        47.2           3.86    0.625  0.013<span style="text-decoration: underline;">2</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>        -<span style="color: #BB0000;">3</span>        47.9           3.87    0.732  0.015<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>        -<span style="color: #BB0000;">3</span>        48.6           3.88    0.841  0.017<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>        -<span style="color: #BB0000;">3</span>        49.3           3.90    0.950  0.019<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>        -<span style="color: #BB0000;">3</span>        50.0           3.91    1.06   0.021<span style="text-decoration: underline;">2</span> </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1,213 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chart</span> <span class="op">&lt;-</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Visualize_Scatter.html" class="external-link">Visualize_Scatter</a></span><span class="op">(</span><span class="va">dfFlagged</span>, <span class="va">dfBounds</span><span class="op">)</span></span>
<span><span class="va">chart</span></span></code></pre></div>
<p><img src="gsm_perf_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="simulate-ur">Simulate UR<a class="anchor" aria-label="anchor" href="#simulate-ur"></a>
</h3>
<p>We write a function that removes a given ratio of AEs from one site
in the data set and returns its z-score.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_site_ur_gsm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">site</span>, <span class="va">ur_rate</span>, <span class="va">dfTransformed</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dfTransformed</span> <span class="op">&lt;-</span> <span class="va">dfTransformed</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      Numerator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">GroupID</span> <span class="op">==</span> <span class="va">site</span>, <span class="va">Numerator</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ur_rate</span><span class="op">)</span>, <span class="va">Numerator</span><span class="op">)</span>,</span>
<span>      Metric <span class="op">=</span> <span class="va">Numerator</span> <span class="op">/</span> <span class="va">Denominator</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Analyze_NormalApprox.html" class="external-link">Analyze_NormalApprox</a></span><span class="op">(</span><span class="va">dfTransformed</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">GroupID</span> <span class="op">==</span> <span class="va">site</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Score</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">sim_site_ur_gsm</span><span class="op">(</span><span class="st">"4747"</span>, ur_rate <span class="op">=</span> <span class="fl">0.75</span>, <span class="va">dfTransformed</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -2.336824</span></span></code></pre>
<p>We write another function that systematically applies this
<code>sim_site_ur_gsm</code> across all sites in all studies across a
range of under-reporting ratios.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_ur_gsm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dfSUBJ</span>, <span class="va">dfAE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dfSUBJ</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">dfAE</span>, by <span class="op">=</span> <span class="st">"study_id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      trans <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">data.x</span>, <span class="va">data.y</span>, <span class="op">~</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/AE_Map_Raw.html" class="external-link">AE_Map_Raw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dfSUBJ <span class="op">=</span> <span class="va">.x</span>, dfAE <span class="op">=</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      trans <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">trans</span>, <span class="op">~</span> <span class="fu">gsm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gsm/man/Transform_Rate.html" class="external-link">Transform_Rate</a></span><span class="op">(</span><span class="va">.</span>, strNumeratorCol <span class="op">=</span> <span class="st">"Count"</span>, strDenominatorCol <span class="op">=</span> <span class="st">"Exposure"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      sites <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data.x</span>, <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">siteid</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"data."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">ur</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      score <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap_dbl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">siteid</span>, <span class="va">ur_rate</span>, <span class="va">trans</span><span class="op">)</span>, <span class="va">sim_site_ur_gsm</span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_sim_gsm_fix</span> <span class="op">&lt;-</span> <span class="fu">sim_ur_gsm</span><span class="op">(</span><span class="va">dfSUBJ_fix</span>, <span class="va">dfAE_fix</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 3100 warnings in `mutate()`.</span></span>
<span><span class="co">## The first warning was:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `z_i = ifelse(...)`.</span></span>
<span><span class="co">## Caused by warning:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> There was 1 warning in `mutate()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `z_0 = ifelse(...)`.</span></span>
<span><span class="co">## Caused by warning in `sqrt()`:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> NaNs produced</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 3099 remaining warnings.</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_gsm_fix</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 129,966 × 5</span></span></span>
<span><span class="co">##    study_id trans             siteid ur_rate  score</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      0    -<span style="color: #BB0000;">1.23</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      0.1  -<span style="color: #BB0000;">1.37</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      0.25 -<span style="color: #BB0000;">1.58</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      0.5  -<span style="color: #BB0000;">1.92</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      0.75 -<span style="color: #BB0000;">2.25</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4746      1    -<span style="color: #BB0000;">2.55</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4747      0    -<span style="color: #BB0000;">0.216</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4747      0.1  -<span style="color: #BB0000;">0.519</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4747      0.25 -<span style="color: #BB0000;">0.967</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 0001     <span style="color: #949494;">&lt;tibble [44 × 4]&gt;</span> 4747      0.5  -<span style="color: #BB0000;">1.68</span> </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 129,956 more rows</span></span></span></code></pre>
<p>We repeat the same steps for the portfolio with the flexible AE
rates.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfSUBJ_flex</span> <span class="op">&lt;-</span> <span class="fu">get_SUBJ</span><span class="op">(</span><span class="va">df_portf_flex</span><span class="op">)</span></span>
<span><span class="va">dfAE_flex</span><span class="op">&lt;-</span> <span class="fu">get_AE</span><span class="op">(</span><span class="va">df_portf_flex</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_sim_gsm_flex</span> <span class="op">&lt;-</span> <span class="fu">sim_ur_gsm</span><span class="op">(</span><span class="va">dfSUBJ_flex</span>, <span class="va">dfAE_flex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 3110 warnings in `mutate()`.</span></span>
<span><span class="co">## The first warning was:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `z_i = ifelse(...)`.</span></span>
<span><span class="co">## Caused by warning:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> There was 1 warning in `mutate()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `z_0 = ifelse(...)`.</span></span>
<span><span class="co">## Caused by warning in `sqrt()`:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> NaNs produced</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 3109 remaining warnings.</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="ur-simaerep">UR {simaerep}<a class="anchor" aria-label="anchor" href="#ur-simaerep"></a>
</h2>
<p>We simulate under-reporting for both portfolios using {simaerep}</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_simaerep_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_ur_scenarios.html">sim_ur_scenarios</a></span><span class="op">(</span></span>
<span>   <span class="va">df_portf_fix</span>,</span>
<span>   extra_ur_sites <span class="op">=</span> <span class="fl">0</span>,</span>
<span>   ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>   parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   poisson <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_simaerep_flex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_ur_scenarios.html">sim_ur_scenarios</a></span><span class="op">(</span></span>
<span>   <span class="va">df_portf_flex</span>,</span>
<span>   extra_ur_sites <span class="op">=</span> <span class="fl">0</span>,</span>
<span>   ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>   parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   poisson <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="evaluate">Evaluate<a class="anchor" aria-label="anchor" href="#evaluate"></a>
</h2>
<div class="section level3">
<h3 id="combine-results">Combine Results<a class="anchor" aria-label="anchor" href="#combine-results"></a>
</h3>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_gsm_fix</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: fix"</span></span>
<span><span class="va">df_sim_gsm_flex</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: flexible"</span></span>
<span><span class="va">df_sim_simaerep_fix</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: fix"</span></span>
<span><span class="va">df_sim_simaerep_flex</span><span class="op">$</span><span class="va">ae_rate</span> <span class="op">&lt;-</span> <span class="st">"AE rate: flexible"</span></span>
<span></span>
<span><span class="va">df_sim_thresh2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_sim_gsm_fix</span>, <span class="va">df_sim_gsm_flex</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    is_ur <span class="op">=</span> <span class="va">score</span> <span class="op">&lt;=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"{gsm} - thresh: -2"</span>,</span>
<span>    site_number <span class="op">=</span> <span class="va">siteid</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ae_rate</span>, <span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">ur_rate</span>, <span class="va">is_ur</span>, <span class="va">score</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_sim_simaerep_threshp95</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_sim_simaerep_fix</span>, <span class="va">df_sim_simaerep_flex</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    is_ur <span class="op">=</span> <span class="va">prob_low_prob_ur</span> <span class="op">&gt;=</span> <span class="fl">0.95</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"{simaerep} - thresh: 0.95"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ae_rate</span>, <span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">ur_rate</span>, <span class="va">is_ur</span>, score <span class="op">=</span> <span class="va">prob_low_prob_ur</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">df_sim_thresh2</span>,</span>
<span>  <span class="va">df_sim_simaerep_threshp95</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="aggregate">Aggregate<a class="anchor" aria-label="anchor" href="#aggregate"></a>
</h3>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_prop_test_ci95</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">ix</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">ix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">aggr_results</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_eval</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="va">df_perf</span> <span class="op">&lt;-</span> <span class="va">df_eval</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ae_rate</span>, <span class="va">ur_rate</span>, <span class="va">is_ur</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">is_ur</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">n</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"is_ur_"</span>,</span>
<span>    values_fill <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    n_sites <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">+</span> <span class="va">is_ur_FALSE</span> <span class="op">+</span> <span class="va">is_ur_NA</span>,</span>
<span>    ratio <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">/</span> <span class="va">n_sites</span>,</span>
<span>    ratio_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"fpr"</span>, <span class="st">"tpr"</span><span class="op">)</span>,</span>
<span>    ci95_low <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span>, <span class="op">~</span> <span class="fu">get_prop_test_ci95</span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span>, ix <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    ci95_high <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span>, <span class="op">~</span> <span class="fu">get_prop_test_ci95</span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span>, ix <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_perf</span> <span class="op">&lt;-</span> <span class="fu">aggr_results</span><span class="op">(</span><span class="va">df_eval</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<div class="section level3">
<h3 id="table">Table<a class="anchor" aria-label="anchor" href="#table"></a>
</h3>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_perf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="20%">
<col width="14%">
<col width="6%">
<col width="9%">
<col width="8%">
<col width="7%">
<col width="6%">
<col width="4%">
<col width="8%">
<col width="7%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">type</th>
<th align="left">ae_rate</th>
<th align="right">ur_rate</th>
<th align="right">is_ur_FALSE</th>
<th align="right">is_ur_TRUE</th>
<th align="right">is_ur_NA</th>
<th align="right">n_sites</th>
<th align="right">ratio</th>
<th align="left">ratio_type</th>
<th align="right">ci95_low</th>
<th align="right">ci95_high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">0.00</td>
<td align="right">20823</td>
<td align="right">306</td>
<td align="right">532</td>
<td align="right">21661</td>
<td align="right">0.014</td>
<td align="left">fpr</td>
<td align="right">0.013</td>
<td align="right">0.016</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">0.10</td>
<td align="right">19867</td>
<td align="right">1262</td>
<td align="right">532</td>
<td align="right">21661</td>
<td align="right">0.058</td>
<td align="left">tpr</td>
<td align="right">0.055</td>
<td align="right">0.061</td>
</tr>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">0.25</td>
<td align="right">15815</td>
<td align="right">5320</td>
<td align="right">526</td>
<td align="right">21661</td>
<td align="right">0.246</td>
<td align="left">tpr</td>
<td align="right">0.240</td>
<td align="right">0.251</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">0.50</td>
<td align="right">9233</td>
<td align="right">11913</td>
<td align="right">515</td>
<td align="right">21661</td>
<td align="right">0.550</td>
<td align="left">tpr</td>
<td align="right">0.543</td>
<td align="right">0.557</td>
</tr>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">0.75</td>
<td align="right">5162</td>
<td align="right">15996</td>
<td align="right">503</td>
<td align="right">21661</td>
<td align="right">0.738</td>
<td align="left">tpr</td>
<td align="right">0.733</td>
<td align="right">0.744</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: fix</td>
<td align="right">1.00</td>
<td align="right">2941</td>
<td align="right">18228</td>
<td align="right">492</td>
<td align="right">21661</td>
<td align="right">0.842</td>
<td align="left">tpr</td>
<td align="right">0.837</td>
<td align="right">0.846</td>
</tr>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.00</td>
<td align="right">20881</td>
<td align="right">248</td>
<td align="right">532</td>
<td align="right">21661</td>
<td align="right">0.011</td>
<td align="left">fpr</td>
<td align="right">0.010</td>
<td align="right">0.013</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.10</td>
<td align="right">20685</td>
<td align="right">444</td>
<td align="right">532</td>
<td align="right">21661</td>
<td align="right">0.020</td>
<td align="left">tpr</td>
<td align="right">0.019</td>
<td align="right">0.022</td>
</tr>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.25</td>
<td align="right">19730</td>
<td align="right">1406</td>
<td align="right">525</td>
<td align="right">21661</td>
<td align="right">0.065</td>
<td align="left">tpr</td>
<td align="right">0.062</td>
<td align="right">0.068</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.50</td>
<td align="right">16404</td>
<td align="right">4737</td>
<td align="right">520</td>
<td align="right">21661</td>
<td align="right">0.219</td>
<td align="left">tpr</td>
<td align="right">0.213</td>
<td align="right">0.224</td>
</tr>
<tr class="odd">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.75</td>
<td align="right">12376</td>
<td align="right">8777</td>
<td align="right">508</td>
<td align="right">21661</td>
<td align="right">0.405</td>
<td align="left">tpr</td>
<td align="right">0.399</td>
<td align="right">0.412</td>
</tr>
<tr class="even">
<td align="left">{gsm} - thresh: -2</td>
<td align="left">AE rate: flexible</td>
<td align="right">1.00</td>
<td align="right">8770</td>
<td align="right">12398</td>
<td align="right">493</td>
<td align="right">21661</td>
<td align="right">0.572</td>
<td align="left">tpr</td>
<td align="right">0.566</td>
<td align="right">0.579</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">0.00</td>
<td align="right">21396</td>
<td align="right">265</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.012</td>
<td align="left">fpr</td>
<td align="right">0.011</td>
<td align="right">0.014</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">0.10</td>
<td align="right">20449</td>
<td align="right">1212</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.056</td>
<td align="left">tpr</td>
<td align="right">0.053</td>
<td align="right">0.059</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">0.25</td>
<td align="right">17178</td>
<td align="right">4483</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.207</td>
<td align="left">tpr</td>
<td align="right">0.202</td>
<td align="right">0.212</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">0.50</td>
<td align="right">10663</td>
<td align="right">10998</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.508</td>
<td align="left">tpr</td>
<td align="right">0.501</td>
<td align="right">0.514</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">0.75</td>
<td align="right">5947</td>
<td align="right">15714</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.725</td>
<td align="left">tpr</td>
<td align="right">0.719</td>
<td align="right">0.731</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: fix</td>
<td align="right">1.00</td>
<td align="right">4235</td>
<td align="right">17426</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.804</td>
<td align="left">tpr</td>
<td align="right">0.799</td>
<td align="right">0.810</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.00</td>
<td align="right">21361</td>
<td align="right">300</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.014</td>
<td align="left">fpr</td>
<td align="right">0.012</td>
<td align="right">0.016</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.10</td>
<td align="right">20271</td>
<td align="right">1390</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.064</td>
<td align="left">tpr</td>
<td align="right">0.061</td>
<td align="right">0.068</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.25</td>
<td align="right">16663</td>
<td align="right">4998</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.231</td>
<td align="left">tpr</td>
<td align="right">0.225</td>
<td align="right">0.236</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.50</td>
<td align="right">9979</td>
<td align="right">11682</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.539</td>
<td align="left">tpr</td>
<td align="right">0.533</td>
<td align="right">0.546</td>
</tr>
<tr class="odd">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">0.75</td>
<td align="right">5353</td>
<td align="right">16308</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.753</td>
<td align="left">tpr</td>
<td align="right">0.747</td>
<td align="right">0.759</td>
</tr>
<tr class="even">
<td align="left">{simaerep} - thresh: 0.95</td>
<td align="left">AE rate: flexible</td>
<td align="right">1.00</td>
<td align="right">3672</td>
<td align="right">17989</td>
<td align="right">0</td>
<td align="right">21661</td>
<td align="right">0.830</td>
<td align="left">tpr</td>
<td align="right">0.825</td>
<td align="right">0.835</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="plot-performance-metrics">Plot Performance Metrics<a class="anchor" aria-label="anchor" href="#plot-performance-metrics"></a>
</h3>
<ul>
<li>{gsm} has better performance than {simaerep} when the AE rate is
fixed, while {simaerep} greatly outperforms {gsm} when the AE rate is
flexible and mimics the AE rates encountered in real study data
sets.</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_perf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_perf</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">df_perf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"under-reporting rate: "</span>,  <span class="va">ur_rate</span>, <span class="st">" - "</span>, <span class="va">ratio_type</span><span class="op">)</span>,</span>
<span>           ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="st">"fpr"</span><span class="op">)</span>, <span class="st">"fpr"</span>, <span class="va">ur_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ur_rate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ratio</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci95_low</span>, ymax <span class="op">=</span> <span class="va">ci95_high</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">~</span> <span class="va">ae_rate</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="st">""</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"CI95 Performance Ratio"</span>, </span>
<span>        title <span class="op">=</span> <span class="st">"{simaerep} vs {gsm} Performance"</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#5491CC"</span>, <span class="st">"#F46626"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_perf</span><span class="op">(</span><span class="va">df_perf</span><span class="op">)</span></span></code></pre></div>
<p><img src="gsm_perf_files/figure-html/plot-1.png" width="960"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

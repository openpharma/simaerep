<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>simaerep Portfolio Performance â€¢ simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="simaerep Portfolio Performance">
<meta property="og:description" content="simaerep">
<meta property="og:image" content="https://openpharma.github.io/simaerep/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simaerep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/sas_files.html">SAS Files as a Data Source</a>
    </li>
    <li>
      <a href="../articles/portfolio_perf.html">simaerep Portfolio Performance</a>
    </li>
    <li>
      <a href="../articles/visit_med75.html">Adjusted Evaluation Point visit_med75</a>
    </li>
    <li>
      <a href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a>
    </li>
    <li>
      <a href="../articles/check_poisson.html">Check Poisson Test Applicability</a>
    </li>
    <li>
      <a href="../articles/visits_or_days.html">Aggregate AEs by Days or Visit?</a>
    </li>
    <li>
      <a href="../articles/gsm_perf.html">Comparing {simaerep} and {gsm} Performance</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/simaerep/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>simaerep Portfolio Performance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/HEAD/vignettes/portfolio_perf.Rmd" class="external-link"><code>vignettes/portfolio_perf.Rmd</code></a></small>
      <div class="hidden name"><code>portfolio_perf.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="load">Load<a class="anchor" aria-label="anchor" href="#load"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/simaerep/">simaerep</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RAM ~26 GB</span></span>
<span><span class="co"># plan 4GB per core</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We want to define minimal requirements for simulating test data that
reflects realistic portfolio data which we then want to use to benchmark
overall {simaerep} performance.</p>
</div>
<div class="section level2">
<h2 id="performance">Performance<a class="anchor" aria-label="anchor" href="#performance"></a>
</h2>
<p>These simulations take some time to run and require multiple cores
and appropriate memory. Rendering articles in {pkgdown} can be a bit
unstable so we recommend to render first using pure {rmarkdown} to
generate the intermediate csv files.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span><span class="st">"vignettes/_portfolio_perf.Rmd"</span>, knit_root_dir <span class="op">=</span> <span class="st">"/home/koneswab/simaerep"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="portfolio-configuration">Portfolio Configuration<a class="anchor" aria-label="anchor" href="#portfolio-configuration"></a>
</h2>
<p>The portfolio configuration will be used to generate compliant test
data that is similar to a realistic portfolio of studies in which all
sites are compliant. We will subsequently remove a percentage of AEs
from each study site and calculate AE under-reporting statistics to
calculate overall detection thresholds. The portfolio configuration
should give a minimal description of the portfolio without violating
data privacy laws or competitive intellectual property. We propose to
include the following metrics into the portfolio configuration:</p>
<p><strong>site parameters:</strong></p>
<ul>
<li>mean of all maximum patient visits</li>
<li>sd of of all maximum patient visits</li>
<li>total number patients</li>
</ul>
<p><strong>study parameters:</strong></p>
<ul>
<li>mean AE per visit</li>
</ul>
<p>The information contained in a portfolio configuration is very scarce
and thus can be shared more easily within the industry. We can use those
parameters to simulate test data for assessing {simaerep} performance on
a given portfolio.</p>
<p>We can start with a maximum aggregation of visit and n_ae on patient
level starting with df_visit as we would use it for
<code><a href="../reference/site_aggr.html">simaerep::site_aggr()</a></code>. We can use
<code><a href="../reference/get_config.html">simaerep::get_config</a></code> to generate a valid portfolio
configuration, which will automatically apply a few filters:</p>
<ul>
<li>remove patients with 0 visits</li>
<li>minimum number of patients per study</li>
<li>minimum number of sites per study</li>
<li>anonymize study and site IDs</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_visit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span>n_pat <span class="op">=</span> <span class="fl">100</span>, n_sites <span class="op">=</span> <span class="fl">10</span>,</span>
<span>   frac_site_with_ur <span class="op">=</span> <span class="fl">0.4</span>, ur_rate <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit1</span><span class="op">$</span><span class="va">study_id</span> <span class="op">&lt;-</span> <span class="st">"A"</span></span>
<span></span>
<span><span class="va">df_visit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span>n_pat <span class="op">=</span> <span class="fl">100</span>, n_sites <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                                      frac_site_with_ur <span class="op">=</span> <span class="fl">0.2</span>, ur_rate <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit2</span><span class="op">$</span><span class="va">study_id</span> <span class="op">&lt;-</span> <span class="st">"B"</span></span>
<span></span>
<span><span class="va">df_visit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_visit1</span>, <span class="va">df_visit2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_site_max</span> <span class="op">&lt;-</span> <span class="va">df_visit</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">patnum</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>max_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">visit</span><span class="op">)</span>,</span>
<span>            max_ae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_config</span> <span class="op">&lt;-</span> <span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/get_config.html">get_config</a></span><span class="op">(</span></span>
<span>  <span class="va">df_site_max</span>, anonymize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  min_pat_per_study <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  min_sites_per_study <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_config</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="12%">
<col width="24%">
<col width="16%">
<col width="17%">
<col width="20%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">ae_per_visit_mean</th>
<th align="left">site_number</th>
<th align="right">max_visit_sd</th>
<th align="right">max_visit_mean</th>
<th align="right">n_pat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0002</td>
<td align="right">4.452215</td>
<td align="right">18.4</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0003</td>
<td align="right">4.802777</td>
<td align="right">18.8</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0004</td>
<td align="right">4.571652</td>
<td align="right">18.3</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0005</td>
<td align="right">4.691600</td>
<td align="right">20.3</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0006</td>
<td align="right">2.884826</td>
<td align="right">19.1</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0007</td>
<td align="right">3.829708</td>
<td align="right">18.0</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0008</td>
<td align="right">5.185450</td>
<td align="right">21.0</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0009</td>
<td align="right">4.948625</td>
<td align="right">19.4</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0010</td>
<td align="right">4.115013</td>
<td align="right">19.4</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">0002</td>
<td align="right">0.5005081</td>
<td align="left">0001</td>
<td align="right">4.552167</td>
<td align="right">19.5</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">0002</td>
<td align="right">0.5005081</td>
<td align="left">0002</td>
<td align="right">4.321779</td>
<td align="right">18.7</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">0002</td>
<td align="right">0.5005081</td>
<td align="left">0003</td>
<td align="right">3.333333</td>
<td align="right">18.0</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">0002</td>
<td align="right">0.5005081</td>
<td align="left">0004</td>
<td align="right">3.772709</td>
<td align="right">21.3</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">0002</td>
<td align="right">0.5005081</td>
<td align="left">0005</td>
<td align="right">3.695342</td>
<td align="right">21.1</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">0002</td>
<td align="right">0.5005081</td>
<td align="left">0006</td>
<td align="right">3.951090</td>
<td align="right">17.5</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">0002</td>
<td align="right">0.5005081</td>
<td align="left">0007</td>
<td align="right">4.104198</td>
<td align="right">21.2</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">0002</td>
<td align="right">0.5005081</td>
<td align="left">0008</td>
<td align="right">4.391912</td>
<td align="right">19.2</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">0002</td>
<td align="right">0.5005081</td>
<td align="left">0009</td>
<td align="right">3.374743</td>
<td align="right">19.5</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">0002</td>
<td align="right">0.5005081</td>
<td align="left">0010</td>
<td align="right">3.521363</td>
<td align="right">20.8</td>
<td align="right">10</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="simulate-portfolio-from-configuration">Simulate Portfolio from Configuration<a class="anchor" aria-label="anchor" href="#simulate-portfolio-from-configuration"></a>
</h3>
<p>We can now apply sim_test_data_portfolio which uses
<code><a href="../reference/sim_test_data_study.html">sim_test_data_study()</a></code> to generate artificial data on visit
level.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_portf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_portfolio.html">sim_test_data_portfolio</a></span><span class="op">(</span><span class="va">df_config</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_portf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="10%">
<col width="21%">
<col width="14%">
<col width="15%">
<col width="17%">
<col width="8%">
<col width="7%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">ae_per_visit_mean</th>
<th align="left">site_number</th>
<th align="right">max_visit_sd</th>
<th align="right">max_visit_mean</th>
<th align="left">patnum</th>
<th align="right">visit</th>
<th align="right">n_ae</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">8</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">9</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">10</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">11</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">12</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">13</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">14</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0001</td>
<td align="right">15</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0002</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0002</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0002</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0002</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0002</td>
<td align="right">5</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0002</td>
<td align="right">6</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0002</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0002</td>
<td align="right">8</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0002</td>
<td align="right">9</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.3746743</td>
<td align="left">0001</td>
<td align="right">3.794733</td>
<td align="right">19.2</td>
<td align="left">0002</td>
<td align="right">10</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="load-realistic-configuration">Load Realistic Configuration<a class="anchor" aria-label="anchor" href="#load-realistic-configuration"></a>
</h3>
<p>Here we load a realistic portfolio configuration.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_config</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"ae_profile.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_config</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="15%">
<col width="13%">
<col width="10%">
<col width="11%">
<col width="13%">
<col width="10%">
<col width="12%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">ae_per_visit_mean</th>
<th align="right">ae_per_day_mean</th>
<th align="left">site_number</th>
<th align="right">max_visit_sd</th>
<th align="right">max_visit_mean</th>
<th align="right">max_days_sd</th>
<th align="right">max_days_mean</th>
<th align="right">n_pat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.50000</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0002</td>
<td align="right">2.1213203</td>
<td align="right">28.50000</td>
<td align="right">1350</td>
<td align="right">1350</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0003</td>
<td align="right">0.5773503</td>
<td align="right">19.50000</td>
<td align="right">738</td>
<td align="right">738</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0004</td>
<td align="right">8.8694231</td>
<td align="right">31.33333</td>
<td align="right">1461</td>
<td align="right">1461</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0005</td>
<td align="right">0.0000000</td>
<td align="right">30.00000</td>
<td align="right">1253</td>
<td align="right">1253</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0006</td>
<td align="right">0.0000000</td>
<td align="right">35.00000</td>
<td align="right">1479</td>
<td align="right">1479</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0007</td>
<td align="right">0.0000000</td>
<td align="right">36.00000</td>
<td align="right">1415</td>
<td align="right">1415</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0008</td>
<td align="right">5.3363087</td>
<td align="right">26.14286</td>
<td align="right">971</td>
<td align="right">971</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0009</td>
<td align="right">0.0000000</td>
<td align="right">20.00000</td>
<td align="right">756</td>
<td align="right">756</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0010</td>
<td align="right">1.8165902</td>
<td align="right">27.40000</td>
<td align="right">1364</td>
<td align="right">1364</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0011</td>
<td align="right">1.7320508</td>
<td align="right">27.00000</td>
<td align="right">1190</td>
<td align="right">1190</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0012</td>
<td align="right">1.4142136</td>
<td align="right">26.00000</td>
<td align="right">1186</td>
<td align="right">1186</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0013</td>
<td align="right">0.0000000</td>
<td align="right">25.00000</td>
<td align="right">1127</td>
<td align="right">1127</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0014</td>
<td align="right">0.0000000</td>
<td align="right">18.00000</td>
<td align="right">566</td>
<td align="right">566</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0015</td>
<td align="right">1.7078251</td>
<td align="right">18.75000</td>
<td align="right">588</td>
<td align="right">588</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0016</td>
<td align="right">0.0000000</td>
<td align="right">25.00000</td>
<td align="right">644</td>
<td align="right">644</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0017</td>
<td align="right">1.0000000</td>
<td align="right">22.00000</td>
<td align="right">827</td>
<td align="right">827</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0018</td>
<td align="right">4.0414519</td>
<td align="right">32.50000</td>
<td align="right">1534</td>
<td align="right">1534</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0019</td>
<td align="right">12.9408913</td>
<td align="right">25.33333</td>
<td align="right">1183</td>
<td align="right">1183</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0020</td>
<td align="right">0.5773503</td>
<td align="right">20.66667</td>
<td align="right">770</td>
<td align="right">770</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0021</td>
<td align="right">14.8492424</td>
<td align="right">28.50000</td>
<td align="right">666</td>
<td align="right">666</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0022</td>
<td align="right">9.0369611</td>
<td align="right">26.50000</td>
<td align="right">987</td>
<td align="right">987</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0023</td>
<td align="right">0.0000000</td>
<td align="right">23.00000</td>
<td align="right">931</td>
<td align="right">931</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0024</td>
<td align="right">0.0000000</td>
<td align="right">38.00000</td>
<td align="right">938</td>
<td align="right">938</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0025</td>
<td align="right">6.3639610</td>
<td align="right">26.50000</td>
<td align="right">938</td>
<td align="right">938</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="simulate-portfolio">Simulate Portfolio<a class="anchor" aria-label="anchor" href="#simulate-portfolio"></a>
</h2>
<p>And again we simulate artificial visit level data. Using parallel
processing. At this stage we have simulated compliant test data of a
realistic study portfolio.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_portf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_portfolio.html">sim_test_data_portfolio</a></span><span class="op">(</span><span class="va">df_config</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_portf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="14%">
<col width="12%">
<col width="9%">
<col width="10%">
<col width="11%">
<col width="9%">
<col width="11%">
<col width="5%">
<col width="4%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="right">ae_per_visit_mean</th>
<th align="right">ae_per_day_mean</th>
<th align="left">site_number</th>
<th align="right">max_visit_sd</th>
<th align="right">max_visit_mean</th>
<th align="right">max_days_sd</th>
<th align="right">max_days_mean</th>
<th align="left">patnum</th>
<th align="right">visit</th>
<th align="right">n_ae</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">5</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">8</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">9</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">10</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">11</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">12</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">13</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">14</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">15</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">16</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">17</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">18</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">19</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">20</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0001</td>
<td align="right">21</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0002</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0002</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0002</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0.2687087</td>
<td align="right">0.0072492</td>
<td align="left">0001</td>
<td align="right">0.7071068</td>
<td align="right">22.5</td>
<td align="right">622</td>
<td align="right">622</td>
<td align="left">0002</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="confirm-that-portfolio-simulation-results-in-similar-configuration">Confirm that Portfolio Simulation results in Similar
Configuration<a class="anchor" aria-label="anchor" href="#confirm-that-portfolio-simulation-results-in-similar-configuration"></a>
</h3>
<p>We will now use the simulated portfolio data and extract the
configuration. We expect that the configuration that we will be
extracting is very similar to the configuration that we started out with
in the first place.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_site_max_portf</span> <span class="op">&lt;-</span> <span class="va">df_portf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">patnum</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>max_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">visit</span><span class="op">)</span>,</span>
<span>            max_ae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_config_portf</span> <span class="op">&lt;-</span> <span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/get_config.html">get_config</a></span><span class="op">(</span><span class="va">df_site_max_portf</span>, anonymize <span class="op">=</span> <span class="cn">TRUE</span>, min_pat_per_study <span class="op">=</span> <span class="fl">100</span>, min_sites_per_study <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_comp</span> <span class="op">&lt;-</span> <span class="va">df_config</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">df_config_portf</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"site_number"</span><span class="op">)</span>,</span>
<span>    suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".ori"</span>, <span class="st">".sim"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">study_id</span>,</span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"ae"</span><span class="op">)</span>,</span>
<span>    <span class="va">site_number</span>,</span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"max_visit_sd"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"max_visit_mean"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"n_pat"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df_comp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"ae"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">ae_per_visit_mean.ori</span>, <span class="va">ae_per_visit_mean.sim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"simulated vs original AE per visit study mean"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio_perf_files/figure-html/check_portf-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_comp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">max_visit_sd.ori</span>, <span class="va">max_visit_sd.sim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"simulated vs original max visit sd site"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio_perf_files/figure-html/check_portf-2.png" width="700"></p>
<p>In our portfolio simulation we sample the patient maximum visit
values from a normal distribution. If that returns values smaller than 1
we replace it with one. The larger the SD values compared to the mean
values the more likely we will sample a patient maximum visit smaller
than one. Every time we have to do that correction we are lowering the
patient maximum visit SD in our simulation, which we can see in the
graph above.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_comp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">max_visit_mean.ori</span>, <span class="va">max_visit_mean.sim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"simulated vs original max visit mean site"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio_perf_files/figure-html/check_portf_2-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_comp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">n_pat.ori</span>, <span class="va">n_pat.sim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"simulated vs original n_pat site"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio_perf_files/figure-html/check_portf_2-2.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="get-under-reporting-probability-for-different-under-reporting-scenarios">Get Under-Reporting Probability for Different Under Reporting
Scenarios<a class="anchor" aria-label="anchor" href="#get-under-reporting-probability-for-different-under-reporting-scenarios"></a>
</h2>
<p>The performance of detecting AE under-reporting is dependent on three
things:</p>
<ul>
<li>the higher the mean AE per visit on study level the better</li>
<li>the higher the number of patients at an under-reporting site the
better</li>
<li>the higher the maximum visit number per patient the better</li>
<li>the higher the number of under-reporting sites in a study the
worse</li>
</ul>
<p>In our initial usability assessment we have fixed those parameters.
Here we are going leave them as they are in the portfolio. The vanilla
version of our artificial portfolio data does not contain any
under-reporting sites yet. However
<code><a href="../reference/sim_ur_scenarios.html">simaerep::sim_ur_scenarios()</a></code> will apply under-reporting
scenarios to each site. Reducing the number of AEs by a given
under-reporting rate (ur_rate) for all patients at the site and add the
corresponding under-reporting statistics.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_scen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_ur_scenarios.html">sim_ur_scenarios</a></span><span class="op">(</span></span>
<span>   <span class="va">df_portf</span>,</span>
<span>   extra_ur_sites <span class="op">=</span> <span class="fl">0</span>,</span>
<span>   ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>   parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   poisson <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">df_scen</span>, file <span class="op">=</span> <span class="st">"scen.csv"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_scen</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"scen.csv"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_scen</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="5%">
<col width="2%">
<col width="7%">
<col width="5%">
<col width="8%">
<col width="8%">
<col width="10%">
<col width="6%">
<col width="7%">
<col width="3%">
<col width="4%">
<col width="3%">
<col width="4%">
<col width="5%">
<col width="5%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="left">site_number</th>
<th align="right">n_pat</th>
<th align="right">n_pat_with_med75</th>
<th align="right">visit_med75</th>
<th align="right">mean_ae_site_med75</th>
<th align="right">mean_ae_study_med75</th>
<th align="right">n_pat_with_med75_study</th>
<th align="right">extra_ur_sites</th>
<th align="right">frac_pat_with_ur</th>
<th align="right">ur_rate</th>
<th align="right">pval</th>
<th align="right">prob_low</th>
<th align="right">pval_adj</th>
<th align="right">pval_prob_ur</th>
<th align="right">prob_low_adj</th>
<th align="right">prob_low_prob_ur</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">21</td>
<td align="right">8.000</td>
<td align="right">5.389610</td>
<td align="right">77</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
<td align="right">0.00</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">21</td>
<td align="right">7.200</td>
<td align="right">5.389610</td>
<td align="right">77</td>
<td align="right">0</td>
<td align="right">0.0253165</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">21</td>
<td align="right">6.000</td>
<td align="right">5.389610</td>
<td align="right">77</td>
<td align="right">0</td>
<td align="right">0.0253165</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">21</td>
<td align="right">4.000</td>
<td align="right">5.389610</td>
<td align="right">77</td>
<td align="right">0</td>
<td align="right">0.0253165</td>
<td align="right">0.50</td>
<td align="right">0.5336674</td>
<td align="right">0.251</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.3722697</td>
<td align="right">0.6277303</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">21</td>
<td align="right">2.000</td>
<td align="right">5.389610</td>
<td align="right">77</td>
<td align="right">0</td>
<td align="right">0.0253165</td>
<td align="right">0.75</td>
<td align="right">0.0408679</td>
<td align="right">0.021</td>
<td align="right">0.1541303</td>
<td align="right">0.8458697</td>
<td align="right">0.0644651</td>
<td align="right">0.9355349</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">21</td>
<td align="right">0.000</td>
<td align="right">5.389610</td>
<td align="right">77</td>
<td align="right">0</td>
<td align="right">0.0253165</td>
<td align="right">1.00</td>
<td align="right">0.0000535</td>
<td align="right">0.000</td>
<td align="right">0.0005289</td>
<td align="right">0.9994711</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">29</td>
<td align="right">6.000</td>
<td align="right">7.035714</td>
<td align="right">28</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
<td align="right">0.00</td>
<td align="right">0.6787179</td>
<td align="right">0.341</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.4688750</td>
<td align="right">0.5311250</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">29</td>
<td align="right">5.400</td>
<td align="right">7.035714</td>
<td align="right">28</td>
<td align="right">0</td>
<td align="right">0.0666667</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">0.176</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.2848000</td>
<td align="right">0.7152000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">29</td>
<td align="right">4.500</td>
<td align="right">7.035714</td>
<td align="right">28</td>
<td align="right">0</td>
<td align="right">0.0666667</td>
<td align="right">0.25</td>
<td align="right">0.2098822</td>
<td align="right">0.096</td>
<td align="right">0.6442896</td>
<td align="right">0.3557104</td>
<td align="right">0.1849927</td>
<td align="right">0.8150073</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">29</td>
<td align="right">3.000</td>
<td align="right">7.035714</td>
<td align="right">28</td>
<td align="right">0</td>
<td align="right">0.0666667</td>
<td align="right">0.50</td>
<td align="right">0.0333859</td>
<td align="right">0.024</td>
<td align="right">0.1315503</td>
<td align="right">0.8684497</td>
<td align="right">0.0728276</td>
<td align="right">0.9271724</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">29</td>
<td align="right">1.500</td>
<td align="right">7.035714</td>
<td align="right">28</td>
<td align="right">0</td>
<td align="right">0.0666667</td>
<td align="right">0.75</td>
<td align="right">0.0010018</td>
<td align="right">0.006</td>
<td align="right">0.0071561</td>
<td align="right">0.9928439</td>
<td align="right">0.0264000</td>
<td align="right">0.9736000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">29</td>
<td align="right">0.000</td>
<td align="right">7.035714</td>
<td align="right">28</td>
<td align="right">0</td>
<td align="right">0.0666667</td>
<td align="right">1.00</td>
<td align="right">0.0000022</td>
<td align="right">0.006</td>
<td align="right">0.0000330</td>
<td align="right">0.9999670</td>
<td align="right">0.0264000</td>
<td align="right">0.9736000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">18</td>
<td align="right">6.000</td>
<td align="right">4.801980</td>
<td align="right">101</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
<td align="right">0.00</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">18</td>
<td align="right">5.400</td>
<td align="right">4.801980</td>
<td align="right">101</td>
<td align="right">0</td>
<td align="right">0.0380952</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">18</td>
<td align="right">4.500</td>
<td align="right">4.801980</td>
<td align="right">101</td>
<td align="right">0</td>
<td align="right">0.0380952</td>
<td align="right">0.25</td>
<td align="right">0.9071723</td>
<td align="right">0.444</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.5717854</td>
<td align="right">0.4282146</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">18</td>
<td align="right">3.000</td>
<td align="right">4.801980</td>
<td align="right">101</td>
<td align="right">0</td>
<td align="right">0.0380952</td>
<td align="right">0.50</td>
<td align="right">0.1258534</td>
<td align="right">0.063</td>
<td align="right">0.4259653</td>
<td align="right">0.5740347</td>
<td align="right">0.1363279</td>
<td align="right">0.8636721</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">18</td>
<td align="right">1.500</td>
<td align="right">4.801980</td>
<td align="right">101</td>
<td align="right">0</td>
<td align="right">0.0380952</td>
<td align="right">0.75</td>
<td align="right">0.0012669</td>
<td align="right">0.000</td>
<td align="right">0.0085757</td>
<td align="right">0.9914243</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">18</td>
<td align="right">0.000</td>
<td align="right">4.801980</td>
<td align="right">101</td>
<td align="right">0</td>
<td align="right">0.0380952</td>
<td align="right">1.00</td>
<td align="right">0.0000000</td>
<td align="right">0.000</td>
<td align="right">0.0000004</td>
<td align="right">0.9999996</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">6</td>
<td align="right">4</td>
<td align="right">31</td>
<td align="right">7.500</td>
<td align="right">7.850000</td>
<td align="right">20</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
<td align="right">0.00</td>
<td align="right">0.9218103</td>
<td align="right">0.444</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.5717854</td>
<td align="right">0.4282146</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">6</td>
<td align="right">4</td>
<td align="right">31</td>
<td align="right">6.750</td>
<td align="right">7.850000</td>
<td align="right">20</td>
<td align="right">0</td>
<td align="right">0.1666667</td>
<td align="right">0.10</td>
<td align="right">0.5525245</td>
<td align="right">0.231</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.3504828</td>
<td align="right">0.6495172</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">6</td>
<td align="right">4</td>
<td align="right">31</td>
<td align="right">5.625</td>
<td align="right">7.850000</td>
<td align="right">20</td>
<td align="right">0</td>
<td align="right">0.1666667</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">0.070</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.1443750</td>
<td align="right">0.8556250</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">6</td>
<td align="right">4</td>
<td align="right">31</td>
<td align="right">3.750</td>
<td align="right">7.850000</td>
<td align="right">20</td>
<td align="right">0</td>
<td align="right">0.1666667</td>
<td align="right">0.50</td>
<td align="right">0.0039482</td>
<td align="right">0.006</td>
<td align="right">0.0212722</td>
<td align="right">0.9787278</td>
<td align="right">0.0264000</td>
<td align="right">0.9736000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">6</td>
<td align="right">4</td>
<td align="right">31</td>
<td align="right">1.875</td>
<td align="right">7.850000</td>
<td align="right">20</td>
<td align="right">0</td>
<td align="right">0.1666667</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
<td align="right">0.001</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0064390</td>
<td align="right">0.9935610</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">6</td>
<td align="right">4</td>
<td align="right">31</td>
<td align="right">0.000</td>
<td align="right">7.850000</td>
<td align="right">20</td>
<td align="right">0</td>
<td align="right">0.1666667</td>
<td align="right">1.00</td>
<td align="right">0.0000000</td>
<td align="right">0.001</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0064390</td>
<td align="right">0.9935610</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0005</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">30</td>
<td align="right">2.000</td>
<td align="right">7.555556</td>
<td align="right">27</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
<td align="right">0.00</td>
<td align="right">0.0377761</td>
<td align="right">0.031</td>
<td align="right">0.1445345</td>
<td align="right">0.8554655</td>
<td align="right">0.0818400</td>
<td align="right">0.9181600</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="portfolio-performance">Portfolio Performance<a class="anchor" aria-label="anchor" href="#portfolio-performance"></a>
</h2>
<p>For every site in the portfolio we have now generated the AE
under-reporting probability for the following under-reporting rates 0,
0.25, 0.5, 0.75 and 1:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_scen</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">ur_rate</span>, <span class="va">prob_low_prob_ur</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">study_id</th>
<th align="left">site_number</th>
<th align="right">ur_rate</th>
<th align="right">prob_low_prob_ur</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">0.00</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">0.10</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">0.25</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">0.50</td>
<td align="right">0.6277303</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">0.75</td>
<td align="right">0.9355349</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">1.00</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">0.00</td>
<td align="right">0.5311250</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">0.10</td>
<td align="right">0.7152000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">0.25</td>
<td align="right">0.8150073</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">0.50</td>
<td align="right">0.9271724</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">0.75</td>
<td align="right">0.9736000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0002</td>
<td align="right">1.00</td>
<td align="right">0.9736000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">0.00</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">0.10</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">0.25</td>
<td align="right">0.4282146</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">0.50</td>
<td align="right">0.8636721</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0003</td>
<td align="right">1.00</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">0.00</td>
<td align="right">0.4282146</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">0.10</td>
<td align="right">0.6495172</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">0.25</td>
<td align="right">0.8556250</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">0.50</td>
<td align="right">0.9736000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">0.75</td>
<td align="right">0.9935610</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0004</td>
<td align="right">1.00</td>
<td align="right">0.9935610</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0005</td>
<td align="right">0.00</td>
<td align="right">0.9181600</td>
</tr>
</tbody>
</table>
<p>We usually recommend a 0.95 threshold to flag sites as
under-reporting. We can use this threshold to calculate the ratio of
flagged sites per under-reporting rate. The zero under-reporting
scenario defines the expected false positive rates (fpr as fp/N), while
the other scenarios give us the expected true positive rate (tpr as
tp/P) for sites with that under-reporting level. The condition for the
tpr and fpr rates for the simulated portfolio is that each site is the
only under-reporting site in the respective study.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_perf_portf</span> <span class="op">&lt;-</span> <span class="va">df_scen</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_ur <span class="op">=</span> <span class="va">prob_low_prob_ur</span> <span class="op">&gt;=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="va">is_ur</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">is_ur</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">n</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"is_ur_"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    n_sites <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">+</span> <span class="va">is_ur_FALSE</span>,</span>
<span>    ratio <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">/</span> <span class="va">n_sites</span>,</span>
<span>    ratio_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"fpr"</span>, <span class="st">"tpr"</span><span class="op">)</span>,</span>
<span>    ci95_low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    ci95_high <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="va">df_perf_portf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="10%">
<col width="16%">
<col width="14%">
<col width="10%">
<col width="8%">
<col width="14%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="right">ur_rate</th>
<th align="right">is_ur_FALSE</th>
<th align="right">is_ur_TRUE</th>
<th align="right">n_sites</th>
<th align="right">ratio</th>
<th align="left">ratio_type</th>
<th align="right">ci95_low</th>
<th align="right">ci95_high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.00</td>
<td align="right">15459</td>
<td align="right">215</td>
<td align="right">15674</td>
<td align="right">0.014</td>
<td align="left">fpr</td>
<td align="right">0.012</td>
<td align="right">0.016</td>
</tr>
<tr class="even">
<td align="right">0.10</td>
<td align="right">14709</td>
<td align="right">965</td>
<td align="right">15674</td>
<td align="right">0.062</td>
<td align="left">tpr</td>
<td align="right">0.058</td>
<td align="right">0.065</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">12338</td>
<td align="right">3336</td>
<td align="right">15674</td>
<td align="right">0.213</td>
<td align="left">tpr</td>
<td align="right">0.206</td>
<td align="right">0.219</td>
</tr>
<tr class="even">
<td align="right">0.50</td>
<td align="right">7944</td>
<td align="right">7730</td>
<td align="right">15674</td>
<td align="right">0.493</td>
<td align="left">tpr</td>
<td align="right">0.485</td>
<td align="right">0.501</td>
</tr>
<tr class="odd">
<td align="right">0.75</td>
<td align="right">4783</td>
<td align="right">10891</td>
<td align="right">15674</td>
<td align="right">0.695</td>
<td align="left">tpr</td>
<td align="right">0.688</td>
<td align="right">0.702</td>
</tr>
<tr class="even">
<td align="right">1.00</td>
<td align="right">3567</td>
<td align="right">12107</td>
<td align="right">15674</td>
<td align="right">0.772</td>
<td align="left">tpr</td>
<td align="right">0.766</td>
<td align="right">0.779</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="benchmark-simaerep-using-portfolio-performance">Benchmark {simaerep} Using Portfolio Performance<a class="anchor" aria-label="anchor" href="#benchmark-simaerep-using-portfolio-performance"></a>
</h2>
<div class="section level3">
<h3 id="performance-under-optimal-conditions">Performance Under Optimal Conditions<a class="anchor" aria-label="anchor" href="#performance-under-optimal-conditions"></a>
</h3>
<p>True positive rates for sites with with an under-reporting rate of 1
is surprisingly small. We would expect that here we should have true
positive ratios of close to 100%. The reason is that within a portfolio
we have sites that are just starting up and have not reported any AEs
yet. We also have studies with overall low AE rates for example for
studies with healthy participants. Altogether this allows uncompliant
sites to hide among the compliant sites which makes it more difficult to
detect them. Therefore we would also like to demonstrate {simaerep}
performance as it can be expected under ideal conditions.</p>
<p>We generate studies with the following parameters:</p>
<ul>
<li>200 patients</li>
<li>20 sites</li>
<li>one under-reporting site</li>
<li>0.5 AEs per visit</li>
<li>in average 20 visits per patient with SD of 2</li>
</ul>
<p>We simulate 500 studies for each under-reporting scenario.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">standard_sim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ur_rate</span>, <span class="va">seed</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span></span>
<span>    n_pat <span class="op">=</span> <span class="fl">200</span>,</span>
<span>    n_sites <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    frac_site_with_ur <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    ur_rate <span class="op">=</span> <span class="va">ur_rate</span>,</span>
<span>    ae_per_visit_mean <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    max_visit_mean <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    max_visit_sd <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">df</span><span class="op">$</span><span class="va">is_ur</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_data_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>   data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="va">seed</span>, <span class="va">standard_sim</span><span class="op">)</span></span>
<span> <span class="op">)</span> </span>
<span></span>
<span><span class="va">df_data_grid</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3,000 Ã— 3</span></span></span>
<span><span class="co">##    ur_rate  seed data                </span></span>
<span><span class="co">##      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>       0     1 <span style="color: #949494;">&lt;tibble [3,891 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>       0     2 <span style="color: #949494;">&lt;tibble [3,892 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>       0     3 <span style="color: #949494;">&lt;tibble [3,891 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>       0     4 <span style="color: #949494;">&lt;tibble [3,866 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>       0     5 <span style="color: #949494;">&lt;tibble [3,899 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>       0     6 <span style="color: #949494;">&lt;tibble [3,887 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>       0     7 <span style="color: #949494;">&lt;tibble [3,927 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>       0     8 <span style="color: #949494;">&lt;tibble [3,869 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>       0     9 <span style="color: #949494;">&lt;tibble [3,884 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>       0    10 <span style="color: #949494;">&lt;tibble [3,884 Ã— 8]&gt;</span></span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 2,990 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_visit</span> <span class="op">&lt;-</span> <span class="va">df_data_grid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    study_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"study-"</span>, </span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html" class="external-link">str_pad</a></span><span class="op">(</span><span class="va">ur_rate</span>, width<span class="op">=</span> <span class="fl">3</span>, side <span class="op">=</span> <span class="st">"left"</span>, pad <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span>,</span>
<span>      <span class="st">"-"</span>,</span>
<span>      <span class="va">seed</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="4%">
<col width="7%">
<col width="11%">
<col width="5%">
<col width="13%">
<col width="12%">
<col width="16%">
<col width="5%">
<col width="4%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="right">ur_rate</th>
<th align="right">seed</th>
<th align="left">patnum</th>
<th align="left">site_number</th>
<th align="left">is_ur</th>
<th align="right">max_visit_mean</th>
<th align="right">max_visit_sd</th>
<th align="right">ae_per_visit_mean</th>
<th align="right">visit</th>
<th align="right">n_ae</th>
<th align="left">study_id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">5</td>
<td align="right">4</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">6</td>
<td align="right">5</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">7</td>
<td align="right">6</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">8</td>
<td align="right">6</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">9</td>
<td align="right">6</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">10</td>
<td align="right">6</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">11</td>
<td align="right">7</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">12</td>
<td align="right">7</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">13</td>
<td align="right">8</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">14</td>
<td align="right">8</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">15</td>
<td align="right">9</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">16</td>
<td align="right">12</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">17</td>
<td align="right">12</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000001</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">18</td>
<td align="right">13</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000002</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000002</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000002</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000002</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000002</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="left">study-000-1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000002</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="left">study-000-1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">P000002</td>
<td align="left">S0001</td>
<td align="left">FALSE</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0.5</td>
<td align="right">7</td>
<td align="right">2</td>
<td align="left">study-000-1</td>
</tr>
</tbody>
</table>
<p>Next we apply {simaerep}</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/site_aggr.html">site_aggr</a></span><span class="op">(</span><span class="va">df_visit</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_sim_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_sites.html">sim_sites</a></span><span class="op">(</span><span class="va">df_site</span>, <span class="va">df_visit</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval_sites.html">eval_sites</a></span><span class="op">(</span><span class="va">df_sim_sites</span><span class="op">)</span></span></code></pre></div>
<p>We calculate the confusion matrices.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_perf</span> <span class="op">&lt;-</span> <span class="va">df_visit</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">is_ur</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_eval</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"study_id"</span>, <span class="st">"site_number"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_ur_detected <span class="op">=</span> <span class="va">prob_low_prob_ur</span> <span class="op">&gt;=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="va">is_ur</span>, <span class="va">is_ur_detected</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">df_perf</span>, file <span class="op">=</span> <span class="st">"scen_st.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">remove</a></span><span class="op">(</span><span class="va">df_visit</span><span class="op">)</span> <span class="co"># free up RAM</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_perf</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"scen_st.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_perf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">ur_rate</th>
<th align="left">is_ur</th>
<th align="left">is_ur_detected</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.00</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">9977</td>
</tr>
<tr class="even">
<td align="right">0.00</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="right">0.10</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">9482</td>
</tr>
<tr class="even">
<td align="right">0.10</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="right">0.10</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">486</td>
</tr>
<tr class="even">
<td align="right">0.10</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">9486</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">364</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">136</td>
</tr>
<tr class="odd">
<td align="right">0.50</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">9487</td>
</tr>
<tr class="even">
<td align="right">0.50</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="right">0.50</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="right">0.50</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">488</td>
</tr>
<tr class="odd">
<td align="right">0.75</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">9499</td>
</tr>
<tr class="even">
<td align="right">0.75</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">0.75</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">500</td>
</tr>
<tr class="even">
<td align="right">1.00</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">9500</td>
</tr>
<tr class="odd">
<td align="right">1.00</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">500</td>
</tr>
</tbody>
</table>
<p>We calculate tpr and fpr.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_prop_test_ci95</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">ix</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">ix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span>,</span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_perf_st</span> <span class="op">&lt;-</span> <span class="va">df_perf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ur_rate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span> <span class="va">is_ur</span>, <span class="va">n</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    P <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_ur</span>, <span class="va">n</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    TP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_ur</span> <span class="op">&amp;</span> <span class="va">is_ur_detected</span>, <span class="va">n</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    FP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span> <span class="va">is_ur</span> <span class="op">&amp;</span> <span class="va">is_ur_detected</span>, <span class="va">n</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    TN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span> <span class="va">is_ur</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="va">is_ur_detected</span>, <span class="va">n</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    FN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_ur</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="va">is_ur_detected</span>, <span class="va">n</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    tpr <span class="op">=</span> <span class="va">TP</span> <span class="op">/</span> <span class="va">P</span>,</span>
<span>    tpr_ci95_low <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">TP</span>, <span class="va">P</span>, <span class="va">get_prop_test_ci95</span>, ix <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    tpr_ci95_high <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">TP</span>, <span class="va">P</span>, <span class="va">get_prop_test_ci95</span>, ix <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    fpr <span class="op">=</span> <span class="va">FP</span> <span class="op">/</span> <span class="va">N</span>,</span>
<span>    fpr_ci95_low <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">FP</span>, <span class="va">N</span>, <span class="va">get_prop_test_ci95</span>, ix <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    fpr_ci95_high <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">FP</span>, <span class="va">N</span>, <span class="va">get_prop_test_ci95</span>, ix <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df_perf_st</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digit <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="5%">
<col width="3%">
<col width="3%">
<col width="2%">
<col width="4%">
<col width="3%">
<col width="5%">
<col width="12%">
<col width="13%">
<col width="6%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="right">ur_rate</th>
<th align="right">N</th>
<th align="right">P</th>
<th align="right">TP</th>
<th align="right">FP</th>
<th align="right">TN</th>
<th align="right">FN</th>
<th align="right">tpr</th>
<th align="right">tpr_ci95_low</th>
<th align="right">tpr_ci95_high</th>
<th align="right">fpr</th>
<th align="right">fpr_ci95_low</th>
<th align="right">fpr_ci95_high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.00</td>
<td align="right">10000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">23</td>
<td align="right">9977</td>
<td align="right">0</td>
<td align="right">NaN</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.0023</td>
<td align="right">0.0015</td>
<td align="right">0.0035</td>
</tr>
<tr class="even">
<td align="right">0.10</td>
<td align="right">9500</td>
<td align="right">500</td>
<td align="right">14</td>
<td align="right">18</td>
<td align="right">9482</td>
<td align="right">486</td>
<td align="right">0.028</td>
<td align="right">0.0160</td>
<td align="right">0.0477</td>
<td align="right">0.0019</td>
<td align="right">0.0012</td>
<td align="right">0.0031</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">9500</td>
<td align="right">500</td>
<td align="right">136</td>
<td align="right">14</td>
<td align="right">9486</td>
<td align="right">364</td>
<td align="right">0.272</td>
<td align="right">0.2339</td>
<td align="right">0.3137</td>
<td align="right">0.0015</td>
<td align="right">0.0008</td>
<td align="right">0.0025</td>
</tr>
<tr class="even">
<td align="right">0.50</td>
<td align="right">9500</td>
<td align="right">500</td>
<td align="right">488</td>
<td align="right">13</td>
<td align="right">9487</td>
<td align="right">12</td>
<td align="right">0.976</td>
<td align="right">0.9573</td>
<td align="right">0.9869</td>
<td align="right">0.0014</td>
<td align="right">0.0008</td>
<td align="right">0.0024</td>
</tr>
<tr class="odd">
<td align="right">0.75</td>
<td align="right">9500</td>
<td align="right">500</td>
<td align="right">500</td>
<td align="right">1</td>
<td align="right">9499</td>
<td align="right">0</td>
<td align="right">1.000</td>
<td align="right">0.9905</td>
<td align="right">1.0000</td>
<td align="right">0.0001</td>
<td align="right">0.0000</td>
<td align="right">0.0007</td>
</tr>
<tr class="even">
<td align="right">1.00</td>
<td align="right">9500</td>
<td align="right">500</td>
<td align="right">500</td>
<td align="right">0</td>
<td align="right">9500</td>
<td align="right">0</td>
<td align="right">1.000</td>
<td align="right">0.9905</td>
<td align="right">1.0000</td>
<td align="right">0.0000</td>
<td align="right">0.0000</td>
<td align="right">0.0005</td>
</tr>
</tbody>
</table>
<p>Under ideal conditions sites with 0.5 under-reporting rate or more
will almost all get flagged with a ratio of 0.97 or more with minimal
ratio for false positive flags &lt; 0.003.</p>
</div>
<div class="section level3">
<h3 id="effect-of-adjusting-visit_med75">Effect of Adjusting visit_med75<a class="anchor" aria-label="anchor" href="#effect-of-adjusting-visit_med75"></a>
</h3>
<p>One of the latest update to simaerep was an improvement to the
visit_med75 calculation. We can check how this has affected portfolio
performance. We find that we have most likely slightly increased
performance.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_scen_old_visit_med75</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_ur_scenarios.html">sim_ur_scenarios</a></span><span class="op">(</span></span>
<span>   <span class="va">df_portf</span>,</span>
<span>   extra_ur_sites <span class="op">=</span> <span class="fl">5</span>,</span>
<span>   ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>   parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   poisson <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   site_aggr_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"med75"</span><span class="op">)</span> <span class="co"># default is "med75_adj"</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">df_scen_old_visit_med75</span>, file <span class="op">=</span> <span class="st">"scen_old.csv"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_scen_old_visit_med75</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"scen_old.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_scen_old_visit_med75</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="5%">
<col width="2%">
<col width="7%">
<col width="5%">
<col width="8%">
<col width="8%">
<col width="10%">
<col width="6%">
<col width="7%">
<col width="3%">
<col width="4%">
<col width="3%">
<col width="4%">
<col width="5%">
<col width="5%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="left">site_number</th>
<th align="right">n_pat</th>
<th align="right">n_pat_with_med75</th>
<th align="right">visit_med75</th>
<th align="right">mean_ae_site_med75</th>
<th align="right">mean_ae_study_med75</th>
<th align="right">n_pat_with_med75_study</th>
<th align="right">extra_ur_sites</th>
<th align="right">frac_pat_with_ur</th>
<th align="right">ur_rate</th>
<th align="right">pval</th>
<th align="right">prob_low</th>
<th align="right">pval_adj</th>
<th align="right">pval_prob_ur</th>
<th align="right">prob_low_adj</th>
<th align="right">prob_low_prob_ur</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">5.00</td>
<td align="right">4.707547</td>
<td align="right">106</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
<td align="right">0.00</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">4.50</td>
<td align="right">4.707547</td>
<td align="right">106</td>
<td align="right">0</td>
<td align="right">0.0185185</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">0.563</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.6299688</td>
<td align="right">0.3700312</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">3.75</td>
<td align="right">4.707547</td>
<td align="right">106</td>
<td align="right">0</td>
<td align="right">0.0185185</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">0.318</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.4065155</td>
<td align="right">0.5934845</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">2.50</td>
<td align="right">4.707547</td>
<td align="right">106</td>
<td align="right">0</td>
<td align="right">0.0185185</td>
<td align="right">0.50</td>
<td align="right">0.1847070</td>
<td align="right">0.103</td>
<td align="right">0.7498223</td>
<td align="right">0.2501777</td>
<td align="right">0.1953992</td>
<td align="right">0.8046008</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">1.25</td>
<td align="right">4.707547</td>
<td align="right">106</td>
<td align="right">0</td>
<td align="right">0.0185185</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
<td align="right">0.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">0.00</td>
<td align="right">4.707547</td>
<td align="right">106</td>
<td align="right">0</td>
<td align="right">0.0185185</td>
<td align="right">1.00</td>
<td align="right">0.0001700</td>
<td align="right">0.000</td>
<td align="right">0.0017703</td>
<td align="right">0.9982297</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">4.50</td>
<td align="right">4.701887</td>
<td align="right">106</td>
<td align="right">1</td>
<td align="right">0.0412458</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">0.563</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.6299688</td>
<td align="right">0.3700312</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">3.75</td>
<td align="right">4.693396</td>
<td align="right">106</td>
<td align="right">1</td>
<td align="right">0.0412458</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">0.325</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.4135261</td>
<td align="right">0.5864739</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">2.50</td>
<td align="right">4.679245</td>
<td align="right">106</td>
<td align="right">1</td>
<td align="right">0.0412458</td>
<td align="right">0.50</td>
<td align="right">0.1844486</td>
<td align="right">0.114</td>
<td align="right">0.7498223</td>
<td align="right">0.2501777</td>
<td align="right">0.2062281</td>
<td align="right">0.7937719</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">1.25</td>
<td align="right">4.665094</td>
<td align="right">106</td>
<td align="right">1</td>
<td align="right">0.0412458</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
<td align="right">0.004</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0220000</td>
<td align="right">0.9780000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">0.00</td>
<td align="right">4.650943</td>
<td align="right">106</td>
<td align="right">1</td>
<td align="right">0.0412458</td>
<td align="right">1.00</td>
<td align="right">0.0001673</td>
<td align="right">0.001</td>
<td align="right">0.0017703</td>
<td align="right">0.9982297</td>
<td align="right">0.0076201</td>
<td align="right">0.9923799</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">4.50</td>
<td align="right">4.693396</td>
<td align="right">106</td>
<td align="right">2</td>
<td align="right">0.0639731</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">0.563</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.6299688</td>
<td align="right">0.3700312</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">3.75</td>
<td align="right">4.672170</td>
<td align="right">106</td>
<td align="right">2</td>
<td align="right">0.0639731</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">0.335</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.4242711</td>
<td align="right">0.5757289</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">2.50</td>
<td align="right">4.636793</td>
<td align="right">106</td>
<td align="right">2</td>
<td align="right">0.0639731</td>
<td align="right">0.50</td>
<td align="right">1.0000000</td>
<td align="right">0.127</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.2203919</td>
<td align="right">0.7796081</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">1.25</td>
<td align="right">4.601415</td>
<td align="right">106</td>
<td align="right">2</td>
<td align="right">0.0639731</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
<td align="right">0.011</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0420280</td>
<td align="right">0.9579720</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">0.00</td>
<td align="right">4.566038</td>
<td align="right">106</td>
<td align="right">2</td>
<td align="right">0.0639731</td>
<td align="right">1.00</td>
<td align="right">0.0002567</td>
<td align="right">0.005</td>
<td align="right">0.0025559</td>
<td align="right">0.9974441</td>
<td align="right">0.0254478</td>
<td align="right">0.9745522</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">4.50</td>
<td align="right">4.686793</td>
<td align="right">106</td>
<td align="right">3</td>
<td align="right">0.0867003</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">0.563</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.6299688</td>
<td align="right">0.3700312</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">3.75</td>
<td align="right">4.655660</td>
<td align="right">106</td>
<td align="right">3</td>
<td align="right">0.0867003</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">0.339</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.4285412</td>
<td align="right">0.5714588</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">2.50</td>
<td align="right">4.603774</td>
<td align="right">106</td>
<td align="right">3</td>
<td align="right">0.0867003</td>
<td align="right">0.50</td>
<td align="right">0.2376636</td>
<td align="right">0.134</td>
<td align="right">0.9209466</td>
<td align="right">0.0790534</td>
<td align="right">0.2250936</td>
<td align="right">0.7749064</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">1.25</td>
<td align="right">4.551887</td>
<td align="right">106</td>
<td align="right">3</td>
<td align="right">0.0867003</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
<td align="right">0.014</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0497292</td>
<td align="right">0.9502708</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">0.00</td>
<td align="right">4.500000</td>
<td align="right">106</td>
<td align="right">3</td>
<td align="right">0.0867003</td>
<td align="right">1.00</td>
<td align="right">0.0002474</td>
<td align="right">0.007</td>
<td align="right">0.0024993</td>
<td align="right">0.9975007</td>
<td align="right">0.0323661</td>
<td align="right">0.9676339</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">4.50</td>
<td align="right">4.674528</td>
<td align="right">106</td>
<td align="right">4</td>
<td align="right">0.1094276</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">0.565</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.6301390</td>
<td align="right">0.3698610</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">3.75</td>
<td align="right">4.625000</td>
<td align="right">106</td>
<td align="right">4</td>
<td align="right">0.1094276</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">0.358</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.4492291</td>
<td align="right">0.5507709</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">2.50</td>
<td align="right">4.542453</td>
<td align="right">106</td>
<td align="right">4</td>
<td align="right">0.1094276</td>
<td align="right">0.50</td>
<td align="right">1.0000000</td>
<td align="right">0.149</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.2413729</td>
<td align="right">0.7586271</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">1.25</td>
<td align="right">4.459906</td>
<td align="right">106</td>
<td align="right">4</td>
<td align="right">0.1094276</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
<td align="right">0.019</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0621487</td>
<td align="right">0.9378513</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_perf_portf_old_visit_med75</span> <span class="op">&lt;-</span> <span class="va">df_scen_old_visit_med75</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_ur <span class="op">=</span> <span class="va">prob_low_prob_ur</span> <span class="op">&gt;=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="va">is_ur</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">is_ur</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">n</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"is_ur_"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    n_sites <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">+</span> <span class="va">is_ur_FALSE</span>,</span>
<span>    ratio <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">/</span> <span class="va">n_sites</span>,</span>
<span>    ratio_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"fpr"</span>, <span class="st">"tpr"</span><span class="op">)</span>,</span>
<span>    ci95_low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    ci95_high <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="va">df_perf_portf_old_visit_med75</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="10%">
<col width="16%">
<col width="14%">
<col width="10%">
<col width="8%">
<col width="14%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="right">ur_rate</th>
<th align="right">is_ur_FALSE</th>
<th align="right">is_ur_TRUE</th>
<th align="right">n_sites</th>
<th align="right">ratio</th>
<th align="left">ratio_type</th>
<th align="right">ci95_low</th>
<th align="right">ci95_high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.00</td>
<td align="right">15483</td>
<td align="right">191</td>
<td align="right">15674</td>
<td align="right">0.012</td>
<td align="left">fpr</td>
<td align="right">0.011</td>
<td align="right">0.014</td>
</tr>
<tr class="even">
<td align="right">0.10</td>
<td align="right">89434</td>
<td align="right">4610</td>
<td align="right">94044</td>
<td align="right">0.049</td>
<td align="left">tpr</td>
<td align="right">0.048</td>
<td align="right">0.050</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">78146</td>
<td align="right">15898</td>
<td align="right">94044</td>
<td align="right">0.169</td>
<td align="left">tpr</td>
<td align="right">0.167</td>
<td align="right">0.171</td>
</tr>
<tr class="even">
<td align="right">0.50</td>
<td align="right">54906</td>
<td align="right">39138</td>
<td align="right">94044</td>
<td align="right">0.416</td>
<td align="left">tpr</td>
<td align="right">0.413</td>
<td align="right">0.419</td>
</tr>
<tr class="odd">
<td align="right">0.75</td>
<td align="right">37642</td>
<td align="right">56402</td>
<td align="right">94044</td>
<td align="right">0.600</td>
<td align="left">tpr</td>
<td align="right">0.597</td>
<td align="right">0.603</td>
</tr>
<tr class="even">
<td align="right">1.00</td>
<td align="right">33631</td>
<td align="right">60413</td>
<td align="right">94044</td>
<td align="right">0.642</td>
<td align="left">tpr</td>
<td align="right">0.639</td>
<td align="right">0.645</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="days-vs--visits">Days vs.Â Visits<a class="anchor" aria-label="anchor" href="#days-vs--visits"></a>
</h3>
<p>Instead of normalising the AEs per patient by visit an alternative
could be to normalise by the number of days that have passed since the
patients enrollment. {simaerep} can be used for both types of
normalisation which is demonstrated <a href="https://openpharma.github.io/simaerep/articles/visits_or_days.html">here</a>.
But normalising by days is a bit more complex as it creates more data
points.</p>
<p>The maximum number of days per patient can be up to several years, so
&gt; 1000 days. simaerep exposes implicitly missing entries which can
lead to single patients having 1000 entries or more, one entry for each
day on the study. In order to avoid to generate a huge portfolio data
frame we preserve memory by wrapping
<code><a href="../reference/sim_test_data_portfolio.html">sim_test_data_portfolio()</a></code> and
<code><a href="../reference/sim_ur_scenarios.html">sim_ur_scenarios()</a></code> into a single call and apply it per
study.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df_portf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_portfolio.html">sim_test_data_portfolio</a></span><span class="op">(</span><span class="va">df</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">df_scen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_ur_scenarios.html">sim_ur_scenarios</a></span><span class="op">(</span><span class="va">df_portf</span>,</span>
<span>                               extra_ur_sites <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                               ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                               parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                               poisson <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                               prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                               progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df_scen</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_prep</span> <span class="op">&lt;-</span> <span class="va">df_config</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span> <span class="va">max_visit_sd</span>, <span class="op">-</span> <span class="va">max_visit_mean</span>, <span class="op">-</span> <span class="va">ae_per_visit_mean</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>max_visit_sd <span class="op">=</span> <span class="va">max_days_sd</span>,</span>
<span>         max_visit_mean <span class="op">=</span> <span class="va">max_days_mean</span>,</span>
<span>         ae_per_visit_mean <span class="op">=</span> <span class="va">ae_per_day_mean</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>study_id_gr <span class="op">=</span> <span class="va">study_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span></span>
<span>  <span class="va">df_scen_days</span> <span class="op">&lt;-</span> <span class="va">df_prep</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/purrr_bar.html">purrr_bar</a></span><span class="op">(</span></span>
<span>      <span class="va">.data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>      .purrr <span class="op">=</span> <span class="fu">furrr</span><span class="fu">::</span><span class="va"><a href="https://furrr.futureverse.org/reference/future_map.html" class="external-link">future_map</a></span>,</span>
<span>      .f <span class="op">=</span> <span class="va">wr</span>,</span>
<span>      .progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      .steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,</span>
<span>      .purrr_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>.options <span class="op">=</span> <span class="fu"><a href="https://furrr.futureverse.org/reference/furrr_options.html" class="external-link">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>   <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_scen_days</span> <span class="op">&lt;-</span> <span class="va">df_scen_days</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span> <span class="va">study_id_gr</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">df_scen_days</span>, file <span class="op">=</span> <span class="st">"scen_days.csv"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_scen_days</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"scen_days.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_scen_days</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="5%">
<col width="2%">
<col width="7%">
<col width="5%">
<col width="8%">
<col width="8%">
<col width="10%">
<col width="6%">
<col width="7%">
<col width="3%">
<col width="4%">
<col width="3%">
<col width="4%">
<col width="5%">
<col width="5%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">study_id</th>
<th align="left">site_number</th>
<th align="right">n_pat</th>
<th align="right">n_pat_with_med75</th>
<th align="right">visit_med75</th>
<th align="right">mean_ae_site_med75</th>
<th align="right">mean_ae_study_med75</th>
<th align="right">n_pat_with_med75_study</th>
<th align="right">extra_ur_sites</th>
<th align="right">frac_pat_with_ur</th>
<th align="right">ur_rate</th>
<th align="right">pval</th>
<th align="right">prob_low</th>
<th align="right">pval_adj</th>
<th align="right">pval_prob_ur</th>
<th align="right">prob_low_adj</th>
<th align="right">prob_low_prob_ur</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">7.00</td>
<td align="right">5.057971</td>
<td align="right">69</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
<td align="right">0.00</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">6.30</td>
<td align="right">5.057971</td>
<td align="right">69</td>
<td align="right">0</td>
<td align="right">0.0142857</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">5.25</td>
<td align="right">5.057971</td>
<td align="right">69</td>
<td align="right">0</td>
<td align="right">0.0142857</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">3.50</td>
<td align="right">5.057971</td>
<td align="right">69</td>
<td align="right">0</td>
<td align="right">0.0142857</td>
<td align="right">0.50</td>
<td align="right">1.0000000</td>
<td align="right">0.314</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.4922943</td>
<td align="right">0.5077057</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">1.75</td>
<td align="right">5.057971</td>
<td align="right">69</td>
<td align="right">0</td>
<td align="right">0.0142857</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
<td align="right">0.086</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.2225882</td>
<td align="right">0.7774118</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">0.00</td>
<td align="right">5.057971</td>
<td align="right">69</td>
<td align="right">0</td>
<td align="right">0.0142857</td>
<td align="right">1.00</td>
<td align="right">0.0115864</td>
<td align="right">0.012</td>
<td align="right">0.0763468</td>
<td align="right">0.9236532</td>
<td align="right">0.0798996</td>
<td align="right">0.9201004</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">6.30</td>
<td align="right">5.042029</td>
<td align="right">69</td>
<td align="right">1</td>
<td align="right">0.0445887</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">5.25</td>
<td align="right">5.018116</td>
<td align="right">69</td>
<td align="right">1</td>
<td align="right">0.0445887</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">3.50</td>
<td align="right">4.978261</td>
<td align="right">69</td>
<td align="right">1</td>
<td align="right">0.0445887</td>
<td align="right">0.50</td>
<td align="right">1.0000000</td>
<td align="right">0.345</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.5323303</td>
<td align="right">0.4676697</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">1.75</td>
<td align="right">4.938406</td>
<td align="right">69</td>
<td align="right">1</td>
<td align="right">0.0445887</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
<td align="right">0.117</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.2633465</td>
<td align="right">0.7366535</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">0.00</td>
<td align="right">4.898551</td>
<td align="right">69</td>
<td align="right">1</td>
<td align="right">0.0445887</td>
<td align="right">1.00</td>
<td align="right">0.0180113</td>
<td align="right">0.043</td>
<td align="right">0.1138819</td>
<td align="right">0.8861181</td>
<td align="right">0.1413301</td>
<td align="right">0.8586699</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">6.30</td>
<td align="right">5.020290</td>
<td align="right">69</td>
<td align="right">2</td>
<td align="right">0.0748918</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">5.25</td>
<td align="right">4.963768</td>
<td align="right">69</td>
<td align="right">2</td>
<td align="right">0.0748918</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">3.50</td>
<td align="right">4.869565</td>
<td align="right">69</td>
<td align="right">2</td>
<td align="right">0.0748918</td>
<td align="right">0.50</td>
<td align="right">1.0000000</td>
<td align="right">0.360</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.5419868</td>
<td align="right">0.4580132</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">1.75</td>
<td align="right">4.775362</td>
<td align="right">69</td>
<td align="right">2</td>
<td align="right">0.0748918</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
<td align="right">0.132</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.2813250</td>
<td align="right">0.7186750</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">0.00</td>
<td align="right">4.681159</td>
<td align="right">69</td>
<td align="right">2</td>
<td align="right">0.0748918</td>
<td align="right">1.00</td>
<td align="right">0.0170755</td>
<td align="right">0.071</td>
<td align="right">0.1100934</td>
<td align="right">0.8899066</td>
<td align="right">0.1980450</td>
<td align="right">0.8019550</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">6.30</td>
<td align="right">4.998551</td>
<td align="right">69</td>
<td align="right">3</td>
<td align="right">0.1051948</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">5.25</td>
<td align="right">4.909420</td>
<td align="right">69</td>
<td align="right">3</td>
<td align="right">0.1051948</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">3.50</td>
<td align="right">4.760870</td>
<td align="right">69</td>
<td align="right">3</td>
<td align="right">0.1051948</td>
<td align="right">0.50</td>
<td align="right">1.0000000</td>
<td align="right">0.378</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.5549968</td>
<td align="right">0.4450032</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">1.75</td>
<td align="right">4.612319</td>
<td align="right">69</td>
<td align="right">3</td>
<td align="right">0.1051948</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
<td align="right">0.150</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.3062874</td>
<td align="right">0.6937126</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">0.00</td>
<td align="right">4.463768</td>
<td align="right">69</td>
<td align="right">3</td>
<td align="right">0.1051948</td>
<td align="right">1.00</td>
<td align="right">0.0260996</td>
<td align="right">0.100</td>
<td align="right">0.1596408</td>
<td align="right">0.8403592</td>
<td align="right">0.2435714</td>
<td align="right">0.7564286</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">6.30</td>
<td align="right">4.979710</td>
<td align="right">69</td>
<td align="right">4</td>
<td align="right">0.1354978</td>
<td align="right">0.10</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">5.25</td>
<td align="right">4.862319</td>
<td align="right">69</td>
<td align="right">4</td>
<td align="right">0.1354978</td>
<td align="right">0.25</td>
<td align="right">1.0000000</td>
<td align="right">1.000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">3.50</td>
<td align="right">4.666667</td>
<td align="right">69</td>
<td align="right">4</td>
<td align="right">0.1354978</td>
<td align="right">0.50</td>
<td align="right">1.0000000</td>
<td align="right">0.403</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.5854015</td>
<td align="right">0.4145985</td>
</tr>
<tr class="odd">
<td align="left">0001</td>
<td align="left">0001</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">680</td>
<td align="right">1.75</td>
<td align="right">4.471014</td>
<td align="right">69</td>
<td align="right">4</td>
<td align="right">0.1354978</td>
<td align="right">0.75</td>
<td align="right">1.0000000</td>
<td align="right">0.175</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.3260929</td>
<td align="right">0.6739071</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_perf_portf_days</span> <span class="op">&lt;-</span> <span class="va">df_scen_days</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_ur <span class="op">=</span> <span class="va">prob_low_prob_ur</span> <span class="op">&gt;=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="va">is_ur</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">is_ur</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">n</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"is_ur_"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    n_sites <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">+</span> <span class="va">is_ur_FALSE</span>,</span>
<span>    ratio <span class="op">=</span> <span class="va">is_ur_TRUE</span> <span class="op">/</span> <span class="va">n_sites</span>,</span>
<span>    ratio_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"fpr"</span>, <span class="st">"tpr"</span><span class="op">)</span>,</span>
<span>    ci95_low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    ci95_high <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test</a></span><span class="op">(</span><span class="va">is_ur_TRUE</span>, <span class="va">n_sites</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="va">df_perf_portf_days</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="10%">
<col width="16%">
<col width="14%">
<col width="10%">
<col width="8%">
<col width="14%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="right">ur_rate</th>
<th align="right">is_ur_FALSE</th>
<th align="right">is_ur_TRUE</th>
<th align="right">n_sites</th>
<th align="right">ratio</th>
<th align="left">ratio_type</th>
<th align="right">ci95_low</th>
<th align="right">ci95_high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.00</td>
<td align="right">15450</td>
<td align="right">224</td>
<td align="right">15674</td>
<td align="right">0.014</td>
<td align="left">fpr</td>
<td align="right">0.013</td>
<td align="right">0.016</td>
</tr>
<tr class="even">
<td align="right">0.10</td>
<td align="right">87426</td>
<td align="right">6618</td>
<td align="right">94044</td>
<td align="right">0.070</td>
<td align="left">tpr</td>
<td align="right">0.069</td>
<td align="right">0.072</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">72046</td>
<td align="right">21998</td>
<td align="right">94044</td>
<td align="right">0.234</td>
<td align="left">tpr</td>
<td align="right">0.231</td>
<td align="right">0.237</td>
</tr>
<tr class="even">
<td align="right">0.50</td>
<td align="right">50373</td>
<td align="right">43671</td>
<td align="right">94044</td>
<td align="right">0.464</td>
<td align="left">tpr</td>
<td align="right">0.461</td>
<td align="right">0.468</td>
</tr>
<tr class="odd">
<td align="right">0.75</td>
<td align="right">38042</td>
<td align="right">56002</td>
<td align="right">94044</td>
<td align="right">0.595</td>
<td align="left">tpr</td>
<td align="right">0.592</td>
<td align="right">0.599</td>
</tr>
<tr class="even">
<td align="right">1.00</td>
<td align="right">37942</td>
<td align="right">56102</td>
<td align="right">94044</td>
<td align="right">0.597</td>
<td align="left">tpr</td>
<td align="right">0.593</td>
<td align="right">0.600</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="heuristic-rank">Heuristic Rank<a class="anchor" aria-label="anchor" href="#heuristic-rank"></a>
</h3>
<p>Instead of using {simaerep} we can also use a heuristic method based
on AE per visit and apply that to the simulated portfolio with different
scenarios of under-reporting</p>
<ul>
<li>Flag 5% (always round up) of all sites in a study that have the
lowest AE per visit rate.</li>
<li>Always flag sites with no AEs.</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ae_per_vs</span> <span class="op">&lt;-</span><span class="va">df_portf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">patnum</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">visit</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">visit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">site_number</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">visit</span><span class="op">)</span>,</span>
<span>            n_ae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_ae</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ae_per_visit <span class="op">=</span> <span class="va">n_ae</span> <span class="op">/</span> <span class="va">visit</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ls_study_ae_per_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ae_per_visit</span><span class="op">)</span>,</span>
<span>    rwn <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="co"># we take out site ae_per_visit from study pool</span></span>
<span>    ls_study_ae_per_visit <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span></span>
<span>        <span class="va">ls_study_ae_per_visit</span>, <span class="va">rwn</span>,</span>
<span>        <span class="kw">function</span><span class="op">(</span><span class="va">ls</span>, <span class="va">rwn</span><span class="op">)</span> <span class="va">ls</span><span class="op">[</span><span class="op">-</span> <span class="va">rwn</span><span class="op">]</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span> <span class="va">rwn</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_ae_per_vs</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 15,674 Ã— 6</span></span></span>
<span><span class="co">##    study_id site_number visit  n_ae ae_per_visit ls_study_ae_per_visit</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 0001     0001           42    10        0.238 <span style="color: #949494;">&lt;dbl [43]&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 0001     0002           60    14        0.233 <span style="color: #949494;">&lt;dbl [43]&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 0001     0003           78    25        0.321 <span style="color: #949494;">&lt;dbl [43]&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 0001     0004          189    43        0.228 <span style="color: #949494;">&lt;dbl [43]&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 0001     0005           30     7        0.233 <span style="color: #949494;">&lt;dbl [43]&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 0001     0006           35     9        0.257 <span style="color: #949494;">&lt;dbl [43]&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 0001     0007           36     9        0.25  <span style="color: #949494;">&lt;dbl [43]&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 0001     0008          192    64        0.333 <span style="color: #949494;">&lt;dbl [43]&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 0001     0009           40     8        0.2   <span style="color: #949494;">&lt;dbl [43]&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 0001     0010          134    30        0.224 <span style="color: #949494;">&lt;dbl [43]&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 15,664 more rows</span></span></span></code></pre>
<p>We write a function that: - determines how many sites should be
flagged in a study - pools ae_per_visit rates and ranks sites (using
dense_rank()) - site gets flagged if the specific rank for a site is
within the number of sites that should get flagged</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flag_heuristics_rnk</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ae_per_visit</span>, <span class="va">ls_study_ae_per_visit</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">n_flags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ls_study_ae_per_visit</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">rnk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>ae_per_visit <span class="op">=</span> <span class="va">ae_per_visit</span>, site <span class="op">=</span> <span class="st">"site"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>ae_per_visit <span class="op">=</span> <span class="va">ls_study_ae_per_visit</span>, site <span class="op">=</span> <span class="st">"other"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># using dense_rank will assign rank 1 to all sites with lowest rate</span></span>
<span>    <span class="co"># this is important as there can be many sites with a zero ratio</span></span>
<span>    <span class="co"># occasionally this will flag more sites than anticipated</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">ae_per_visit</span>, <span class="va">site</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rnk <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">dense_rank</a></span><span class="op">(</span><span class="va">ae_per_visit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">site</span> <span class="op">==</span> <span class="st">"site"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">rnk</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">rnk</span> <span class="op">&lt;=</span> <span class="va">n_flags</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">flag_heuristics_rnk</span><span class="op">(</span></span>
<span>  <span class="va">df_ae_per_vs</span><span class="op">$</span><span class="va">ae_per_visit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">df_ae_per_vs</span><span class="op">$</span><span class="va">ls_study_ae_per_visit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
<p>Next we wrap that function with another function simulates
under-reporting</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_heuristic_ur</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ae_per_visit</span>,</span>
<span>                             <span class="va">ls_study_ae_per_visit</span>,</span>
<span>                             <span class="va">ur_rates</span>,</span>
<span>                             <span class="va">.f</span> <span class="op">=</span> <span class="va">flag_heuristics_rnk</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    ur_rate <span class="op">=</span> <span class="va">ur_rates</span>,</span>
<span>    ae_per_visit <span class="op">=</span> <span class="va">ae_per_visit</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ae_per_visit <span class="op">=</span> <span class="va">ae_per_visit</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ur_rate</span><span class="op">)</span>,</span>
<span>    is_ur <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">ae_per_visit</span>, <span class="va">.f</span>, <span class="va">ls_study_ae_per_visit</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">sim_heuristic_ur</span><span class="op">(</span></span>
<span>  <span class="va">df_ae_per_vs</span><span class="op">$</span><span class="va">ae_per_visit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">df_ae_per_vs</span><span class="op">$</span><span class="va">ls_study_ae_per_visit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  ur_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 Ã— 3</span></span></span>
<span><span class="co">##   ur_rate ae_per_visit is_ur</span></span>
<span><span class="co">##     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    0          0.238  FALSE</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>    0.1        0.214  FALSE</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>    0.25       0.179  FALSE</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>    0.5        0.119  TRUE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>    0.75       0.059<span style="text-decoration: underline;">5</span> TRUE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>    1          0      TRUE</span></span></code></pre>
<p>We apply.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span></span>
<span>  <span class="va">df_perf_heuristic_rnk</span> <span class="op">&lt;-</span> <span class="va">df_ae_per_vs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      sim <span class="op">=</span> <span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/purrr_bar.html">purrr_bar</a></span><span class="op">(</span></span>
<span>        <span class="va">ae_per_visit</span>, <span class="va">ls_study_ae_per_visit</span>,</span>
<span>        .purrr <span class="op">=</span> <span class="fu">furrr</span><span class="fu">::</span><span class="va"><a href="https://furrr.futureverse.org/reference/future_map2.html" class="external-link">future_map2</a></span>,</span>
<span>        .f <span class="op">=</span> <span class="va">sim_heuristic_ur</span>,</span>
<span>        .f_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ur_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        .steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_perf_heuristic_rnk</span> <span class="op">&lt;-</span> <span class="va">df_perf_heuristic_rnk</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ur_rate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    is_ur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">is_ur</span><span class="op">)</span>,</span>
<span>    n_sites <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ratio <span class="op">=</span> <span class="va">is_ur</span> <span class="op">/</span> <span class="va">n_sites</span>,</span>
<span>    ratio_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"fpr"</span>, <span class="st">"tpr"</span><span class="op">)</span>,</span>
<span>    ci95_low <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">is_ur</span>, <span class="va">n_sites</span>, <span class="va">get_prop_test_ci95</span>, ix <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    ci95_high <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">is_ur</span>, <span class="va">n_sites</span>, <span class="va">get_prop_test_ci95</span>, ix <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">df_perf_heuristic_rnk</span>, file <span class="op">=</span> <span class="st">"heuristic_rnk.csv"</span><span class="op">)</span></span></code></pre></div>
<p>We see that this method is generously flagging sites resulting in
good tpr at the cost of a high fpr. By default at least one site per
study gets flagged.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_perf_heuristic_rnk</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"heuristic_rnk.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_perf_heuristic_rnk</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">ur_rate</th>
<th align="right">is_ur</th>
<th align="right">n_sites</th>
<th align="right">ratio</th>
<th align="left">ratio_type</th>
<th align="right">ci95_low</th>
<th align="right">ci95_high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.00</td>
<td align="right">1541</td>
<td align="right">15674</td>
<td align="right">0.098</td>
<td align="left">fpr</td>
<td align="right">0.094</td>
<td align="right">0.103</td>
</tr>
<tr class="even">
<td align="right">0.10</td>
<td align="right">2096</td>
<td align="right">15674</td>
<td align="right">0.134</td>
<td align="left">tpr</td>
<td align="right">0.128</td>
<td align="right">0.139</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">4598</td>
<td align="right">15674</td>
<td align="right">0.293</td>
<td align="left">tpr</td>
<td align="right">0.286</td>
<td align="right">0.301</td>
</tr>
<tr class="even">
<td align="right">0.50</td>
<td align="right">11593</td>
<td align="right">15674</td>
<td align="right">0.740</td>
<td align="left">tpr</td>
<td align="right">0.733</td>
<td align="right">0.746</td>
</tr>
<tr class="odd">
<td align="right">0.75</td>
<td align="right">15164</td>
<td align="right">15674</td>
<td align="right">0.967</td>
<td align="left">tpr</td>
<td align="right">0.965</td>
<td align="right">0.970</td>
</tr>
<tr class="even">
<td align="right">1.00</td>
<td align="right">15674</td>
<td align="right">15674</td>
<td align="right">1.000</td>
<td align="left">tpr</td>
<td align="right">1.000</td>
<td align="right">1.000</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="heuristic-box-plot-outlier">Heuristic Box Plot Outlier<a class="anchor" aria-label="anchor" href="#heuristic-box-plot-outlier"></a>
</h3>
<p>We can also imagine a heuristic that tries to detect lower boundary
outliers on the basis of the ae per visit rate. This should be flagging
more conservatively without flagging sites by default. A simple
non-parametric method for outlier detection is to calculate box plot
statistic and to flag all points that are below the lower whisker
boundary.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flag_heuristics_box</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ae_per_visit</span>, <span class="va">ls_study_ae_per_visit</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">min_whisker</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/boxplot.stats.html" class="external-link">boxplot.stats</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ae_per_visit</span>, <span class="va">ls_study_ae_per_visit</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">stats</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ae_per_visit</span> <span class="op">&lt;</span> <span class="va">min_whisker</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">flag_heuristics_box</span><span class="op">(</span></span>
<span>  <span class="va">df_ae_per_vs</span><span class="op">$</span><span class="va">ae_per_visit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">df_ae_per_vs</span><span class="op">$</span><span class="va">ls_study_ae_per_visit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">flag_heuristics_box</span><span class="op">(</span></span>
<span>  <span class="fl">0</span>,</span>
<span>  <span class="va">df_ae_per_vs</span><span class="op">$</span><span class="va">ls_study_ae_per_visit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>We apply.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span></span>
<span>  <span class="va">df_perf_heuristic_box</span> <span class="op">&lt;-</span> <span class="va">df_ae_per_vs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      sim <span class="op">=</span> <span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/purrr_bar.html">purrr_bar</a></span><span class="op">(</span></span>
<span>        <span class="va">ae_per_visit</span>, <span class="va">ls_study_ae_per_visit</span>,</span>
<span>        .purrr <span class="op">=</span> <span class="fu">furrr</span><span class="fu">::</span><span class="va"><a href="https://furrr.futureverse.org/reference/future_map2.html" class="external-link">future_map2</a></span>,</span>
<span>        .f <span class="op">=</span> <span class="va">sim_heuristic_ur</span>,</span>
<span>        .f_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          ur_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>          .f <span class="op">=</span> <span class="va">flag_heuristics_box</span></span>
<span>          <span class="op">)</span>,</span>
<span>        .steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_perf_heuristic_box</span> <span class="op">&lt;-</span> <span class="va">df_perf_heuristic_box</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ur_rate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    is_ur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">is_ur</span><span class="op">)</span>,</span>
<span>    n_sites <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ratio <span class="op">=</span> <span class="va">is_ur</span> <span class="op">/</span> <span class="va">n_sites</span>,</span>
<span>    ratio_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"fpr"</span>, <span class="st">"tpr"</span><span class="op">)</span>,</span>
<span>    ci95_low <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">is_ur</span>, <span class="va">n_sites</span>, <span class="va">get_prop_test_ci95</span>, ix <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    ci95_high <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span><span class="va">is_ur</span>, <span class="va">n_sites</span>, <span class="va">get_prop_test_ci95</span>, ix <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">df_perf_heuristic_box</span>, file <span class="op">=</span> <span class="st">"heuristic_box.csv"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_perf_heuristic_box</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"heuristic_box.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_perf_heuristic_box</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">ur_rate</th>
<th align="right">is_ur</th>
<th align="right">n_sites</th>
<th align="right">ratio</th>
<th align="left">ratio_type</th>
<th align="right">ci95_low</th>
<th align="right">ci95_high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.00</td>
<td align="right">412</td>
<td align="right">15674</td>
<td align="right">0.026</td>
<td align="left">fpr</td>
<td align="right">0.024</td>
<td align="right">0.029</td>
</tr>
<tr class="even">
<td align="right">0.10</td>
<td align="right">609</td>
<td align="right">15674</td>
<td align="right">0.039</td>
<td align="left">tpr</td>
<td align="right">0.036</td>
<td align="right">0.042</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">1609</td>
<td align="right">15674</td>
<td align="right">0.103</td>
<td align="left">tpr</td>
<td align="right">0.098</td>
<td align="right">0.108</td>
</tr>
<tr class="even">
<td align="right">0.50</td>
<td align="right">6628</td>
<td align="right">15674</td>
<td align="right">0.423</td>
<td align="left">tpr</td>
<td align="right">0.415</td>
<td align="right">0.431</td>
</tr>
<tr class="odd">
<td align="right">0.75</td>
<td align="right">10307</td>
<td align="right">15674</td>
<td align="right">0.658</td>
<td align="left">tpr</td>
<td align="right">0.650</td>
<td align="right">0.665</td>
</tr>
<tr class="even">
<td align="right">1.00</td>
<td align="right">12417</td>
<td align="right">15674</td>
<td align="right">0.792</td>
<td align="left">tpr</td>
<td align="right">0.786</td>
<td align="right">0.799</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="plot-performance-metrics">Plot Performance Metrics<a class="anchor" aria-label="anchor" href="#plot-performance-metrics"></a>
</h2>
<ul>
<li>{simaerep} reduces the false positive rate compared to the
heuristics.</li>
<li>Rank-based heuristics has higher true positive rates at the cost of
higher false positive rates. Similar effects could be achieved by
lowering the {simaerep} flagging threshold</li>
<li>Using AE per visits over AE per patient days has better
performance.</li>
<li>Adjusting visit_med75 has also improved performance</li>
<li>{simaerep} results are closest to boxplot outlier heuristic but with
better overall performance</li>
<li>under optimal conditions {simaerep} catches almost all
under-reporting sites if under-reporting rate is greater 0.5</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prep_for_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">type</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"under-reporting rate: "</span>,  <span class="va">ur_rate</span>, <span class="st">" - "</span>, <span class="va">ratio_type</span><span class="op">)</span>,</span>
<span>           ur_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="st">"fpr"</span><span class="op">)</span>, <span class="st">"fpr"</span>, <span class="va">ur_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="va">ratio_type</span>, <span class="va">ratio</span>, <span class="va">ci95_low</span>, <span class="va">ci95_high</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="va">type</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_perf</span> <span class="op">&lt;-</span> <span class="va">df_perf_st</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ratio_type <span class="op">=</span> <span class="st">"fpr"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="va">ratio_type</span>, ratio <span class="op">=</span> <span class="va">fpr</span>, ci95_low <span class="op">=</span> <span class="va">fpr_ci95_low</span>, ci95_high <span class="op">=</span> <span class="va">fpr_ci95_high</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">df_perf_st</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ur_rate</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ratio_type <span class="op">=</span> <span class="st">"tpr"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="va">ratio_type</span>, ratio <span class="op">=</span> <span class="va">tpr</span>, ci95_low <span class="op">=</span> <span class="va">tpr_ci95_low</span>, ci95_high <span class="op">=</span> <span class="va">tpr_ci95_high</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">prep_for_plot</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"{simaerep} optimal study conditions"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu">prep_for_plot</span><span class="op">(</span><span class="va">df_perf_portf</span>, type <span class="op">=</span> <span class="st">"{simaerep} default"</span><span class="op">)</span>,</span>
<span>    <span class="fu">prep_for_plot</span><span class="op">(</span><span class="va">df_perf_portf_days</span>, type <span class="op">=</span> <span class="st">"{simaerep} AE per days on study"</span><span class="op">)</span>,</span>
<span>    <span class="fu">prep_for_plot</span><span class="op">(</span><span class="va">df_perf_portf_old_visit_med75</span>, type <span class="op">=</span> <span class="st">"{simaerep} unadjusted visit-med75"</span><span class="op">)</span>,</span>
<span>    <span class="fu">prep_for_plot</span><span class="op">(</span><span class="va">df_perf_heuristic_rnk</span>, type <span class="op">=</span> <span class="st">"heuristic - rank"</span><span class="op">)</span>,</span>
<span>    <span class="fu">prep_for_plot</span><span class="op">(</span><span class="va">df_perf_heuristic_box</span>, type <span class="op">=</span> <span class="st">"heuristic - boxplot outlier"</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">type</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"heuristic - boxplot outlier"</span>,</span>
<span>      <span class="st">"heuristic - rank"</span>,</span>
<span>      <span class="st">"{simaerep} default"</span>,</span>
<span>      <span class="st">"{simaerep} optimal study conditions"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_perf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"{simaerep} default"</span>, <span class="st">"violetred2"</span>, <span class="st">"darkgrey"</span><span class="op">)</span>,</span>
<span>         ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"{simaerep} default"</span>, <span class="va">ratio</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ur_rate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ref</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">ratio</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">ref</span><span class="op">)</span>,</span>
<span>               linetype <span class="op">=</span> <span class="fl">2</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"violetred2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci95_low</span>, ymax <span class="op">=</span> <span class="va">ci95_high</span>, color <span class="op">=</span> <span class="va">color</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">ur_rate</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_identity.html" class="external-link">scale_colour_identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">""</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"CI95 Performance Ratio"</span>, </span>
<span>      title <span class="op">=</span> <span class="st">"{simaerep} Performance"</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="st">"Only one under-reporting site per study.\nCut-Off Under-Reporting Probability: 0.95"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="portfolio_perf_files/figure-html/plot-1.png" width="576"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_perf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ur_rate</span>, <span class="va">type</span>, <span class="va">ratio</span>, <span class="va">ci95_low</span>, <span class="va">ci95_high</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="35%">
<col width="38%">
<col width="6%">
<col width="9%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">ur_rate</th>
<th align="left">type</th>
<th align="right">ratio</th>
<th align="right">ci95_low</th>
<th align="right">ci95_high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">fpr</td>
<td align="left">{simaerep} unadjusted visit-med75</td>
<td align="right">0.012</td>
<td align="right">0.011</td>
<td align="right">0.014</td>
</tr>
<tr class="even">
<td align="left">fpr</td>
<td align="left">{simaerep} AE per days on study</td>
<td align="right">0.014</td>
<td align="right">0.013</td>
<td align="right">0.016</td>
</tr>
<tr class="odd">
<td align="left">fpr</td>
<td align="left">{simaerep} optimal study conditions</td>
<td align="right">0.002</td>
<td align="right">0.001</td>
<td align="right">0.004</td>
</tr>
<tr class="even">
<td align="left">fpr</td>
<td align="left">{simaerep} default</td>
<td align="right">0.014</td>
<td align="right">0.012</td>
<td align="right">0.016</td>
</tr>
<tr class="odd">
<td align="left">fpr</td>
<td align="left">heuristic - rank</td>
<td align="right">0.098</td>
<td align="right">0.094</td>
<td align="right">0.103</td>
</tr>
<tr class="even">
<td align="left">fpr</td>
<td align="left">heuristic - boxplot outlier</td>
<td align="right">0.026</td>
<td align="right">0.024</td>
<td align="right">0.029</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.1 - tpr</td>
<td align="left">{simaerep} unadjusted visit-med75</td>
<td align="right">0.049</td>
<td align="right">0.048</td>
<td align="right">0.050</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.1 - tpr</td>
<td align="left">{simaerep} AE per days on study</td>
<td align="right">0.070</td>
<td align="right">0.069</td>
<td align="right">0.072</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.1 - tpr</td>
<td align="left">{simaerep} optimal study conditions</td>
<td align="right">0.028</td>
<td align="right">0.016</td>
<td align="right">0.048</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.1 - tpr</td>
<td align="left">{simaerep} default</td>
<td align="right">0.062</td>
<td align="right">0.058</td>
<td align="right">0.065</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.1 - tpr</td>
<td align="left">heuristic - rank</td>
<td align="right">0.134</td>
<td align="right">0.128</td>
<td align="right">0.139</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.1 - tpr</td>
<td align="left">heuristic - boxplot outlier</td>
<td align="right">0.039</td>
<td align="right">0.036</td>
<td align="right">0.042</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.25 - tpr</td>
<td align="left">{simaerep} unadjusted visit-med75</td>
<td align="right">0.169</td>
<td align="right">0.167</td>
<td align="right">0.171</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.25 - tpr</td>
<td align="left">{simaerep} AE per days on study</td>
<td align="right">0.234</td>
<td align="right">0.231</td>
<td align="right">0.237</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.25 - tpr</td>
<td align="left">{simaerep} optimal study conditions</td>
<td align="right">0.272</td>
<td align="right">0.234</td>
<td align="right">0.314</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.25 - tpr</td>
<td align="left">{simaerep} default</td>
<td align="right">0.213</td>
<td align="right">0.206</td>
<td align="right">0.219</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.25 - tpr</td>
<td align="left">heuristic - rank</td>
<td align="right">0.293</td>
<td align="right">0.286</td>
<td align="right">0.301</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.25 - tpr</td>
<td align="left">heuristic - boxplot outlier</td>
<td align="right">0.103</td>
<td align="right">0.098</td>
<td align="right">0.108</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.5 - tpr</td>
<td align="left">{simaerep} unadjusted visit-med75</td>
<td align="right">0.416</td>
<td align="right">0.413</td>
<td align="right">0.419</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.5 - tpr</td>
<td align="left">{simaerep} AE per days on study</td>
<td align="right">0.464</td>
<td align="right">0.461</td>
<td align="right">0.468</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.5 - tpr</td>
<td align="left">{simaerep} optimal study conditions</td>
<td align="right">0.976</td>
<td align="right">0.957</td>
<td align="right">0.987</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.5 - tpr</td>
<td align="left">{simaerep} default</td>
<td align="right">0.493</td>
<td align="right">0.485</td>
<td align="right">0.501</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.5 - tpr</td>
<td align="left">heuristic - rank</td>
<td align="right">0.740</td>
<td align="right">0.733</td>
<td align="right">0.746</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.5 - tpr</td>
<td align="left">heuristic - boxplot outlier</td>
<td align="right">0.423</td>
<td align="right">0.415</td>
<td align="right">0.431</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.75 - tpr</td>
<td align="left">{simaerep} unadjusted visit-med75</td>
<td align="right">0.600</td>
<td align="right">0.597</td>
<td align="right">0.603</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.75 - tpr</td>
<td align="left">{simaerep} AE per days on study</td>
<td align="right">0.595</td>
<td align="right">0.592</td>
<td align="right">0.599</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.75 - tpr</td>
<td align="left">{simaerep} optimal study conditions</td>
<td align="right">1.000</td>
<td align="right">0.990</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.75 - tpr</td>
<td align="left">{simaerep} default</td>
<td align="right">0.695</td>
<td align="right">0.688</td>
<td align="right">0.702</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 0.75 - tpr</td>
<td align="left">heuristic - rank</td>
<td align="right">0.967</td>
<td align="right">0.965</td>
<td align="right">0.970</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 0.75 - tpr</td>
<td align="left">heuristic - boxplot outlier</td>
<td align="right">0.658</td>
<td align="right">0.650</td>
<td align="right">0.665</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 1 - tpr</td>
<td align="left">{simaerep} unadjusted visit-med75</td>
<td align="right">0.642</td>
<td align="right">0.639</td>
<td align="right">0.645</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 1 - tpr</td>
<td align="left">{simaerep} AE per days on study</td>
<td align="right">0.597</td>
<td align="right">0.593</td>
<td align="right">0.600</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 1 - tpr</td>
<td align="left">{simaerep} optimal study conditions</td>
<td align="right">1.000</td>
<td align="right">0.990</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 1 - tpr</td>
<td align="left">{simaerep} default</td>
<td align="right">0.772</td>
<td align="right">0.766</td>
<td align="right">0.779</td>
</tr>
<tr class="odd">
<td align="left">under-reporting rate: 1 - tpr</td>
<td align="left">heuristic - rank</td>
<td align="right">1.000</td>
<td align="right">1.000</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="left">under-reporting rate: 1 - tpr</td>
<td align="left">heuristic - boxplot outlier</td>
<td align="right">0.792</td>
<td align="right">0.786</td>
<td align="right">0.799</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

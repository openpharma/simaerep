<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Check Poisson Test Applicability â€¢ simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Check Poisson Test Applicability">
<meta property="og:description" content="simaerep">
<meta property="og:image" content="https://openpharma.github.io/simaerep/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simaerep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/sas_files.html">SAS Files as a Data Source</a>
    </li>
    <li>
      <a href="../articles/portfolio_perf.html">simaerep Portfolio Performance</a>
    </li>
    <li>
      <a href="../articles/visit_med75.html">Adjusted Evaluation Point visit_med75</a>
    </li>
    <li>
      <a href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a>
    </li>
    <li>
      <a href="../articles/check_poisson.html">Check Poisson Test Applicability</a>
    </li>
    <li>
      <a href="../articles/visits_or_days.html">Aggregate AEs by Days or Visit?</a>
    </li>
    <li>
      <a href="../articles/gsm_perf.html">Comparing {simaerep} and {gsm} Performance</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/simaerep/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Check Poisson Test Applicability</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/HEAD/vignettes/check_poisson.Rmd" class="external-link"><code>vignettes/check_poisson.Rmd</code></a></small>
      <div class="hidden name"><code>check_poisson.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="load">Load<a class="anchor" aria-label="anchor" href="#load"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/simaerep/">simaerep</a></span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Perhaps there might be scenarios in which one prefers to use a
parametric test vs the non-parametric bootstrap-based resampling method
to calculate AE under-reporting. <code>simaerep</code> provides a
function that does bootstrap resampling of the entire study preserving
the actual site parameters such as number of patients and
visit_med75.</p>
<p>Using this pool we can check whether the p-values calculated by
<code><a href="https://rdrr.io/r/stats/poisson.test.html" class="external-link">poisson.test()</a></code> represent accurate probabilities.</p>
<div class="section level3">
<h3 id="test-data-and-standard-processing">Test Data and Standard Processing<a class="anchor" aria-label="anchor" href="#test-data-and-standard-processing"></a>
</h3>
<p>We simulate three studies with varying ae per visit rate and then use
all functions we already <a href="https://openpharma.github.io/simaerep/articles/intro.html">introduced</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_visit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span></span>
<span>  n_pat <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n_sites <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  frac_site_with_ur <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  ur_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max_visit_mean <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  max_visit_sd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  ae_per_visit_mean <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit1</span><span class="op">$</span><span class="va">study_id</span> <span class="op">&lt;-</span> <span class="st">"ae_per_visit: 0.5"</span></span>
<span></span>
<span><span class="va">df_visit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span></span>
<span>  n_pat <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n_sites <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  frac_site_with_ur <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  ur_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max_visit_mean <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  max_visit_sd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  ae_per_visit_mean <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit2</span><span class="op">$</span><span class="va">study_id</span> <span class="op">&lt;-</span> <span class="st">"ae_per_visit: 0.2"</span></span>
<span></span>
<span><span class="va">df_visit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span></span>
<span>  n_pat <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n_sites <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  frac_site_with_ur <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  ur_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max_visit_mean <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  max_visit_sd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  ae_per_visit_mean <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit3</span><span class="op">$</span><span class="va">study_id</span> <span class="op">&lt;-</span> <span class="st">"ae_per_visit: 0.05"</span></span>
<span></span>
<span><span class="va">df_visit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_visit1</span>, <span class="va">df_visit2</span>, <span class="va">df_visit3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/site_aggr.html">site_aggr</a></span><span class="op">(</span><span class="va">df_visit</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_sim_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_sites.html">sim_sites</a></span><span class="op">(</span><span class="va">df_site</span>, <span class="va">df_visit</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 58,367 Ã— 9</span></span></span>
<span><span class="co">##    patnum  site_number is_ur max_visit_mean max_visit_sd ae_per_visit_mean visit</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> P000001 S0001       TRUE              20            4              0.25     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> P000001 S0001       TRUE              20            4              0.25     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> P000001 S0001       TRUE              20            4              0.25     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> P000001 S0001       TRUE              20            4              0.25     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> P000001 S0001       TRUE              20            4              0.25     5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> P000001 S0001       TRUE              20            4              0.25     6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> P000001 S0001       TRUE              20            4              0.25     7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> P000001 S0001       TRUE              20            4              0.25     8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> P000001 S0001       TRUE              20            4              0.25     9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> P000001 S0001       TRUE              20            4              0.25    10</span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 58,357 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 2 more variables: n_ae &lt;int&gt;, study_id &lt;chr&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_site</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 300 Ã— 6</span></span></span>
<span><span class="co">##    study_id    site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_med75</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> ae_per_visâ€¦ S0001          10                9          16              0.556</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> ae_per_visâ€¦ S0002          10               10          14              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> ae_per_visâ€¦ S0003          10                8          15              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> ae_per_visâ€¦ S0004          10                8          14              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> ae_per_visâ€¦ S0005          10                9          17              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> ae_per_visâ€¦ S0006          10                7          15              0.143</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> ae_per_visâ€¦ S0007          10                8          16              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> ae_per_visâ€¦ S0008          10                7          19              0.714</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> ae_per_visâ€¦ S0009          10                9          15              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> ae_per_visâ€¦ S0010          10                7          15              0.714</span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 290 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_sites</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 300 Ã— 10</span></span></span>
<span><span class="co">##    study_id    site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_med75</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> ae_per_visâ€¦ S0001          10                9          16              0.556</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> ae_per_visâ€¦ S0002          10               10          14              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> ae_per_visâ€¦ S0003          10                8          15              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> ae_per_visâ€¦ S0004          10                8          14              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> ae_per_visâ€¦ S0005          10                9          17              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> ae_per_visâ€¦ S0006          10                7          15              0.143</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> ae_per_visâ€¦ S0007          10                8          16              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> ae_per_visâ€¦ S0008          10                7          19              0.714</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> ae_per_visâ€¦ S0009          10                9          15              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> ae_per_visâ€¦ S0010          10                7          15              0.714</span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 290 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 4 more variables: mean_ae_study_med75 &lt;dbl&gt;, n_pat_with_med75_study &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   pval &lt;dbl&gt;, prob_low &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="simulate-studies">Simulate Studies<a class="anchor" aria-label="anchor" href="#simulate-studies"></a>
</h3>
<p><a href="https://openpharma.github.io/simaerep/reference/sim_studies.html">sim_studies()</a>
reproduces each study a hundred times using bootstrap resampling
maintaining the number of patients and the visit_med75 of each site.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_sim_studies</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_studies.html">sim_studies</a></span><span class="op">(</span><span class="va">df_visit</span>, <span class="va">df_site</span>,</span>
<span>                              r <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                              parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                              poisson_test <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                              prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                              .progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_sim_studies</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 30,000 Ã— 8</span></span></span>
<span><span class="co">##        r study_id    site_number visit_med75 n_pat_with_med75 n_pat_study   pval</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     1 ae_per_visâ€¦ S0001                16                9         819 1     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     1 ae_per_visâ€¦ S0002                14               10         911 1     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     1 ae_per_visâ€¦ S0003                15                8         872 0.051<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     1 ae_per_visâ€¦ S0004                14                8         913 0.827 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     1 ae_per_visâ€¦ S0005                17                9         750 1     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     1 ae_per_visâ€¦ S0006                15                7         873 1     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     1 ae_per_visâ€¦ S0007                16                8         820 0.391 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     1 ae_per_visâ€¦ S0008                19                7         564 1     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     1 ae_per_visâ€¦ S0009                15                9         871 1     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     1 ae_per_visâ€¦ S0010                15                7         873 1     </span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 29,990 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 1 more variable: prob_low &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="check-p-value-probabilities">Check p-value Probabilities<a class="anchor" aria-label="anchor" href="#check-p-value-probabilities"></a>
</h3>
<p><a href="https://openpharma.github.io/simaerep/reference/get_ecd_values.html">get_ecd_values()</a>
uses the p-value distribution in the dataframe returned from
sim_studies() to train a empirical cumulative distribution function for
each study which is then used to calculate the probability of a specific
p-value or lower from the poisson.test p-value returned from
sim_sites()</p>
<p>Note: Dots on the edge of the graph that are cut off have zero value
for the corresponding axis.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_check_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ecd_values.html">get_ecd_values</a></span><span class="op">(</span><span class="va">df_sim_studies</span>, <span class="va">df_sim_sites</span>, val_str <span class="op">=</span> <span class="st">"pval"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_check_pval</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 300 Ã— 11</span></span></span>
<span><span class="co">##    study_id    site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_med75</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> ae_per_visâ€¦ S0001          10                9          16              0.556</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> ae_per_visâ€¦ S0002          10               10          14              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> ae_per_visâ€¦ S0003          10                8          15              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> ae_per_visâ€¦ S0004          10                8          14              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> ae_per_visâ€¦ S0005          10                9          17              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> ae_per_visâ€¦ S0006          10                7          15              0.143</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> ae_per_visâ€¦ S0007          10                8          16              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> ae_per_visâ€¦ S0008          10                7          19              0.714</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> ae_per_visâ€¦ S0009          10                9          15              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> ae_per_visâ€¦ S0010          10                7          15              0.714</span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 290 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 5 more variables: mean_ae_study_med75 &lt;dbl&gt;, n_pat_with_med75_study &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   pval &lt;dbl&gt;, prob_low &lt;dbl&gt;, pval_ecd &lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_check_pval</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pval</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pval_ecd</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">study_id</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span> xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="check_poisson_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>We can see that the p-values from poisson.test (x-axis) more or less
match the probability with which they are represented in the resampled
studies (y-axis), but there is some skewness to their relationship.</p>
</div>
<div class="section level3">
<h3 id="perform-same-check-on-bootstrapped-probabilities">Perform Same Check on Bootstrapped Probabilities<a class="anchor" aria-label="anchor" href="#perform-same-check-on-bootstrapped-probabilities"></a>
</h3>
<p>Note: Dots on the edge of the graph that are cut off have zero value
for the corresponding axis. For the tie simulations using 1000 repeats
the smallest value greater zero we get for prob_low is 0.001 (1e-3).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_check_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ecd_values.html">get_ecd_values</a></span><span class="op">(</span><span class="va">df_sim_studies</span>, <span class="va">df_sim_sites</span>, val_str <span class="op">=</span> <span class="st">"prob_low"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_check_prob</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 300 Ã— 11</span></span></span>
<span><span class="co">##    study_id    site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_med75</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> ae_per_visâ€¦ S0001          10                9          16              0.556</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> ae_per_visâ€¦ S0002          10               10          14              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> ae_per_visâ€¦ S0003          10                8          15              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> ae_per_visâ€¦ S0004          10                8          14              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> ae_per_visâ€¦ S0005          10                9          17              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> ae_per_visâ€¦ S0006          10                7          15              0.143</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> ae_per_visâ€¦ S0007          10                8          16              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> ae_per_visâ€¦ S0008          10                7          19              0.714</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> ae_per_visâ€¦ S0009          10                9          15              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> ae_per_visâ€¦ S0010          10                7          15              0.714</span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 290 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># â„¹ 5 more variables: mean_ae_study_med75 &lt;dbl&gt;, n_pat_with_med75_study &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   pval &lt;dbl&gt;, prob_low &lt;dbl&gt;, prob_low_ecd &lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_check_prob</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">prob_low</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">prob_low_ecd</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">study_id</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span> xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="check_poisson_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Here we see that the probabilities from the site simulations (x-axis)
perfectly match probability with which they are represented in the
resampled studies (y-axis).</p>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>We see that the bootstrap method gives us more accurate probabilities
than the p-values derived from poisson.test even though the AE
generation in the sample data follows a strict poisson process. For real
clinical trial data with different types of studies for which it is not
clear whether AE generation is truly based on a pure poisson process we
recommend to use the bootstrap method. If poisson.test shall be used we
recommend checking the applicability as we just demonstrated on clinical
data set.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

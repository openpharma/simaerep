<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Check Poisson Test Applicability • simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Check Poisson Test Applicability">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simaerep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/intro.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/inframe.html">Inframe Simulation Using Table Operations</a></li>
    <li><a class="dropdown-item" href="../articles/over.html">Over-Reporting Probability</a></li>
    <li><a class="dropdown-item" href="../articles/performance.html">Statistical Performance</a></li>
    <li><a class="dropdown-item" href="../articles/funnel_perf.html">Comparing {simaerep} and Funnel Plot Performance</a></li>
    <li><a class="dropdown-item" href="../articles/sas_files.html">SAS Files as a Data Source</a></li>
    <li><a class="dropdown-item" href="../articles/portfolio_perf.html">(superseded) simaerep Portfolio Performance</a></li>
    <li><a class="dropdown-item" href="../articles/visit_med75.html">Adjusted Evaluation Point visit_med75</a></li>
    <li><a class="dropdown-item" href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a></li>
    <li><a class="dropdown-item" href="../articles/check_poisson.html">Check Poisson Test Applicability</a></li>
    <li><a class="dropdown-item" href="../articles/visits_or_days.html">Aggregate AEs by Days or Visit?</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/simaerep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Check Poisson Test Applicability</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/HEAD/vignettes/check_poisson.Rmd" class="external-link"><code>vignettes/check_poisson.Rmd</code></a></small>
      <div class="d-none name"><code>check_poisson.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="load">Load<a class="anchor" aria-label="anchor" href="#load"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/simaerep/">simaerep</a></span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Perhaps there might be scenarios in which one prefers to use a
parametric test vs the non-parametric bootstrap-based resampling method
to calculate AE under-reporting. <code>simaerep</code> provides a
function that does bootstrap resampling of the entire study preserving
the actual site parameters such as number of patients and
visit_med75.</p>
<p>Using this pool we can check whether the p-values calculated by
<code><a href="https://rdrr.io/r/stats/poisson.test.html" class="external-link">poisson.test()</a></code> represent accurate probabilities.</p>
<div class="section level3">
<h3 id="test-data-and-standard-processing">Test Data and Standard Processing<a class="anchor" aria-label="anchor" href="#test-data-and-standard-processing"></a>
</h3>
<p>We simulate three studies with varying ae per visit rate and then use
all functions we already <a href="https://openpharma.github.io/simaerep/articles/intro.html">introduced</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_visit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span></span>
<span>  n_pat <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n_sites <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  frac_site_with_ur <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  ur_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max_visit_mean <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  max_visit_sd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  ae_per_visit_mean <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit1</span><span class="op">$</span><span class="va">study_id</span> <span class="op">&lt;-</span> <span class="st">"ae_per_visit: 0.5"</span></span>
<span></span>
<span><span class="va">df_visit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span></span>
<span>  n_pat <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n_sites <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  frac_site_with_ur <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  ur_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max_visit_mean <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  max_visit_sd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  ae_per_visit_mean <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit2</span><span class="op">$</span><span class="va">study_id</span> <span class="op">&lt;-</span> <span class="st">"ae_per_visit: 0.2"</span></span>
<span></span>
<span><span class="va">df_visit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span></span>
<span>  n_pat <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n_sites <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  frac_site_with_ur <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  ur_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max_visit_mean <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  max_visit_sd <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  ae_per_visit_mean <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit3</span><span class="op">$</span><span class="va">study_id</span> <span class="op">&lt;-</span> <span class="st">"ae_per_visit: 0.05"</span></span>
<span></span>
<span><span class="va">df_visit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_visit1</span>, <span class="va">df_visit2</span>, <span class="va">df_visit3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/site_aggr.html">site_aggr</a></span><span class="op">(</span><span class="va">df_visit</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_sim_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_sites.html">sim_sites</a></span><span class="op">(</span><span class="va">df_site</span>, <span class="va">df_visit</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 58,505 × 9</span></span></span>
<span><span class="co">##    patnum  site_number is_ur max_visit_mean max_visit_sd ae_per_visit_mean visit</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> P000001 S0001       TRUE              20            4              0.25     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> P000001 S0001       TRUE              20            4              0.25     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> P000001 S0001       TRUE              20            4              0.25     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> P000001 S0001       TRUE              20            4              0.25     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> P000001 S0001       TRUE              20            4              0.25     5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> P000001 S0001       TRUE              20            4              0.25     6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> P000001 S0001       TRUE              20            4              0.25     7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> P000001 S0001       TRUE              20            4              0.25     8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> P000001 S0001       TRUE              20            4              0.25     9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> P000001 S0001       TRUE              20            4              0.25    10</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 58,495 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: n_ae &lt;int&gt;, study_id &lt;chr&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_site</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 300 × 6</span></span></span>
<span><span class="co">##    study_id    site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_med75</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> ae_per_vis… S0001          10               10          15              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> ae_per_vis… S0002          10                9          15              0.667</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> ae_per_vis… S0003          10                8          17              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> ae_per_vis… S0004          10               10          15              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> ae_per_vis… S0005          10                9          18              0.222</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> ae_per_vis… S0006          10                9          16              0.556</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> ae_per_vis… S0007          10                9          17              0.667</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> ae_per_vis… S0008          10                9          16              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> ae_per_vis… S0009          10               10          14              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> ae_per_vis… S0010          10               10          17              0.2  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 290 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sim_sites</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 300 × 10</span></span></span>
<span><span class="co">##    study_id    site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_med75</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> ae_per_vis… S0001          10               10          15              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> ae_per_vis… S0002          10                9          15              0.667</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> ae_per_vis… S0003          10                8          17              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> ae_per_vis… S0004          10               10          15              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> ae_per_vis… S0005          10                9          18              0.222</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> ae_per_vis… S0006          10                9          16              0.556</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> ae_per_vis… S0007          10                9          17              0.667</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> ae_per_vis… S0008          10                9          16              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> ae_per_vis… S0009          10               10          14              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> ae_per_vis… S0010          10               10          17              0.2  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 290 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 4 more variables: mean_ae_study_med75 &lt;dbl&gt;, n_pat_with_med75_study &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   pval &lt;dbl&gt;, prob_low &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="simulate-studies">Simulate Studies<a class="anchor" aria-label="anchor" href="#simulate-studies"></a>
</h3>
<p><a href="https://openpharma.github.io/simaerep/reference/sim_studies.html">sim_studies()</a>
reproduces each study a hundred times using bootstrap resampling
maintaining the number of patients and the visit_med75 of each site.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_sim_studies</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_studies.html">sim_studies</a></span><span class="op">(</span><span class="va">df_visit</span>, <span class="va">df_site</span>,</span>
<span>                              r <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                              parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                              poisson_test <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                              prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                              .progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_sim_studies</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 30,000 × 8</span></span></span>
<span><span class="co">##        r study_id     site_number visit_med75 n_pat_with_med75 n_pat_study  pval</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     1 ae_per_visi… S0001                15               10         905 1    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     1 ae_per_visi… S0002                15                9         906 0.673</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     1 ae_per_visi… S0003                17                8         760 1    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     1 ae_per_visi… S0004                15               10         905 1    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     1 ae_per_visi… S0005                18                9         678 0.850</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     1 ae_per_visi… S0006                16                9         828 1    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     1 ae_per_visi… S0007                17                9         759 1    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     1 ae_per_visi… S0008                16                9         828 1    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     1 ae_per_visi… S0009                14               10         942 1    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     1 ae_per_visi… S0010                17               10         758 0.714</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 29,990 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: prob_low &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="check-p-value-probabilities">Check p-value Probabilities<a class="anchor" aria-label="anchor" href="#check-p-value-probabilities"></a>
</h3>
<p><a href="https://openpharma.github.io/simaerep/reference/get_ecd_values.html">get_ecd_values()</a>
uses the p-value distribution in the dataframe returned from
sim_studies() to train a empirical cumulative distribution function for
each study which is then used to calculate the probability of a specific
p-value or lower from the poisson.test p-value returned from
sim_sites()</p>
<p>Note: Dots on the edge of the graph that are cut off have zero value
for the corresponding axis.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_check_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ecd_values.html">get_ecd_values</a></span><span class="op">(</span><span class="va">df_sim_studies</span>, <span class="va">df_sim_sites</span>, val_str <span class="op">=</span> <span class="st">"pval"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_check_pval</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 300 × 11</span></span></span>
<span><span class="co">##    study_id    site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_med75</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> ae_per_vis… S0001          10               10          15              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> ae_per_vis… S0002          10                9          15              0.667</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> ae_per_vis… S0003          10                8          17              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> ae_per_vis… S0004          10               10          15              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> ae_per_vis… S0005          10                9          18              0.222</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> ae_per_vis… S0006          10                9          16              0.556</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> ae_per_vis… S0007          10                9          17              0.667</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> ae_per_vis… S0008          10                9          16              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> ae_per_vis… S0009          10               10          14              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> ae_per_vis… S0010          10               10          17              0.2  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 290 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5 more variables: mean_ae_study_med75 &lt;dbl&gt;, n_pat_with_med75_study &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   pval &lt;dbl&gt;, prob_low &lt;dbl&gt;, pval_ecd &lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_check_pval</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pval</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pval_ecd</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">study_id</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span> xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="check_poisson_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>We can see that the p-values from poisson.test (x-axis) more or less
match the probability with which they are represented in the resampled
studies (y-axis), but there is some skewness to their relationship.</p>
</div>
<div class="section level3">
<h3 id="perform-same-check-on-bootstrapped-probabilities">Perform Same Check on Bootstrapped Probabilities<a class="anchor" aria-label="anchor" href="#perform-same-check-on-bootstrapped-probabilities"></a>
</h3>
<p>Note: Dots on the edge of the graph that are cut off have zero value
for the corresponding axis. For the tie simulations using 1000 repeats
the smallest value greater zero we get for prob_low is 0.001 (1e-3).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_check_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ecd_values.html">get_ecd_values</a></span><span class="op">(</span><span class="va">df_sim_studies</span>, <span class="va">df_sim_sites</span>, val_str <span class="op">=</span> <span class="st">"prob_low"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_check_prob</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 300 × 11</span></span></span>
<span><span class="co">##    study_id    site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_med75</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> ae_per_vis… S0001          10               10          15              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> ae_per_vis… S0002          10                9          15              0.667</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> ae_per_vis… S0003          10                8          17              0.375</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> ae_per_vis… S0004          10               10          15              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> ae_per_vis… S0005          10                9          18              0.222</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> ae_per_vis… S0006          10                9          16              0.556</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> ae_per_vis… S0007          10                9          17              0.667</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> ae_per_vis… S0008          10                9          16              0.333</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> ae_per_vis… S0009          10               10          14              0.3  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> ae_per_vis… S0010          10               10          17              0.2  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 290 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5 more variables: mean_ae_study_med75 &lt;dbl&gt;, n_pat_with_med75_study &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   pval &lt;dbl&gt;, prob_low &lt;dbl&gt;, prob_low_ecd &lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_check_prob</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">prob_low</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">prob_low_ecd</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">study_id</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span> xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="check_poisson_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Here we see that the probabilities from the site simulations (x-axis)
perfectly match probability with which they are represented in the
resampled studies (y-axis).</p>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>We see that the bootstrap method gives us more accurate probabilities
than the p-values derived from poisson.test even though the AE
generation in the sample data follows a strict poisson process. For real
clinical trial data with different types of studies for which it is not
clear whether AE generation is truly based on a pure poisson process we
recommend to use the bootstrap method. If poisson.test shall be used we
recommend checking the applicability as we just demonstrated on clinical
data set.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>

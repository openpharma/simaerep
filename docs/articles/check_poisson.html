<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Check Poisson Test Applicability • simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Check Poisson Test Applicability">
<meta property="og:description" content="simaerep">
<meta property="og:image" content="https://openpharma.github.io/simaerep/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simaerep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a>
    </li>
    <li>
      <a href="../articles/check_poisson.html">Check Poisson Test Applicability</a>
    </li>
    <li>
      <a href="../articles/sas_files.html">SAS Files as a Data Source</a>
    </li>
    <li>
      <a href="../articles/visit_med75.html">Adjusted Evaluation Point visit_med75</a>
    </li>
    <li>
      <a href="../articles/visits_or_days.html">Aggregate AEs by Days or Visit?</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/simaerep/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="check_poisson_files/header-attrs-2.5/header-attrs.js"></script><link href="check_poisson_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="check_poisson_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Check Poisson Test Applicability</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/master/vignettes/check_poisson.Rmd"><code>vignettes/check_poisson.Rmd</code></a></small>
      <div class="hidden name"><code>check_poisson.Rmd</code></div>

    </div>

    
    
<div id="load" class="section level1">
<h1 class="hasAnchor">
<a href="#load" class="anchor"></a>Load</h1>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr">furrr</a></span><span class="op">)</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HenrikBengtsson/future">future</a></span><span class="op">)</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/simaerep/">simaerep</a></span><span class="op">)</span> <span class="op">)</span></code></pre></div>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Perhaps there might be scenarios in which one prefers to use a parametric test vs the non-parametric bootstrap-based resampling method to calculate AE under-reporting. <code>simaerep</code> provides a function that does bootstrap resampling of the entire study preserving the actual site parameters such as number of patients and visit_med75.</p>
<p>Using this pool we can check whether the p-values calculated by <code><a href="https://rdrr.io/r/stats/poisson.test.html">poisson.test()</a></code> represent accurate probabilities.</p>
<div id="test-data-and-standard-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#test-data-and-standard-processing" class="anchor"></a>Test Data and Standard Processing</h2>
<p>We simulate three studies with varying ae per visit rate and then use all functions we already <a href="https://openpharma.github.io/simaerep/articles/intro.html">introduced</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_visit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span>
  n_pat <span class="op">=</span> <span class="fl">1000</span>,
  n_sites <span class="op">=</span> <span class="fl">100</span>,
  frac_site_with_ur <span class="op">=</span> <span class="fl">0.2</span>,
  ur_rate <span class="op">=</span> <span class="fl">0.5</span>,
  max_visit_mean <span class="op">=</span> <span class="fl">20</span>,
  max_visit_sd <span class="op">=</span> <span class="fl">4</span>,
  ae_per_visit_mean <span class="op">=</span> <span class="fl">0.5</span>
<span class="op">)</span>

<span class="va">df_visit1</span><span class="op">$</span><span class="va">study_id</span> <span class="op">&lt;-</span> <span class="st">"ae_per_visit: 0.5"</span>

<span class="va">df_visit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span>
  n_pat <span class="op">=</span> <span class="fl">1000</span>,
  n_sites <span class="op">=</span> <span class="fl">100</span>,
  frac_site_with_ur <span class="op">=</span> <span class="fl">0.2</span>,
  ur_rate <span class="op">=</span> <span class="fl">0.5</span>,
  max_visit_mean <span class="op">=</span> <span class="fl">20</span>,
  max_visit_sd <span class="op">=</span> <span class="fl">4</span>,
  ae_per_visit_mean <span class="op">=</span> <span class="fl">0.2</span>
<span class="op">)</span>

<span class="va">df_visit2</span><span class="op">$</span><span class="va">study_id</span> <span class="op">&lt;-</span> <span class="st">"ae_per_visit: 0.2"</span>

<span class="va">df_visit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span><span class="op">(</span>
  n_pat <span class="op">=</span> <span class="fl">1000</span>,
  n_sites <span class="op">=</span> <span class="fl">100</span>,
  frac_site_with_ur <span class="op">=</span> <span class="fl">0.2</span>,
  ur_rate <span class="op">=</span> <span class="fl">0.5</span>,
  max_visit_mean <span class="op">=</span> <span class="fl">20</span>,
  max_visit_sd <span class="op">=</span> <span class="fl">4</span>,
  ae_per_visit_mean <span class="op">=</span> <span class="fl">0.05</span>
<span class="op">)</span>

<span class="va">df_visit3</span><span class="op">$</span><span class="va">study_id</span> <span class="op">&lt;-</span> <span class="st">"ae_per_visit: 0.05"</span>

<span class="va">df_visit</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">df_visit1</span>, <span class="va">df_visit2</span>, <span class="va">df_visit3</span><span class="op">)</span>

<span class="va">df_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/site_aggr.html">site_aggr</a></span><span class="op">(</span><span class="va">df_visit</span><span class="op">)</span>

<span class="va">df_sim_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_sites.html">sim_sites</a></span><span class="op">(</span><span class="va">df_site</span>, <span class="va">df_visit</span><span class="op">)</span>

<span class="va">df_visit</span></code></pre></div>
<pre><code>## # A tibble: 58,397 x 9
##    patnum site_number is_ur max_visit_mean max_visit_sd ae_per_visit_me… visit
##    &lt;chr&gt;  &lt;chr&gt;       &lt;lgl&gt;          &lt;dbl&gt;        &lt;dbl&gt;            &lt;dbl&gt; &lt;int&gt;
##  1 P0000… S0001       TRUE              20            4             0.25     1
##  2 P0000… S0001       TRUE              20            4             0.25     2
##  3 P0000… S0001       TRUE              20            4             0.25     3
##  4 P0000… S0001       TRUE              20            4             0.25     4
##  5 P0000… S0001       TRUE              20            4             0.25     5
##  6 P0000… S0001       TRUE              20            4             0.25     6
##  7 P0000… S0001       TRUE              20            4             0.25     7
##  8 P0000… S0001       TRUE              20            4             0.25     8
##  9 P0000… S0001       TRUE              20            4             0.25     9
## 10 P0000… S0001       TRUE              20            4             0.25    10
## # … with 58,387 more rows, and 2 more variables: n_ae &lt;int&gt;, study_id &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_site</span></code></pre></div>
<pre><code>## # A tibble: 300 x 6
##    study_id      site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_me…
##    &lt;chr&gt;         &lt;chr&gt;       &lt;int&gt;            &lt;int&gt;       &lt;dbl&gt;            &lt;dbl&gt;
##  1 ae_per_visit… S0001          10                7          15            0.429
##  2 ae_per_visit… S0002          10                9          17            0.222
##  3 ae_per_visit… S0003          10                9          19            0.444
##  4 ae_per_visit… S0004          10               10          17            0.6  
##  5 ae_per_visit… S0005          10                9          14            0.222
##  6 ae_per_visit… S0006          10               10          14            0.2  
##  7 ae_per_visit… S0007          10               10          15            0.3  
##  8 ae_per_visit… S0008          10               10          14            0.5  
##  9 ae_per_visit… S0009          10                8          18            0.25 
## 10 ae_per_visit… S0010          10               10          15            0.4  
## # … with 290 more rows</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_sim_sites</span></code></pre></div>
<pre><code>## # A tibble: 300 x 9
##    study_id site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_me…
##    &lt;chr&gt;    &lt;chr&gt;       &lt;int&gt;            &lt;int&gt;       &lt;dbl&gt;            &lt;dbl&gt;
##  1 ae_per_… S0001          10                7          15            0.429
##  2 ae_per_… S0002          10                9          17            0.222
##  3 ae_per_… S0003          10                9          19            0.444
##  4 ae_per_… S0004          10               10          17            0.6  
##  5 ae_per_… S0005          10                9          14            0.222
##  6 ae_per_… S0006          10               10          14            0.2  
##  7 ae_per_… S0007          10               10          15            0.3  
##  8 ae_per_… S0008          10               10          14            0.5  
##  9 ae_per_… S0009          10                8          18            0.25 
## 10 ae_per_… S0010          10               10          15            0.4  
## # … with 290 more rows, and 3 more variables: mean_ae_study_med75 &lt;dbl&gt;,
## #   pval &lt;dbl&gt;, prob_low &lt;dbl&gt;</code></pre>
</div>
<div id="simulate-studies" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-studies" class="anchor"></a>Simulate Studies</h2>
<p><a href="https://openpharma.github.io/simaerep/reference/sim_studies.html">sim_studies()</a> reproduces each study a hundred times using bootstrap resampling maintaining the number of patients and the visit_med75 of each site.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span><span class="op">(</span><span class="va">multiprocess</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Strategy 'multiprocess' is deprecated in future (&gt;= 1.20.0). Instead,
## explicitly specify either 'multisession' or 'multicore'. In the current R
## session, 'multiprocess' equals 'multisession'.</code></pre>
<pre><code>## Warning in supportsMulticoreAndRStudio(...): [ONE-TIME WARNING] Forked
## processing ('multicore') is not supported when running R from RStudio
## because it is considered unstable. For more details, how to control forked
## processing or not, and how to silence this warning in future R sessions, see ?
## parallelly::supportsMulticore</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_sim_studies</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_studies.html">sim_studies</a></span><span class="op">(</span><span class="va">df_visit</span>, <span class="va">df_site</span>,
                              r <span class="op">=</span> <span class="fl">100</span>,
                              parallel <span class="op">=</span> <span class="cn">TRUE</span>,
                              poisson_test <span class="op">=</span> <span class="cn">TRUE</span>,
                              prob_lower <span class="op">=</span> <span class="cn">TRUE</span>,
                              .progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">df_sim_studies</span></code></pre></div>
<pre><code>## # A tibble: 30,000 x 8
##        r study_id site_number visit_med75 n_pat_with_med75 n_pat_study   pval
##    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;            &lt;int&gt;       &lt;dbl&gt;  &lt;dbl&gt;
##  1     1 ae_per_… S0001                15                7         885 0.342 
##  2     1 ae_per_… S0002                17                9         766 0.0772
##  3     1 ae_per_… S0003                19                9         580 1     
##  4     1 ae_per_… S0004                17               10         765 1     
##  5     1 ae_per_… S0005                14                9         927 1     
##  6     1 ae_per_… S0006                14               10         926 0.300 
##  7     1 ae_per_… S0007                15               10         882 1     
##  8     1 ae_per_… S0008                14               10         926 1     
##  9     1 ae_per_… S0009                18                8         670 1     
## 10     1 ae_per_… S0010                15               10         882 1     
## # … with 29,990 more rows, and 1 more variable: prob_low &lt;dbl&gt;</code></pre>
</div>
<div id="check-p-value-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#check-p-value-probabilities" class="anchor"></a>Check p-value Probabilities</h2>
<p><a href="https://openpharma.github.io/simaerep/reference/get_ecd_values.html">get_ecd_values()</a> uses the p-value distribution in the dataframe returned from sim_studies() to train a empirical cumulative distribution function for each study which is then used to calculate the probability of a specific p-value or lower from the poisson.test p-value returned from sim_sites()</p>
<p>Note: Dots on the edge of the graph that are cut off have zero value for the corresponding axis.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_check_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ecd_values.html">get_ecd_values</a></span><span class="op">(</span><span class="va">df_sim_studies</span>, <span class="va">df_sim_sites</span>, val_str <span class="op">=</span> <span class="st">"pval"</span><span class="op">)</span>

<span class="va">df_check_pval</span></code></pre></div>
<pre><code>## # A tibble: 300 x 10
##    study_id site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_me…
##    &lt;chr&gt;    &lt;chr&gt;       &lt;int&gt;            &lt;int&gt;       &lt;dbl&gt;            &lt;dbl&gt;
##  1 ae_per_… S0001          10                7          15            0.429
##  2 ae_per_… S0002          10                9          17            0.222
##  3 ae_per_… S0003          10                9          19            0.444
##  4 ae_per_… S0004          10               10          17            0.6  
##  5 ae_per_… S0005          10                9          14            0.222
##  6 ae_per_… S0006          10               10          14            0.2  
##  7 ae_per_… S0007          10               10          15            0.3  
##  8 ae_per_… S0008          10               10          14            0.5  
##  9 ae_per_… S0009          10                8          18            0.25 
## 10 ae_per_… S0010          10               10          15            0.4  
## # … with 290 more rows, and 4 more variables: mean_ae_study_med75 &lt;dbl&gt;,
## #   pval &lt;dbl&gt;, prob_low &lt;dbl&gt;, pval_ecd &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_check_pval</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">pval</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">pval_ecd</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">study_id</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">coord_cartesian</span><span class="op">(</span> xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="check_poisson_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>We can see that the p-values from poisson.test (x-axis) more or less match the probability with which they are represented in the resampled studies (y-axis), but there is some skewness to their relationship.</p>
</div>
<div id="perform-same-check-on-bootstrapped-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#perform-same-check-on-bootstrapped-probabilities" class="anchor"></a>Perform Same Check on Bootstrapped Probabilities</h2>
<p>Note: Dots on the edge of the graph that are cut off have zero value for the corresponding axis. For the tie simulations using 1000 repeats the smallest value greater zero we get for prob_low is 0.001 (1e-3).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_check_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ecd_values.html">get_ecd_values</a></span><span class="op">(</span><span class="va">df_sim_studies</span>, <span class="va">df_sim_sites</span>, val_str <span class="op">=</span> <span class="st">"prob_low"</span><span class="op">)</span>

<span class="va">df_check_prob</span></code></pre></div>
<pre><code>## # A tibble: 300 x 10
##    study_id site_number n_pat n_pat_with_med75 visit_med75 mean_ae_site_me…
##    &lt;chr&gt;    &lt;chr&gt;       &lt;int&gt;            &lt;int&gt;       &lt;dbl&gt;            &lt;dbl&gt;
##  1 ae_per_… S0001          10                7          15            0.429
##  2 ae_per_… S0002          10                9          17            0.222
##  3 ae_per_… S0003          10                9          19            0.444
##  4 ae_per_… S0004          10               10          17            0.6  
##  5 ae_per_… S0005          10                9          14            0.222
##  6 ae_per_… S0006          10               10          14            0.2  
##  7 ae_per_… S0007          10               10          15            0.3  
##  8 ae_per_… S0008          10               10          14            0.5  
##  9 ae_per_… S0009          10                8          18            0.25 
## 10 ae_per_… S0010          10               10          15            0.4  
## # … with 290 more rows, and 4 more variables: mean_ae_study_med75 &lt;dbl&gt;,
## #   pval &lt;dbl&gt;, prob_low &lt;dbl&gt;, prob_low_ecd &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_check_prob</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">prob_low</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">prob_low_ecd</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">study_id</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">coord_cartesian</span><span class="op">(</span> xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="check_poisson_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Here we see that the probabilities from the site simulations (x-axis) perfectly match probability with which they are represented in the resampled studies (y-axis).</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>We see that the bootstrap method gives us more accurate probabilities than the p-values derived from poisson.test even though the AE generation in the sample data follows a strict poisson process. For real clinical trial data with different types of studies for which it is not clear whether AE generation is truly based on a pure poisson process we recommend to use the bootstrap method. If poisson.test shall be used we recommend checking the applicability as we just demonstrated on clinical data set.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAS Files as a Data Source • simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SAS Files as a Data Source">
<meta property="og:description" content="simaerep">
<meta property="og:image" content="https://openpharma.github.io/simaerep/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simaerep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a>
    </li>
    <li>
      <a href="../articles/check_poisson.html">Check Poisson Test Applicability</a>
    </li>
    <li>
      <a href="../articles/sas_files.html">SAS Files as a Data Source</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/simaerep/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="sas_files_files/header-attrs-2.5/header-attrs.js"></script><link href="sas_files_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="sas_files_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SAS Files as a Data Source</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/master/vignettes/sas_files.Rmd"><code>vignettes/sas_files.Rmd</code></a></small>
      <div class="hidden name"><code>sas_files.Rmd</code></div>

    </div>

    
    
<div id="load" class="section level1">
<h1 class="hasAnchor">
<a href="#load" class="anchor"></a>Load</h1>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/simaerep/">simaerep</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haven.tidyverse.org">haven</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ggrothendieck/sqldf">sqldf</a></span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="sas-files" class="section level1">
<h1 class="hasAnchor">
<a href="#sas-files" class="anchor"></a>SAS files</h1>
<p>Typically clinical data is stored in several SAS files in a standardized format. We need the files in which the visits and the AEs are recorded. For this demo we have selected an anonymized data set which only contains patients enrolled into the control arm. In those data sets the AE onset dates and the visit dates have been replaced with the number of days that have passed since a specific cut-off date. However, the cleaning and joining logic is the same as for date columns.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_ae</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_sas.html">read_sas</a></span><span class="op">(</span><span class="st">'adae.sas7bdat'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SUBJID</span>, <span class="va">SITEID</span>, <span class="va">AESTDY</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">SUBJID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">SUBJID</span>, <span class="va">AESTDY</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>AENO <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">df_ae</span></code></pre></div>
<pre><code>## # A tibble: 4,702 x 5
## # Groups:   SUBJID [360]
##    STUDYID    SUBJID   SITEID AESTDY  AENO
##    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;
##  1 CO-101-001 01001001 001       -14     1
##  2 CO-101-001 01001001 001       -13     2
##  3 CO-101-001 01001001 001        50     3
##  4 CO-101-001 01001001 001        67     4
##  5 CO-101-001 01001001 001        77     5
##  6 CO-101-001 01001001 001        84     6
##  7 CO-101-001 01001001 001        99     7
##  8 CO-101-001 01001001 001        99     8
##  9 CO-101-001 01001001 001       127     9
## 10 CO-101-001 01001001 001       127    10
## # … with 4,692 more rows</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_vs</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_sas.html">read_sas</a></span><span class="op">(</span><span class="st">'advs.sas7bdat'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SUBJID</span>, <span class="va">SITEID</span>, <span class="va">ADY</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">SUBJID</span>, <span class="va">ADY</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">SUBJID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>VISNO <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>ADY_PREV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">ADY</span><span class="op">)</span>,
         ADY_PREV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ADY_PREV</span><span class="op">)</span>, <span class="op">-</span> <span class="cn">Inf</span>, <span class="va">ADY_PREV</span><span class="op">)</span>,
         MAX_VISNO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">VISNO</span><span class="op">)</span><span class="op">)</span>

<span class="va">df_vs</span></code></pre></div>
<pre><code>## # A tibble: 5,439 x 7
## # Groups:   SUBJID [367]
##    STUDYID    SUBJID   SITEID   ADY VISNO ADY_PREV MAX_VISNO
##    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;     &lt;int&gt;
##  1 CO-101-001 01001001 001       -7     1     -Inf        29
##  2 CO-101-001 01001001 001        1     2       -7        29
##  3 CO-101-001 01001001 001        8     3        1        29
##  4 CO-101-001 01001001 001       15     4        8        29
##  5 CO-101-001 01001001 001       29     5       15        29
##  6 CO-101-001 01001001 001       38     6       29        29
##  7 CO-101-001 01001001 001       43     7       38        29
##  8 CO-101-001 01001001 001       57     8       43        29
##  9 CO-101-001 01001001 001       64     9       57        29
## 10 CO-101-001 01001001 001       85    10       64        29
## # … with 5,429 more rows</code></pre>
<p>We need to join the visit and the AE dataset on the corresponding study day columns ADY and AESTDY. We are going to collect all AEs of a patient and assign them to the next visit. If there is no next visit we assign it to the last visit. If the study day (or date) for the AE is missing we will also assign that AE to the last visit. The easiest way to do this is to use SQL. We can use the <code>sqldf</code> package to perform that join for <code>R</code> dataframes. For other <code>R</code> methods for conditional joins see this <a href="https://www.mango-solutions.com/in-between-a-rock-and-a-conditional-join/">blog post</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_aevs</span> <span class="op">&lt;-</span> <span class="fu">sqldf</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sqldf/man/sqldf.html">sqldf</a></span><span class="op">(</span><span class="st">"
  SELECT 
    df_vs.SUBJID,
    df_vs.STUDYID,
    df_vs.SITEID,
    df_vs.VISNO,  
    df_vs.ADY_PREV,
    df_vs.ADY,
    df_ae.AESTDY,
    df_ae.AENO
  FROM df_vs
  LEFT JOIN df_ae
    ON df_ae.SUBJID = df_vs.SUBJID
    AND df_ae.STUDYID = df_vs.STUDYID
    AND df_ae.SITEID = df_vs.SITEID
    AND (
      -- match AEs to next visit
      (df_ae.AESTDY &lt;= df_vs.ADY AND df_ae.AESTDY &gt; df_vs.ADY_PREV)
      OR
      -- match AEs that occured after last visit to last visit
      (df_vs.VISNO = df_vs.MAX_VISNO AND df_ae.AESTDY &gt; df_vs.ADY)
      OR
      -- match AEs with AESTDY NULL to last visit
      (df_vs.VISNO = df_vs.MAX_VISNO AND df_ae.AESTDY IS NULL)
    )
  "</span><span class="op">)</span>

<span class="va">df_aevs</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">df_aevs</span><span class="op">)</span>

<span class="va">df_aevs</span></code></pre></div>
<pre><code>## # A tibble: 7,952 x 8
##    SUBJID   STUDYID    SITEID VISNO ADY_PREV   ADY AESTDY  AENO
##    &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;  &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
##  1 01001001 CO-101-001 001        1     -Inf    -7    -14     1
##  2 01001001 CO-101-001 001        1     -Inf    -7    -13     2
##  3 01001001 CO-101-001 001        2       -7     1     NA    NA
##  4 01001001 CO-101-001 001        3        1     8     NA    NA
##  5 01001001 CO-101-001 001        4        8    15     NA    NA
##  6 01001001 CO-101-001 001        5       15    29     NA    NA
##  7 01001001 CO-101-001 001        6       29    38     NA    NA
##  8 01001001 CO-101-001 001        7       38    43     NA    NA
##  9 01001001 CO-101-001 001        8       43    57     50     3
## 10 01001001 CO-101-001 001        9       57    64     NA    NA
## # … with 7,942 more rows</code></pre>
<p>Next we need to aggregate to the visit level.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_aevs_aggr</span> <span class="op">&lt;-</span> <span class="va">df_aevs</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SUBJID</span>, <span class="va">SITEID</span>, <span class="va">VISNO</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>AENO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">AENO</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">SUBJID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">SUBJID</span>, <span class="va">VISNO</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">fill</span><span class="op">(</span><span class="va">AENO</span>, .direction <span class="op">=</span> <span class="st">"down"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>AENO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">AENO</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">AENO</span><span class="op">)</span><span class="op">)</span>

<span class="va">df_aevs_aggr</span></code></pre></div>
<pre><code>## # A tibble: 5,439 x 5
## # Groups:   SUBJID [367]
##    STUDYID    SUBJID   SITEID VISNO  AENO
##    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt;
##  1 CO-101-001 01001001 001        1     2
##  2 CO-101-001 01001001 001        2     2
##  3 CO-101-001 01001001 001        3     2
##  4 CO-101-001 01001001 001        4     2
##  5 CO-101-001 01001001 001        5     2
##  6 CO-101-001 01001001 001        6     2
##  7 CO-101-001 01001001 001        7     2
##  8 CO-101-001 01001001 001        8     3
##  9 CO-101-001 01001001 001        9     3
## 10 CO-101-001 01001001 001       10     6
## # … with 5,429 more rows</code></pre>
<p>As a control we check whether the numbers of visits and AEs of our processed data still matches the number of AEs in our original data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df_aevs_aggr</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df_vs</span><span class="op">)</span><span class="op">)</span>

<span class="va">n_aes</span> <span class="op">&lt;-</span> <span class="va">df_aevs_aggr</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">SUBJID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>n_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">AENO</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">pull</span><span class="op">(</span><span class="va">n_aes</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">)</span>
  
<span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="va">n_aes</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df_ae</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="simaerep" class="section level1">
<h1 class="hasAnchor">
<a href="#simaerep" class="anchor"></a>{simaerep}</h1>
<p>After renaming some of the columns we can pass the aggregated data from the SAS files to <code>simaerep</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_visit</span> <span class="op">&lt;-</span> <span class="va">df_aevs_aggr</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>
    study_id <span class="op">=</span> <span class="st">"STUDYID"</span>,
    site_number <span class="op">=</span> <span class="st">"SITEID"</span>,
    patnum <span class="op">=</span> <span class="st">"SUBJID"</span>,
    n_ae <span class="op">=</span> <span class="st">"AENO"</span>,
    visit <span class="op">=</span> <span class="st">"VISNO"</span>
  <span class="op">)</span> 

<span class="va">df_visit</span></code></pre></div>
<pre><code>## # A tibble: 5,439 x 5
## # Groups:   patnum [367]
##    study_id   patnum   site_number visit  n_ae
##    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt;
##  1 CO-101-001 01001001 001             1     2
##  2 CO-101-001 01001001 001             2     2
##  3 CO-101-001 01001001 001             3     2
##  4 CO-101-001 01001001 001             4     2
##  5 CO-101-001 01001001 001             5     2
##  6 CO-101-001 01001001 001             6     2
##  7 CO-101-001 01001001 001             7     2
##  8 CO-101-001 01001001 001             8     3
##  9 CO-101-001 01001001 001             9     3
## 10 CO-101-001 01001001 001            10     6
## # … with 5,429 more rows</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_site</span> <span class="op">&lt;-</span> <span class="va">df_visit</span> <span class="op">%&gt;%</span>
  <span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/site_aggr.html">site_aggr</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">df_site</span></code></pre></div>
<pre><code>## # A tibble: 76 x 6
##    study_id site_number n_patients visit_med75 n_pat_with_med75 mean_ae_site_me…
##    &lt;chr&gt;    &lt;chr&gt;            &lt;int&gt;       &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 CO-101-… 001                  5           6                3             4   
##  2 CO-101-… 003                  4          18                3            14.7 
##  3 CO-101-… 005                  2           9                2             8.5 
##  4 CO-101-… 007                  6           9                4             7.5 
##  5 CO-101-… 009                  2           5                1            15   
##  6 CO-101-… 015                  6           6                6             3.83
##  7 CO-101-… 017                  2          11                1            22   
##  8 CO-101-… 018                  1           6                1            15   
##  9 CO-101-… 019                  4           8                3             4.33
## 10 CO-101-… 020                  4          11                3            11.7 
## # … with 66 more rows</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_sim_sites</span> <span class="op">&lt;-</span> <span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/sim_sites.html">sim_sites</a></span><span class="op">(</span><span class="va">df_site</span>, <span class="va">df_visit</span>, r <span class="op">=</span> <span class="fl">1000</span>, poisson_test <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">df_sim_sites</span></code></pre></div>
<pre><code>## # A tibble: 76 x 6
##    study_id  site_number visit_med75 mean_ae_site_med… mean_ae_study_m… prob_low
##    &lt;chr&gt;     &lt;chr&gt;             &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;    &lt;dbl&gt;
##  1 CO-101-0… 001                   6              4                5.16    0.429
##  2 CO-101-0… 003                  18             14.7             11.1     1    
##  3 CO-101-0… 005                   9              8.5              7.04    1    
##  4 CO-101-0… 007                   9              7.5              7.05    1    
##  5 CO-101-0… 009                   5             15                4.35    1    
##  6 CO-101-0… 015                   6              3.83             5.17    0.328
##  7 CO-101-0… 017                  11             22                7.62    1    
##  8 CO-101-0… 018                   6             15                5.11    1    
##  9 CO-101-0… 019                   8              4.33             6.28    0.373
## 10 CO-101-0… 020                  11             11.7              7.64    1    
## # … with 66 more rows</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_eval</span> <span class="op">&lt;-</span> <span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/eval_sites.html">eval_sites</a></span><span class="op">(</span><span class="va">df_sim_sites</span>, r_sim_sites <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>

<span class="va">df_eval</span></code></pre></div>
<pre><code>## # A tibble: 76 x 11
##    study_id site_number visit_med75 mean_ae_site_me… mean_ae_study_m… prob_low
##    &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;    &lt;dbl&gt;
##  1 CO-101-… 078                   7             0.6              5.69    0    
##  2 CO-101-… 084                  11             0.6              7.89    0    
##  3 CO-101-… 073                   6             1                5.21    0.006
##  4 CO-101-… 086                   7             1.2              5.68    0.011
##  5 CO-101-… 067                  12             4.53             8.63    0.014
##  6 CO-101-… 079                  15             5.33            10.0     0.023
##  7 CO-101-… 071                  12             2.67             8.39    0.069
##  8 CO-101-… 066                  11             3.4              7.82    0.075
##  9 CO-101-… 085                  24             0               14.6     0.097
## 10 CO-101-… 069                   6             2.4              5.19    0.108
## # … with 66 more rows, and 5 more variables: n_site &lt;int&gt;,
## #   prob_low_n_detected &lt;int&gt;, prob_low_fp &lt;dbl&gt;, prob_low_p_vs_fp_ratio &lt;dbl&gt;,
## #   prob_low_prob_ur &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_study.html">plot_study</a></span><span class="op">(</span><span class="va">df_visit</span>, <span class="va">df_site</span>, <span class="va">df_eval</span>, study <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df_visit</span><span class="op">$</span><span class="va">study_id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="sas_files_files/figure-html/unnamed-chunk-9-1.png" width="960"></p>
<p><em>Left panel shows mean AE reporting per site (lightblue and darkblue lines) against mean AE reporting of the entire study (golden line). Single sites are plotted in descending order by AE under-reporting probability on the right panel in which grey lines denote cumulative AE count of single patients. Grey dots in the left panel plot indicate sites that were picked for single plotting. AE under-reporting probability of dark blue lines crossed threshold of 95%. Numbers in the upper left corner indicate the ratio of patients that have been used for the analysis against the total number of patients. Patients that have not been on the study long enough to reach the evaluation point (visit_med75, see introduction) will be ignored.</em></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

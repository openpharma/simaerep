<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAS Files as a Data Source • simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SAS Files as a Data Source">
<meta property="og:description" content="simaerep">
<meta property="og:image" content="https://openpharma.github.io/simaerep/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simaerep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a>
    </li>
    <li>
      <a href="../articles/check_poisson.html">Check Poisson Test Applicability</a>
    </li>
    <li>
      <a href="../articles/sas_files.html">SAS Files as a Data Source</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/simaerep/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="sas_files_files/header-attrs-2.5/header-attrs.js"></script><link href="sas_files_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="sas_files_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SAS Files as a Data Source</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/master/vignettes/sas_files.Rmd"><code>vignettes/sas_files.Rmd</code></a></small>
      <div class="hidden name"><code>sas_files.Rmd</code></div>

    </div>

    
    
<div id="load" class="section level1">
<h1 class="hasAnchor">
<a href="#load" class="anchor"></a>Load</h1>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/simaerep/">simaerep</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haven.tidyverse.org">haven</a></span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="sas-files" class="section level1">
<h1 class="hasAnchor">
<a href="#sas-files" class="anchor"></a>SAS files</h1>
<p>Typically clinical data is stored in several SAS files in a standardized format. We need the files in which the visits and the AEs are recorded. For this demo we have selected an anonymized data set which only contains patients enrolled into the control arm. In those data sets the AE onset dates and the visit dates have been replaced with the number of days that have passed since a specific cut-off date. We can proceed in a similar way</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_ae</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_sas.html">read_sas</a></span><span class="op">(</span><span class="st">'adae.sas7bdat'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SUBJID</span>, <span class="va">SITEID</span>, <span class="va">AESTDY</span><span class="op">)</span> 

<span class="va">df_ae</span></code></pre></div>
<pre><code>## # A tibble: 4,702 x 4
##    STUDYID    SUBJID   SITEID AESTDY
##    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt;
##  1 CO-101-001 01001001 001       -14
##  2 CO-101-001 01001001 001       -13
##  3 CO-101-001 01001001 001        50
##  4 CO-101-001 01001001 001        67
##  5 CO-101-001 01001001 001        77
##  6 CO-101-001 01001001 001        84
##  7 CO-101-001 01001001 001        99
##  8 CO-101-001 01001001 001        99
##  9 CO-101-001 01001001 001       127
## 10 CO-101-001 01001001 001       127
## # … with 4,692 more rows</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_vs</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_sas.html">read_sas</a></span><span class="op">(</span><span class="st">'advs.sas7bdat'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SUBJID</span>, <span class="va">SITEID</span>, <span class="va">ADY</span><span class="op">)</span> 

<span class="va">df_vs</span></code></pre></div>
<pre><code>## # A tibble: 45,176 x 4
##    STUDYID    SUBJID   SITEID   ADY
##    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;dbl&gt;
##  1 CO-101-001 01001001 001       -7
##  2 CO-101-001 01001001 001        1
##  3 CO-101-001 01001001 001        1
##  4 CO-101-001 01001001 001        8
##  5 CO-101-001 01001001 001        8
##  6 CO-101-001 01001001 001       15
##  7 CO-101-001 01001001 001       15
##  8 CO-101-001 01001001 001       29
##  9 CO-101-001 01001001 001       29
## 10 CO-101-001 01001001 001       38
## # … with 45,166 more rows</code></pre>
<p>In order to assign each AE to a visit we union both event tables and sort by date.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_ae</span> <span class="op">&lt;-</span> <span class="va">df_ae</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>DY <span class="op">=</span> <span class="va">AESTDY</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>EVENT <span class="op">=</span> <span class="st">"AE"</span><span class="op">)</span>

<span class="va">df_vs</span> <span class="op">&lt;-</span> <span class="va">df_vs</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>DY <span class="op">=</span> <span class="va">ADY</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>EVENT <span class="op">=</span> <span class="st">"VS"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># we ignore visits that have no date</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">DY</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># we are not interested in same day visits</span>
  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span>

<span class="va">df_aevs</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">df_ae</span>, <span class="va">df_vs</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># NA's get sorted towards the end thus AEs with no date get sorted towards last visit</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SITEID</span>, <span class="va">SUBJID</span>, <span class="va">DY</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SITEID</span>, <span class="va">SUBJID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>AE_NO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">EVENT</span> <span class="op">==</span> <span class="st">"AE"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
         VS_NO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">EVENT</span> <span class="op">==</span> <span class="st">"VS"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># we remove patients with 0 visits</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">VS_NO</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># AE's before fist visit should register to visit 1 not zero</span>
  <span class="fu">mutate</span><span class="op">(</span>VS_NO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">VS_NO</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="va">VS_NO</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>patient example with AE before first visit and AEs with NA in date</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_aevs</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">SUBJID</span> <span class="op">==</span> <span class="st">"01007004"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">STUDYID</th>
<th align="left">SUBJID</th>
<th align="left">SITEID</th>
<th align="right">DY</th>
<th align="left">EVENT</th>
<th align="right">AE_NO</th>
<th align="right">VS_NO</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">-14</td>
<td align="left">AE</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">-8</td>
<td align="left">VS</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">-3</td>
<td align="left">AE</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">-1</td>
<td align="left">AE</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">1</td>
<td align="left">AE</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">1</td>
<td align="left">VS</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">8</td>
<td align="left">VS</td>
<td align="right">4</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">15</td>
<td align="left">AE</td>
<td align="right">5</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">15</td>
<td align="left">AE</td>
<td align="right">6</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">18</td>
<td align="left">AE</td>
<td align="right">7</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">20</td>
<td align="left">VS</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">29</td>
<td align="left">VS</td>
<td align="right">7</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">36</td>
<td align="left">AE</td>
<td align="right">8</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">36</td>
<td align="left">AE</td>
<td align="right">9</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">36</td>
<td align="left">AE</td>
<td align="right">10</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">36</td>
<td align="left">VS</td>
<td align="right">10</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">43</td>
<td align="left">VS</td>
<td align="right">10</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">57</td>
<td align="left">AE</td>
<td align="right">11</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">57</td>
<td align="left">AE</td>
<td align="right">12</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">57</td>
<td align="left">VS</td>
<td align="right">12</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">58</td>
<td align="left">AE</td>
<td align="right">13</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">64</td>
<td align="left">VS</td>
<td align="right">13</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">71</td>
<td align="left">VS</td>
<td align="right">13</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">85</td>
<td align="left">VS</td>
<td align="right">13</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">92</td>
<td align="left">VS</td>
<td align="right">13</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">99</td>
<td align="left">AE</td>
<td align="right">14</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">99</td>
<td align="left">VS</td>
<td align="right">14</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">112</td>
<td align="left">VS</td>
<td align="right">14</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">120</td>
<td align="left">AE</td>
<td align="right">15</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">123</td>
<td align="left">AE</td>
<td align="right">16</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">123</td>
<td align="left">AE</td>
<td align="right">17</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">123</td>
<td align="left">AE</td>
<td align="right">18</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">125</td>
<td align="left">VS</td>
<td align="right">18</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">NA</td>
<td align="left">AE</td>
<td align="right">19</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">NA</td>
<td align="left">AE</td>
<td align="right">20</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">NA</td>
<td align="left">AE</td>
<td align="right">21</td>
<td align="right">15</td>
</tr>
</tbody>
</table>
<p>Then we aggregate on visit number.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_aevs_aggr</span> <span class="op">&lt;-</span> <span class="va">df_aevs</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SITEID</span>, <span class="va">SUBJID</span>, <span class="va">VS_NO</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>MIN_AE_NO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">AE_NO</span><span class="op">)</span>,
            MAX_AE_NO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">AE_NO</span><span class="op">)</span>,
            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SITEID</span>, <span class="va">SUBJID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>MAX_VS_PAT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">VS_NO</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># assign AEs that occur after last visit to last AE</span>
  <span class="fu">mutate</span><span class="op">(</span>
    CUM_AE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span>
      <span class="va">VS_NO</span> <span class="op">==</span> <span class="va">MAX_VS_PAT</span>,
      <span class="va">MAX_AE_NO</span>,
      <span class="va">MIN_AE_NO</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p>Same patient example as before.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_aevs_aggr</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">SUBJID</span> <span class="op">==</span> <span class="st">"01007004"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">STUDYID</th>
<th align="left">SITEID</th>
<th align="left">SUBJID</th>
<th align="right">VS_NO</th>
<th align="right">MIN_AE_NO</th>
<th align="right">MAX_AE_NO</th>
<th align="right">MAX_VS_PAT</th>
<th align="right">CUM_AE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">15</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">15</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">7</td>
<td align="right">15</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">4</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="right">15</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">10</td>
<td align="right">15</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">6</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">15</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">7</td>
<td align="right">10</td>
<td align="right">12</td>
<td align="right">15</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">8</td>
<td align="right">12</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">9</td>
<td align="right">13</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">10</td>
<td align="right">13</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">11</td>
<td align="right">13</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">12</td>
<td align="right">13</td>
<td align="right">14</td>
<td align="right">15</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">13</td>
<td align="right">14</td>
<td align="right">14</td>
<td align="right">15</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">14</td>
<td align="right">14</td>
<td align="right">18</td>
<td align="right">15</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">15</td>
<td align="right">18</td>
<td align="right">21</td>
<td align="right">15</td>
<td align="right">21</td>
</tr>
</tbody>
</table>
<p>As a control we check whether the numbers of visits and AEs of our processed data still matches the number of AEs in our original data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df_aevs_aggr</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df_vs</span><span class="op">)</span><span class="op">)</span>

<span class="va">n_aes</span> <span class="op">&lt;-</span> <span class="va">df_aevs_aggr</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">SUBJID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>n_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">CUM_AE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">pull</span><span class="op">(</span><span class="va">n_aes</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">n_aes_original</span> <span class="op">&lt;-</span> <span class="va">df_ae</span> <span class="op">%&gt;%</span>
  <span class="co"># all AEs for patients with more than 1 visit</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">SUBJID</span> <span class="op">%in%</span> <span class="va">df_aevs</span><span class="op">$</span><span class="va">SUBJID</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="va">n_aes</span> <span class="op">==</span> <span class="va">n_aes_original</span><span class="op">)</span></code></pre></div>
</div>
<div id="simaerep" class="section level1">
<h1 class="hasAnchor">
<a href="#simaerep" class="anchor"></a>{simaerep}</h1>
<p>After renaming some of the columns we can pass the aggregated data from the SAS files to <code>simaerep</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_visit</span> <span class="op">&lt;-</span> <span class="va">df_aevs_aggr</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>
    study_id <span class="op">=</span> <span class="st">"STUDYID"</span>,
    site_number <span class="op">=</span> <span class="st">"SITEID"</span>,
    patnum <span class="op">=</span> <span class="st">"SUBJID"</span>,
    n_ae <span class="op">=</span> <span class="st">"CUM_AE"</span>,
    visit <span class="op">=</span> <span class="st">"VS_NO"</span>
  <span class="op">)</span>  <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">patnum</span>, <span class="va">n_ae</span>, <span class="va">visit</span><span class="op">)</span>

<span class="va">df_visit</span></code></pre></div>
<pre><code>## # A tibble: 5,432 x 5
##    study_id   site_number patnum    n_ae visit
##    &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1 CO-101-001 001         01001001     1     1
##  2 CO-101-001 001         01001001     2     2
##  3 CO-101-001 001         01001001     2     3
##  4 CO-101-001 001         01001001     2     4
##  5 CO-101-001 001         01001001     2     5
##  6 CO-101-001 001         01001001     2     6
##  7 CO-101-001 001         01001001     2     7
##  8 CO-101-001 001         01001001     3     8
##  9 CO-101-001 001         01001001     3     9
## 10 CO-101-001 001         01001001     6    10
## # … with 5,422 more rows</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_site</span> <span class="op">&lt;-</span> <span class="va">df_visit</span> <span class="op">%&gt;%</span>
  <span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/site_aggr.html">site_aggr</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">df_site</span></code></pre></div>
<pre><code>## # A tibble: 75 x 6
##    study_id site_number n_patients visit_med75 n_pat_with_med75 mean_ae_site_me…
##    &lt;chr&gt;    &lt;chr&gt;            &lt;int&gt;       &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 CO-101-… 001                  4           8                2             7   
##  2 CO-101-… 003                  4          18                3            14.7 
##  3 CO-101-… 005                  2           9                2             8.5 
##  4 CO-101-… 007                  6           9                4             7.5 
##  5 CO-101-… 009                  1           9                1            30   
##  6 CO-101-… 015                  6           6                6             3.83
##  7 CO-101-… 017                  2          11                1            22   
##  8 CO-101-… 018                  1           6                1            15   
##  9 CO-101-… 019                  3           9                3             5.67
## 10 CO-101-… 020                  4          11                3            11.7 
## # … with 65 more rows</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_sim_sites</span> <span class="op">&lt;-</span> <span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/sim_sites.html">sim_sites</a></span><span class="op">(</span><span class="va">df_site</span>, <span class="va">df_visit</span>, r <span class="op">=</span> <span class="fl">1000</span>, poisson_test <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">df_sim_sites</span></code></pre></div>
<pre><code>## # A tibble: 75 x 6
##    study_id  site_number visit_med75 mean_ae_site_med… mean_ae_study_m… prob_low
##    &lt;chr&gt;     &lt;chr&gt;             &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;    &lt;dbl&gt;
##  1 CO-101-0… 001                   8              7                6.26    1    
##  2 CO-101-0… 003                  18             14.7             11.1     1    
##  3 CO-101-0… 005                   9              8.5              7.04    1    
##  4 CO-101-0… 007                   9              7.5              7.05    1    
##  5 CO-101-0… 009                   9             30                6.96    1    
##  6 CO-101-0… 015                   6              3.83             5.17    0.328
##  7 CO-101-0… 017                  11             22                7.62    1    
##  8 CO-101-0… 018                   6             15                5.11    1    
##  9 CO-101-0… 019                   9              5.67             7.07    0.411
## 10 CO-101-0… 020                  11             11.7              7.64    1    
## # … with 65 more rows</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_eval</span> <span class="op">&lt;-</span> <span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/eval_sites.html">eval_sites</a></span><span class="op">(</span><span class="va">df_sim_sites</span><span class="op">)</span>

<span class="va">df_eval</span></code></pre></div>
<pre><code>## # A tibble: 75 x 8
##    study_id site_number visit_med75 mean_ae_site_me… mean_ae_study_m… prob_low
##    &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;    &lt;dbl&gt;
##  1 CO-101-… 078                   7             0.6              5.69    0    
##  2 CO-101-… 084                  11             0.6              7.89    0    
##  3 CO-101-… 073                   6             1                5.21    0.006
##  4 CO-101-… 086                   7             1.2              5.68    0.011
##  5 CO-101-… 067                  12             4.53             8.63    0.014
##  6 CO-101-… 079                  15             5.33            10.0     0.023
##  7 CO-101-… 071                  12             2.67             8.39    0.069
##  8 CO-101-… 066                  11             3.4              7.82    0.075
##  9 CO-101-… 085                  24             0               14.6     0.097
## 10 CO-101-… 069                   6             2.4              5.19    0.108
## # … with 65 more rows, and 2 more variables: prob_low_adj &lt;dbl&gt;,
## #   prob_low_prob_ur &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">simaerep</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_study.html">plot_study</a></span><span class="op">(</span><span class="va">df_visit</span>, <span class="va">df_site</span>, <span class="va">df_eval</span>, study <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df_visit</span><span class="op">$</span><span class="va">study_id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="sas_files_files/figure-html/unnamed-chunk-11-1.png" width="960"></p>
<p><em>Left panel shows mean AE reporting per site (lightblue and darkblue lines) against mean AE reporting of the entire study (golden line). Single sites are plotted in descending order by AE under-reporting probability on the right panel in which grey lines denote cumulative AE count of single patients. Grey dots in the left panel plot indicate sites that were picked for single plotting. AE under-reporting probability of dark blue lines crossed threshold of 95%. Numbers in the upper left corner indicate the ratio of patients that have been used for the analysis against the total number of patients. Patients that have not been on the study long enough to reach the evaluation point (visit_med75, see introduction) will be ignored.</em></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

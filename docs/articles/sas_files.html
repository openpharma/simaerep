<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>SAS Files as a Data Source • simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SAS Files as a Data Source">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simaerep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0.900</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/intro.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/inframe.html">Inframe Simulation Using Table Operations</a></li>
    <li><a class="dropdown-item" href="../articles/over.html">Over-Reporting Probability</a></li>
    <li><a class="dropdown-item" href="../articles/performance.html">Statistical Performance</a></li>
    <li><a class="dropdown-item" href="../articles/funnel_perf.html">Comparing {simaerep} and Funnel Plot Performance</a></li>
    <li><a class="dropdown-item" href="../articles/sas_files.html">SAS Files as a Data Source</a></li>
    <li><a class="dropdown-item" href="../articles/portfolio_perf.html">(superseeded) simaerep Portfolio Performance</a></li>
    <li><a class="dropdown-item" href="../articles/visit_med75.html">Adjusted Evaluation Point visit_med75</a></li>
    <li><a class="dropdown-item" href="../articles/usability_limits.html">Address Usability Limits of Bootstrap Method</a></li>
    <li><a class="dropdown-item" href="../articles/check_poisson.html">Check Poisson Test Applicability</a></li>
    <li><a class="dropdown-item" href="../articles/visits_or_days.html">Aggregate AEs by Days or Visit?</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/simaerep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>SAS Files as a Data Source</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/HEAD/vignettes/sas_files.Rmd" class="external-link"><code>vignettes/sas_files.Rmd</code></a></small>
      <div class="d-none name"><code>sas_files.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="load">Load<a class="anchor" aria-label="anchor" href="#load"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/simaerep/">simaerep</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org" class="external-link">haven</a></span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sas-files">SAS files<a class="anchor" aria-label="anchor" href="#sas-files"></a>
</h2>
<p>Typically clinical data is stored in several SAS files in a
standardized format. We need the files in which the visits and the AEs
are recorded. For this demo we have selected an anonymized data set
which only contains patients enrolled into the control arm. In those
data sets the AE onset dates and the visit dates have been replaced with
the number of days that have passed since a specific cut-off date. We
can proceed in a similar way</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ae</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_sas.html" class="external-link">read_sas</a></span><span class="op">(</span><span class="st">'adae.sas7bdat'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SUBJID</span>, <span class="va">SITEID</span>, <span class="va">AESTDY</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">df_ae</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4,702 × 4</span></span></span>
<span><span class="co">##    STUDYID    SUBJID   SITEID AESTDY</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> CO-101-001 01001001 001       -<span style="color: #BB0000;">14</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> CO-101-001 01001001 001       -<span style="color: #BB0000;">13</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> CO-101-001 01001001 001        50</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> CO-101-001 01001001 001        67</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> CO-101-001 01001001 001        77</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> CO-101-001 01001001 001        84</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> CO-101-001 01001001 001        99</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> CO-101-001 01001001 001        99</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> CO-101-001 01001001 001       127</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> CO-101-001 01001001 001       127</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 4,692 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_vs</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_sas.html" class="external-link">read_sas</a></span><span class="op">(</span><span class="st">'advs.sas7bdat'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SUBJID</span>, <span class="va">SITEID</span>, <span class="va">ADY</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">df_vs</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 45,176 × 4</span></span></span>
<span><span class="co">##    STUDYID    SUBJID   SITEID   ADY</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> CO-101-001 01001001 001       -<span style="color: #BB0000;">7</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> CO-101-001 01001001 001        1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> CO-101-001 01001001 001        1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> CO-101-001 01001001 001        8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> CO-101-001 01001001 001        8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> CO-101-001 01001001 001       15</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> CO-101-001 01001001 001       15</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> CO-101-001 01001001 001       29</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> CO-101-001 01001001 001       29</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> CO-101-001 01001001 001       38</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 45,166 more rows</span></span></span></code></pre>
<p>In order to assign each AE to a visit we union both event tables and
sort by date.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ae</span> <span class="op">&lt;-</span> <span class="va">df_ae</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>DY <span class="op">=</span> <span class="va">AESTDY</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>EVENT <span class="op">=</span> <span class="st">"AE"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_vs</span> <span class="op">&lt;-</span> <span class="va">df_vs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>DY <span class="op">=</span> <span class="va">ADY</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>EVENT <span class="op">=</span> <span class="st">"VS"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># we ignore visits that have no date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">DY</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># we are not interested in same day visits</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_aevs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_ae</span>, <span class="va">df_vs</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># NA's get sorted towards the end thus AEs with no date get sorted towards last visit</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SITEID</span>, <span class="va">SUBJID</span>, <span class="va">DY</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SITEID</span>, <span class="va">SUBJID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>AE_NO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">EVENT</span> <span class="op">==</span> <span class="st">"AE"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         VS_NO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">EVENT</span> <span class="op">==</span> <span class="st">"VS"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># we remove patients with 0 visits</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">VS_NO</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># AE's before fist visit should register to visit 1 not zero</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>VS_NO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">VS_NO</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="va">VS_NO</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>patient example with AE before first visit and AEs with NA in
date</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_aevs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SUBJID</span> <span class="op">==</span> <span class="st">"01007004"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">STUDYID</th>
<th align="left">SUBJID</th>
<th align="left">SITEID</th>
<th align="right">DY</th>
<th align="left">EVENT</th>
<th align="right">AE_NO</th>
<th align="right">VS_NO</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">-14</td>
<td align="left">AE</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">-8</td>
<td align="left">VS</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">-3</td>
<td align="left">AE</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">-1</td>
<td align="left">AE</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">1</td>
<td align="left">AE</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">1</td>
<td align="left">VS</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">8</td>
<td align="left">VS</td>
<td align="right">4</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">15</td>
<td align="left">AE</td>
<td align="right">5</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">15</td>
<td align="left">AE</td>
<td align="right">6</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">18</td>
<td align="left">AE</td>
<td align="right">7</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">20</td>
<td align="left">VS</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">29</td>
<td align="left">VS</td>
<td align="right">7</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">36</td>
<td align="left">AE</td>
<td align="right">8</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">36</td>
<td align="left">AE</td>
<td align="right">9</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">36</td>
<td align="left">AE</td>
<td align="right">10</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">36</td>
<td align="left">VS</td>
<td align="right">10</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">43</td>
<td align="left">VS</td>
<td align="right">10</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">57</td>
<td align="left">AE</td>
<td align="right">11</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">57</td>
<td align="left">AE</td>
<td align="right">12</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">57</td>
<td align="left">VS</td>
<td align="right">12</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">58</td>
<td align="left">AE</td>
<td align="right">13</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">64</td>
<td align="left">VS</td>
<td align="right">13</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">71</td>
<td align="left">VS</td>
<td align="right">13</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">85</td>
<td align="left">VS</td>
<td align="right">13</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">92</td>
<td align="left">VS</td>
<td align="right">13</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">99</td>
<td align="left">AE</td>
<td align="right">14</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">99</td>
<td align="left">VS</td>
<td align="right">14</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">112</td>
<td align="left">VS</td>
<td align="right">14</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">120</td>
<td align="left">AE</td>
<td align="right">15</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">123</td>
<td align="left">AE</td>
<td align="right">16</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">123</td>
<td align="left">AE</td>
<td align="right">17</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">123</td>
<td align="left">AE</td>
<td align="right">18</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">125</td>
<td align="left">VS</td>
<td align="right">18</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">NA</td>
<td align="left">AE</td>
<td align="right">19</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">NA</td>
<td align="left">AE</td>
<td align="right">20</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">01007004</td>
<td align="left">007</td>
<td align="right">NA</td>
<td align="left">AE</td>
<td align="right">21</td>
<td align="right">15</td>
</tr>
</tbody>
</table>
<p>Then we aggregate on visit number.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_aevs_aggr</span> <span class="op">&lt;-</span> <span class="va">df_aevs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SITEID</span>, <span class="va">SUBJID</span>, <span class="va">VS_NO</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>MIN_AE_NO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">AE_NO</span><span class="op">)</span>,</span>
<span>            MAX_AE_NO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">AE_NO</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">SITEID</span>, <span class="va">SUBJID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>MAX_VS_PAT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">VS_NO</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># assign AEs that occur after last visit to last AE</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    CUM_AE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>      <span class="va">VS_NO</span> <span class="op">==</span> <span class="va">MAX_VS_PAT</span>,</span>
<span>      <span class="va">MAX_AE_NO</span>,</span>
<span>      <span class="va">MIN_AE_NO</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>Same patient example as before.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_aevs_aggr</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SUBJID</span> <span class="op">==</span> <span class="st">"01007004"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="15%">
<col width="9%">
<col width="12%">
<col width="8%">
<col width="14%">
<col width="14%">
<col width="15%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left">STUDYID</th>
<th align="left">SITEID</th>
<th align="left">SUBJID</th>
<th align="right">VS_NO</th>
<th align="right">MIN_AE_NO</th>
<th align="right">MAX_AE_NO</th>
<th align="right">MAX_VS_PAT</th>
<th align="right">CUM_AE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">15</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">15</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">7</td>
<td align="right">15</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">4</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="right">15</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">10</td>
<td align="right">15</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">6</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">15</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">7</td>
<td align="right">10</td>
<td align="right">12</td>
<td align="right">15</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">8</td>
<td align="right">12</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">9</td>
<td align="right">13</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">10</td>
<td align="right">13</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">11</td>
<td align="right">13</td>
<td align="right">13</td>
<td align="right">15</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">12</td>
<td align="right">13</td>
<td align="right">14</td>
<td align="right">15</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">13</td>
<td align="right">14</td>
<td align="right">14</td>
<td align="right">15</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">14</td>
<td align="right">14</td>
<td align="right">18</td>
<td align="right">15</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">CO-101-001</td>
<td align="left">007</td>
<td align="left">01007004</td>
<td align="right">15</td>
<td align="right">18</td>
<td align="right">21</td>
<td align="right">15</td>
<td align="right">21</td>
</tr>
</tbody>
</table>
<p>As a control we check whether the numbers of visits and AEs of our
processed data still matches the number of AEs in our original data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_aevs_aggr</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_vs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_aes</span> <span class="op">&lt;-</span> <span class="va">df_aevs_aggr</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SUBJID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">CUM_AE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">n_aes</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_aes_original</span> <span class="op">&lt;-</span> <span class="va">df_ae</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># all AEs for patients with more than 1 visit</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SUBJID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">df_aevs</span><span class="op">$</span><span class="va">SUBJID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">n_aes</span> <span class="op">==</span> <span class="va">n_aes_original</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simaerep">{simaerep}<a class="anchor" aria-label="anchor" href="#simaerep"></a>
</h2>
<p>After renaming some of the columns we can pass the aggregated data
from the SAS files to <code>simaerep</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_visit</span> <span class="op">&lt;-</span> <span class="va">df_aevs_aggr</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    study_id <span class="op">=</span> <span class="st">"STUDYID"</span>,</span>
<span>    site_number <span class="op">=</span> <span class="st">"SITEID"</span>,</span>
<span>    patnum <span class="op">=</span> <span class="st">"SUBJID"</span>,</span>
<span>    n_ae <span class="op">=</span> <span class="st">"CUM_AE"</span>,</span>
<span>    visit <span class="op">=</span> <span class="st">"VS_NO"</span></span>
<span>  <span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">site_number</span>, <span class="va">patnum</span>, <span class="va">n_ae</span>, <span class="va">visit</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_visit</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 5,432 × 5</span></span></span>
<span><span class="co">##    study_id   site_number patnum    n_ae visit</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> CO-101-001 001         01001001     1     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> CO-101-001 001         01001001     2     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> CO-101-001 001         01001001     2     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> CO-101-001 001         01001001     2     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> CO-101-001 001         01001001     2     5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> CO-101-001 001         01001001     2     6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> CO-101-001 001         01001001     2     7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> CO-101-001 001         01001001     3     8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> CO-101-001 001         01001001     3     9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> CO-101-001 001         01001001     6    10</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5,422 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aerep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simaerep.html">simaerep</a></span><span class="op">(</span><span class="va">df_visit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">aerep</span><span class="op">)</span></span></code></pre></div>
<p><img src="sas_files_files/figure-html/unnamed-chunk-8-1.png" width="960"></p>
<p><em>Left panel shows mean AE reporting per site (lightblue and
darkblue lines) against mean AE reporting of the entire study (golden
line). Single sites are plotted in descending order by AE
under-reporting probability on the right panel in which grey lines
denote cumulative AE count of single patients. Grey dots in the left
panel plot indicate sites that were picked for single plotting. AE
under-reporting probability of dark blue lines crossed threshold of 95%.
Numbers in the upper left corner indicate the ratio of patients that
have been used for the analysis against the total number of patients.
Patients that have not been on the study long enough to reach the
evaluation point (visit_med75, see introduction) will be
ignored.</em></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
